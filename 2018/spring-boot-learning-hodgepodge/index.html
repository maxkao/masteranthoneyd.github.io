<!doctype html><html class="theme-next muse use-motion" lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta http-equiv="content-language" content="zh-cn"><script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script><link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet"><style>.pace .pace-progress{background:#ff009e;height:2px}.pace .pace-progress-inner{box-shadow:0 0 10px #e6006b,0 0 5px #ff009e}.pace .pace-activity{border-top-color:#ff009e;border-left-color:#ff009e}</style><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css"><meta name="keywords" content="Java,Spring Boot,Spring,"><link rel="alternate" href="/atom.xml" title="ookamiAntD's Blog" type="application/atom+xml"><link rel="shortcut icon" type="image/x-icon" href="/favicon.png?v=5.1.0"><meta name="description" content="Spring Boot作为当下最流行的微服务项目构建基础，有的时候我们根本不需要额外的配置就能够干很多的事情，这得益于它的一个核心理念：“习惯优于配置”。。。说白的就是大部分的配置都已经按照最佳实践的编程规范配置好了本文基于 Spring Boot 2的学习杂记，还是与1.X版本还是有一定区别的"><meta name="keywords" content="Java,Spring Boot,Spring"><meta property="og:type" content="article"><meta property="og:title" content="Spring Boot 学习杂记"><meta property="og:url" content="http://yangbingdong.com/2018/spring-boot-learning-hodgepodge/index.html"><meta property="og:site_name" content="ookamiAntD&#39;s Blog"><meta property="og:description" content="Spring Boot作为当下最流行的微服务项目构建基础，有的时候我们根本不需要额外的配置就能够干很多的事情，这得益于它的一个核心理念：“习惯优于配置”。。。说白的就是大部分的配置都已经按照最佳实践的编程规范配置好了本文基于 Spring Boot 2的学习杂记，还是与1.X版本还是有一定区别的"><meta property="og:locale" content="en"><meta property="og:image" content="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/spring-boot.png"><meta property="og:image" content="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/parent.png"><meta property="og:image" content="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/repackage.png"><meta property="og:image" content="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/spring-boot-devtools01.png"><meta property="og:image" content="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/spring-boot-devtools02.png"><meta property="og:image" content="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/tomcat-gatling-test.jpg"><meta property="og:image" content="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/undertow-gatling-test.jpg"><meta property="og:image" content="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/log4j2-performance.png"><meta property="og:image" content="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/mvc-process.png"><meta property="og:updated_time" content="2018-04-11T05:37:21.062Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Spring Boot 学习杂记"><meta name="twitter:description" content="Spring Boot作为当下最流行的微服务项目构建基础，有的时候我们根本不需要额外的配置就能够干很多的事情，这得益于它的一个核心理念：“习惯优于配置”。。。说白的就是大部分的配置都已经按照最佳实践的编程规范配置好了本文基于 Spring Boot 2的学习杂记，还是与1.X版本还是有一定区别的"><meta name="twitter:image" content="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/spring-boot.png"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Muse",sidebar:{position:"right",display:"always"},fancybox:!0,motion:!0,duoshuo:{userId:"undefined",author:"Author"},algolia:{applicationID:"RI3NF6GUI0",apiKey:"3d33fa60ba30d3b17f37220bb1a36749",indexName:"blogIndex",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://yangbingdong.com/2018/spring-boot-learning-hodgepodge/"><title>Spring Boot 学习杂记 | ookamiAntD's Blog</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="en"><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?e9505ac4e11d464329d615553a72b526";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><div class="container one-collumn sidebar-position-right page-post-detail"><div class="headband"></div><a href="https://github.com/masteranthoneyd/blog" rel="external nofollow noopener noreferrer" target="_blank"><img style="position:absolute;top:0;left:0;border:0" src="https://camo.githubusercontent.com/82b228a3648bf44fc1163ef44c62fcc60081495e/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f6c6566745f7265645f6161303030302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_left_red_aa0000.png"></a><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">ookamiAntD's Blog</span> <span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">Easy coding,easy life.</h1></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>Home</a></li><li class="menu-item menu-item-archives"><a href="/archives" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>Archives</a></li><li class="menu-item menu-item-categories"><a href="/categories" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>Categories</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>Tags</a></li><li class="menu-item menu-item-about"><a href="/about" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>About</a></li><li class="menu-item menu-item-guestbook"><a href="/guestbook" rel="section"><i class="menu-item-icon fa fa-fw fa-commenting"></i><br>Message</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>Search</a></li></ul><div class="site-search"><div class="popup"><span class="search-icon fa fa-search"></span> <input type="text" id="local-search-input"><div id="local-search-result"></div><span class="popup-btn-close">close</span></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://yangbingdong.com/2018/spring-boot-learning-hodgepodge/"><span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="ookamiAntD"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar/avatar-admin.jpg"></span><span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="ookamiAntD's Blog"><span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject"><img style="display:none" itemprop="url image" alt="ookamiAntD's Blog" src=""></span></span><header class="post-header"><h2 class="post-title" itemprop="name headline">Spring Boot 学习杂记</h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-02-25T15:25:35+08:00">2018-02-25 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Programming/" itemprop="url" rel="index"><span itemprop="name">Programming</span> </a></span>, <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Programming/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span> </a></span>, <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Programming/Java/Spring-Boot/" itemprop="url" rel="index"><span itemprop="name">Spring Boot</span> </a></span></span><span id="busuanzi_container_page_pv">&nbsp; | &nbsp; 热度&nbsp; <span id="busuanzi_value_page_pv"></span>°C </span><span id="/2018/spring-boot-learning-hodgepodge/" class="leancloud_visitors" data-flag-title="Spring Boot 学习杂记"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">Visitors </span><span class="leancloud-visitors-count"></span></span><br><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-edit"></i> </span><span class="post-meta-item-text">WordCount:</span> <span class="post-count">10,047字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-text">min2read:</span> <span class="post-count">47分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p><img src="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/spring-boot.png" alt=""></p><blockquote><p>Spring Boot作为当下最流行的微服务项目构建基础，有的时候我们根本不需要额外的配置就能够干很多的事情，这得益于它的一个核心理念：“习惯优于配置”。。。</p><p>说白的就是大部分的配置都已经按照<del>最佳实践</del>的编程规范配置好了</p><p>本文基于 Spring Boot 2的学习杂记，还是与1.X版本还是有一定区别的</p></blockquote><a id="more"></a><h1 id="构建依赖版本管理工程"><a href="#构建依赖版本管理工程" class="headerlink" title="构建依赖版本管理工程"></a>构建依赖版本管理工程</h1><blockquote><p>为什么要分开为两个工程？因为考虑到common工程也需要版本控制，但parent工程中依赖了common工程，所以common工程不能依赖parent工程（循环依赖），故例外抽离出一个dependencies的工程，专门用作依赖版本管理，而parent工程用作其他子工程的公共依赖。</p></blockquote><h2 id="依赖版本管理工程"><a href="#依赖版本管理工程" class="headerlink" title="依赖版本管理工程"></a>依赖版本管理工程</h2><p>跟下面父工程一样只有一个<code>pom.xml</code></p><p><em><a href="https://github.com/masteranthoneyd/spring-boot-learning/tree/master/spring-boot-parent-dependencies" rel="external nofollow noopener noreferrer" target="_blank">https://github.com/masteranthoneyd/spring-boot-learning/tree/master/spring-boot-parent-dependencies</a></em></p><h2 id="父工程"><a href="#父工程" class="headerlink" title="父工程"></a>父工程</h2><p><img src="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/parent.png" alt=""></p><p><em><a href="https://github.com/masteranthoneyd/spring-boot-learning/blob/master/spring-boot-parent/pom.xml" rel="external nofollow noopener noreferrer" target="_blank">https://github.com/masteranthoneyd/spring-boot-learning/blob/master/spring-boot-parent/pom.xml</a></em></p><p>说明：</p><ul><li><code>&lt;packaging&gt;</code> 为 <code>pom</code> 表示此会被打包成 pom 文件被其他子项目依赖。</li><li>由于 Spring Boot 以及集成了 <code>maven-surefire-plugin</code> 插件，跳过测试只需要在 properties中添加 <code>&lt;maven.test.skip&gt;true&lt;/maven.test.skip&gt;</code>即可，等同 <code>mvn package -Dmaven.test.skip=true</code>，也可使用 <code>&lt;skipTests&gt;true&lt;/skipTests&gt;</code>，两者的区别在于 <code>&lt;maven.test.skip&gt;</code> 标签连 <code>.class</code> 文件都不会生成，而 <code>&lt;skipTests&gt;</code> 会编译生成 <code>.class</code> 文件</li></ul><ul><li>子项目会继承父项目的 <code>properties</code>，若子项目重新定义属性，则会覆盖父项目的属性。</li><li><code>&lt;dependencyManagement&gt;</code> 管理依赖版本，不使用 <code>&lt;parent&gt;</code> 来依赖 Spring Boot，可以使用上面方式，添加 <code>&lt;type&gt;</code> 为 <code>pom</code> 以及 <code>&lt;scope&gt;</code> 为 <code>import</code>。</li><li><code>&lt;pluginManagement&gt;</code> 的功能类似于 <code>&lt;dependencyManagement&gt;</code>，在父项目中设置好插件属性，在子项目中直接依赖就可以，不需要每个子项目都配置一遍，当然了，子项目也可以覆盖插件属性。</li></ul><h1 id="打包"><a href="#打包" class="headerlink" title="打包"></a>打包</h1><h2 id="打包成可执行的Jar"><a href="#打包成可执行的Jar" class="headerlink" title="打包成可执行的Jar"></a>打包成可执行的Jar</h2><p>默认情况下Spring Boot打包出来的jar包是不可执行的，需要这样配置：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;plugins&gt;</span><br><span class="line">    &lt;plugin&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;spring-boot.version&#125;&lt;/version&gt;</span><br><span class="line">        &lt;executions&gt;</span><br><span class="line">            &lt;execution&gt;</span><br><span class="line">                &lt;goals&gt;</span><br><span class="line">                    &lt;goal&gt;repackage&lt;/goal&gt;</span><br><span class="line">                &lt;/goals&gt;</span><br><span class="line">            &lt;/execution&gt;</span><br><span class="line">        &lt;/executions&gt;</span><br><span class="line">    &lt;/plugin&gt;</span><br><span class="line">&lt;/plugins&gt;</span><br></pre></td></tr></table></figure>
<p>打包之后会发现有<strong>两个</strong>jar，一个是本身的代码，一个是集成了Spring Boot的可运行jar：</p>
<p><img src="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/repackage.png" alt=""></p>
<h2 id="打包依赖了Spring-Boot的工具库"><a href="#打包依赖了Spring-Boot的工具库" class="headerlink" title="打包依赖了Spring Boot的工具库"></a>打包依赖了Spring Boot的工具库</h2><p>只需要在打包插件<code>spring-boot-maven-plugin</code>中这样配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;build&gt;</span><br><span class="line">    &lt;plugins&gt;</span><br><span class="line">        &lt;plugin&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">            &lt;executions&gt;</span><br><span class="line">                &lt;execution&gt;</span><br><span class="line">                    &lt;phase&gt;none&lt;/phase&gt;</span><br><span class="line">                &lt;/execution&gt;</span><br><span class="line">            &lt;/executions&gt;</span><br><span class="line">        &lt;/plugin&gt;</span><br><span class="line">    &lt;/plugins&gt;</span><br><span class="line">&lt;/build&gt;</span><br></pre></td></tr></table></figure>
<h2 id="打包契约类"><a href="#打包契约类" class="headerlink" title="打包契约类"></a>打包契约类</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;build&gt;</span><br><span class="line">    &lt;plugins&gt;</span><br><span class="line">        &lt;plugin&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;maven-jar-plugin&lt;/artifactId&gt;</span><br><span class="line">            &lt;configuration&gt;</span><br><span class="line">                &lt;includes&gt;</span><br><span class="line">                    &lt;include&gt;com/yangbingdong/server/**/contract/**/*.class&lt;/include&gt;</span><br><span class="line">                &lt;/includes&gt;</span><br><span class="line">            &lt;/configuration&gt;</span><br><span class="line">        &lt;/plugin&gt;</span><br><span class="line">        &lt;plugin&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">            &lt;executions&gt;</span><br><span class="line">                &lt;execution&gt;</span><br><span class="line">                    &lt;phase&gt;none&lt;/phase&gt;</span><br><span class="line">                &lt;/execution&gt;</span><br><span class="line">            &lt;/executions&gt;</span><br><span class="line">        &lt;/plugin&gt;</span><br><span class="line">    &lt;/plugins&gt;</span><br><span class="line">&lt;/build&gt;</span><br></pre></td></tr></table></figure>
<p>然后指定该pom文件构建：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn -f pom_own.xml package</span><br></pre></td></tr></table></figure>
<h1 id="配置文件：Properties-和-YAML"><a href="#配置文件：Properties-和-YAML" class="headerlink" title="配置文件：Properties 和 YAML"></a>配置文件：Properties 和 YAML</h1><h2 id="配置文件的生效顺序，会对值进行覆盖"><a href="#配置文件的生效顺序，会对值进行覆盖" class="headerlink" title="配置文件的生效顺序，会对值进行覆盖"></a>配置文件的生效顺序，会对值进行覆盖</h2><ol>
<li><p><code>@TestPropertySource</code> 注解</p>
</li>
<li><p>命令行参数</p>
</li>
<li>Java系统属性（<code>System.getProperties()</code>）</li>
<li>操作系统环境变量</li>
<li>只有在<code>random.*</code>里包含的属性会产生一个<code>RandomValuePropertySource</code></li>
<li>在打包的jar外的应用程序配置文件（<code>application.properties</code>，包含YAML和profile变量）</li>
<li>在打包的jar内的应用程序配置文件（<code>application.properties</code>，包含YAML和profile变量）</li>
<li>在<code>@Configuration</code>类上的<code>@PropertySource</code>注解</li>
<li>默认属性（使用<code>SpringApplication.setDefaultProperties</code>指定）</li>
</ol>
<h2 id="配置随机值"><a href="#配置随机值" class="headerlink" title="配置随机值"></a>配置随机值</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">roncoo.secret=$&#123;random.value&#125;</span><br><span class="line">roncoo.number=$&#123;random.int&#125;</span><br><span class="line">roncoo.bignumber=$&#123;random.long&#125;</span><br><span class="line">roncoo.number.less.than.ten=$&#123;random.int(10)&#125;</span><br><span class="line">roncoo.number.in.range=$&#123;random.int[1024,65536]&#125;</span><br><span class="line"></span><br><span class="line">读取使用注解：@Value(value = &quot;$&#123;roncoo.secret&#125;&quot;)</span><br></pre></td></tr></table></figure>
<h2 id="应用简单配置"><a href="#应用简单配置" class="headerlink" title="应用简单配置"></a>应用简单配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#端口配置：</span><br><span class="line">server.port=8090</span><br><span class="line">#应用名</span><br><span class="line">spring.application.name=test-demo</span><br><span class="line">#时间格式化</span><br><span class="line">spring.jackson.date-format=yyyy-MM-dd HH:mm:ss</span><br><span class="line">#时区设置</span><br><span class="line">spring.jackson.time-zone=Asia/Chongqing</span><br></pre></td></tr></table></figure>
<h2 id="配置文件-多环境配置"><a href="#配置文件-多环境配置" class="headerlink" title="配置文件-多环境配置"></a>配置文件-多环境配置</h2><h3 id="多环境配置的好处"><a href="#多环境配置的好处" class="headerlink" title="多环境配置的好处"></a>多环境配置的好处</h3><blockquote>
<ul>
<li>不同环境配置可以配置不同的参数</li>
<li>便于部署，提高效率，减少出错</li>
</ul>
</blockquote>
<h3 id="Properties多环境配置"><a href="#Properties多环境配置" class="headerlink" title="Properties多环境配置"></a>Properties多环境配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1. 配置激活选项</span><br><span class="line">spring.profiles.active=dev</span><br><span class="line"></span><br><span class="line">2.添加其他配置文件</span><br><span class="line">application.properties</span><br><span class="line">application-dev.properties</span><br><span class="line">application-prod.properties</span><br><span class="line">application-test.properties</span><br></pre></td></tr></table></figure>
<h3 id="YAML多环境配置"><a href="#YAML多环境配置" class="headerlink" title="YAML多环境配置"></a>YAML多环境配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1.配置激活选项</span><br><span class="line">spring:</span><br><span class="line">  profiles:</span><br><span class="line">    active: dev</span><br><span class="line">2.在配置文件添加三个英文状态下的短横线即可区分</span><br><span class="line">---</span><br><span class="line">spring:</span><br><span class="line">  profiles: dev</span><br></pre></td></tr></table></figure>
<h3 id="两种配置方式的比较"><a href="#两种配置方式的比较" class="headerlink" title="两种配置方式的比较"></a>两种配置方式的比较</h3><blockquote>
<ul>
<li>Properties配置多环境，需要添加多个配置文件，YAML只需要一个配件文件</li>
<li>书写格式的差异，yaml相对比较简洁，优雅</li>
<li>YAML的缺点：不能通过<code>@PropertySource</code>注解加载。如果需要使用<code>@PropertySource</code>注解的方式加载值，那就要使用properties文件。</li>
</ul>
</blockquote>
<h3 id="如何使用"><a href="#如何使用" class="headerlink" title="如何使用"></a>如何使用</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -Dspring.profiles.active=dev -jar myapp.jar</span><br></pre></td></tr></table></figure>
<h1 id="热部署"><a href="#热部署" class="headerlink" title="热部署"></a>热部署</h1><p><code>pom.xml</code>添加依赖：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;!--支持热启动jar包--&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;</span><br><span class="line">        &lt;!-- optional=true,依赖不会传递，该项目依赖devtools；之后依赖该项目的项目如果想要使用devtools，需要重新引入 --&gt;</span><br><span class="line">        &lt;optional&gt;true&lt;/optional&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br><span class="line">&lt;build&gt;</span><br><span class="line">    &lt;plugins&gt;</span><br><span class="line">        &lt;plugin&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">            &lt;configuration&gt;</span><br><span class="line">                &lt;fork&gt;true&lt;/fork&gt;</span><br><span class="line">            &lt;/configuration&gt;</span><br><span class="line">        &lt;/plugin&gt;</span><br><span class="line">    &lt;/plugins&gt;</span><br><span class="line">&lt;/build&gt;</span><br></pre></td></tr></table></figure>
<p><code>application.yml</code>配置文件中添加：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  devtools:</span><br><span class="line">    restart:</span><br><span class="line">      #热部署生效 默认就是为true</span><br><span class="line">      enabled: true</span><br><span class="line">      #classpath目录下的WEB-INF文件夹内容修改不重启</span><br><span class="line">      exclude: WEB-INF/**</span><br></pre></td></tr></table></figure>
<p>关于DevTools的键值如下：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># DEVTOOLS (DevToolsProperties)</span><br><span class="line">spring.devtools.livereload.enabled=true # Enable a livereload.com compatible server.</span><br><span class="line">spring.devtools.livereload.port=35729 # Server port.</span><br><span class="line">spring.devtools.restart.additional-exclude= # Additional patterns that should be excluded from triggering a full restart.</span><br><span class="line">spring.devtools.restart.additional-paths= # Additional paths to watch for changes.</span><br><span class="line">spring.devtools.restart.enabled=true # Enable automatic restart.</span><br><span class="line">spring.devtools.restart.exclude=META-INF/maven/**,META-INF/resources/**,resources/**,static/**,public/**,templates/**,**/*Test.class,**/*Tests.class,git.properties # Patterns that should be excluded from triggering a full restart.</span><br><span class="line">spring.devtools.restart.poll-interval=1000 # Amount of time (in milliseconds) to wait between polling for classpath changes.</span><br><span class="line">spring.devtools.restart.quiet-period=400 # Amount of quiet time (in milliseconds) required without any classpath changes before a restart is triggered.</span><br><span class="line">spring.devtools.restart.trigger-file= # Name of a specific file that when changed will trigger the restart check. If not specified any classpath file change will trigger the restart.</span><br><span class="line"></span><br><span class="line"># REMOTE DEVTOOLS (RemoteDevToolsProperties)</span><br><span class="line">spring.devtools.remote.context-path=/.~~spring-boot!~ # Context path used to handle the remote connection.</span><br><span class="line">spring.devtools.remote.debug.enabled=true # Enable remote debug support.</span><br><span class="line">spring.devtools.remote.debug.local-port=8000 # Local remote debug server port.</span><br><span class="line">spring.devtools.remote.proxy.host= # The host of the proxy to use to connect to the remote application.</span><br><span class="line">spring.devtools.remote.proxy.port= # The port of the proxy to use to connect to the remote application.</span><br><span class="line">spring.devtools.remote.restart.enabled=true # Enable remote restart.</span><br><span class="line">spring.devtools.remote.secret= # A shared secret required to establish a connection (required to enable remote support).</span><br><span class="line">spring.devtools.remote.secret-header-name=X-AUTH-TOKEN # HTTP header used to transfer the shared secret.</span><br></pre></td></tr></table></figure><p></p>
<p>当我们修改了java类后，IDEA默认是不自动编译的，而<code>spring-boot-devtools</code>又是监测<code>classpath</code>下的文件发生变化才会重启应用，所以需要设置IDEA的自动编译：</p>
<p>（1）<strong>File-Settings-Compiler-Build Project automatically</strong></p>
<p><img src="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/spring-boot-devtools01.png" alt=""></p>
<p>（2）<strong>ctrl + shift + alt + /,选择Registry,勾上 Compiler autoMake allow when app running</strong></p>
<p><img src="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/spring-boot-devtools02.png" alt=""></p>
<p>OK了，重启一下项目，然后改一下类里面的内容，IDEA就会自动去make了。</p>
<blockquote>
<p><strong>热部署可能会牺牲一定的系统性能，因为是动态的编译</strong></p>
</blockquote>
<h1 id="使用为Undertow作为Web容器"><a href="#使用为Undertow作为Web容器" class="headerlink" title="使用为Undertow作为Web容器"></a>使用为Undertow作为Web容器</h1><blockquote>
<p>Spring Boot内嵌容器支持Tomcat、Jetty、Undertow。<br>根据 <a href="https://link.jianshu.com/?t=https://examples.javacodegeeks.com/enterprise-java/spring/tomcat-vs-jetty-vs-undertow-comparison-of-spring-boot-embedded-servlet-containers/" rel="external nofollow noopener noreferrer" target="_blank">Tomcat vs. Jetty vs. Undertow: Comparison of Spring Boot Embedded Servlet Containers</a> 这篇文章统计，Undertow的综合性能更好。</p>
<p>在Spring Boot 2中，已经把netty作为webflux的默认容器</p>
</blockquote>
<h2 id="与Tomcat性能对比"><a href="#与Tomcat性能对比" class="headerlink" title="与Tomcat性能对比"></a>与Tomcat性能对比</h2><p>以下是Undertow与Tomcat简单的性能测试（同样是默认配置）</p>
<p>Tomcat:</p>
<p><img src="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/tomcat-gatling-test.jpg" alt=""></p>
<p>Undertow:</p>
<p><img src="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/undertow-gatling-test.jpg" alt=""></p>
<p>显然Undertow的吞吐量要比Tomcat高</p>
<h2 id="Maven配置"><a href="#Maven配置" class="headerlink" title="Maven配置"></a>Maven配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">    &lt;exclusions&gt;</span><br><span class="line">        &lt;!-- 移除默认web容器，使用undertow --&gt;</span><br><span class="line">        &lt;exclusion&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-tomcat&lt;/artifactId&gt;</span><br><span class="line">        &lt;/exclusion&gt;</span><br><span class="line">    &lt;/exclusions&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">如果是webflux，默认的容器的netty</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-webflux&lt;/artifactId&gt;</span><br><span class="line">    &lt;exclusions&gt;</span><br><span class="line">        &lt;!-- 移除默认web容器，使用undertow --&gt;</span><br><span class="line">        &lt;exclusion&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-reactor-netty&lt;/artifactId&gt;</span><br><span class="line">        &lt;/exclusion&gt;</span><br><span class="line">    &lt;/exclusions&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 使用高性能 Web 容器 undertow --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-undertow&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<h2 id="监听多个端口与HTTP2支持"><a href="#监听多个端口与HTTP2支持" class="headerlink" title="监听多个端口与HTTP2支持"></a>监听多个端口与HTTP2支持</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// 在@Configuration的类中添加@bean</span><br><span class="line">@Bean</span><br><span class="line">UndertowEmbeddedServletContainerFactory embeddedServletContainerFactory() &#123;</span><br><span class="line">    </span><br><span class="line">    UndertowEmbeddedServletContainerFactory factory = new UndertowEmbeddedServletContainerFactory();</span><br><span class="line">    </span><br><span class="line">    // 这里也可以做其他配置</span><br><span class="line">	// 支持HTTP2</span><br><span class="line">	factory.addBuilderCustomizers(builder -&gt; &#123;</span><br><span class="line">		builder.setServerOption(UndertowOptions.ENABLE_HTTP2, true);</span><br><span class="line">		// 监听多个端口</span><br><span class="line">		builder.addHttpListener(8080, &quot;0.0.0.0&quot;);</span><br><span class="line">	&#125;);</span><br><span class="line">    return factory;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Undertow相关配置"><a href="#Undertow相关配置" class="headerlink" title="Undertow相关配置"></a>Undertow相关配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># Undertow 日志存放目录</span><br><span class="line">server.undertow.accesslog.dir</span><br><span class="line"># 是否启动日志</span><br><span class="line">server.undertow.accesslog.enabled=false </span><br><span class="line"># 日志格式</span><br><span class="line">server.undertow.accesslog.pattern=common</span><br><span class="line"># 日志文件名前缀</span><br><span class="line">server.undertow.accesslog.prefix=access_log</span><br><span class="line"># 日志文件名后缀</span><br><span class="line">server.undertow.accesslog.suffix=log</span><br><span class="line"># HTTP POST请求最大的大小</span><br><span class="line">server.undertow.max-http-post-size=0 </span><br><span class="line"># 设置IO线程数, 它主要执行非阻塞的任务,它们会负责多个连接, 默认设置每个CPU核心一个线程</span><br><span class="line">server.undertow.io-threads=4</span><br><span class="line"># 阻塞任务线程池, 当执行类似servlet请求阻塞操作, undertow会从这个线程池中取得线程,它的值设置取决于系统的负载，默认数量为 CPU核心*8</span><br><span class="line">server.undertow.worker-threads=20</span><br><span class="line"># 以下的配置会影响buffer,这些buffer会用于服务器连接的IO操作,有点类似netty的池化内存管理</span><br><span class="line"># 每块buffer的空间大小,越小的空间被利用越充分</span><br><span class="line">server.undertow.buffer-size=1024</span><br><span class="line"># 每个区分配的buffer数量 , 所以pool的大小是buffer-size * buffers-per-region</span><br><span class="line">server.undertow.buffers-per-region=1024</span><br><span class="line"># 是否分配的直接内存</span><br><span class="line">server.undertow.direct-buffers=true</span><br></pre></td></tr></table></figure>
<h1 id="日志相关"><a href="#日志相关" class="headerlink" title="日志相关"></a>日志相关</h1><h2 id="使用Log4j2"><a href="#使用Log4j2" class="headerlink" title="使用Log4j2"></a>使用Log4j2</h2><blockquote>
<p>更多Log4j2配置请看：<strong><em><a href="https://my.oschina.net/kkrgwbj/blog/734530" rel="external nofollow noopener noreferrer" target="_blank">https://my.oschina.net/kkrgwbj/blog/734530</a></em></strong></p>
</blockquote>
<p>下面是 Log4j2  官方性能测试结果：</p>
<p><img src="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/log4j2-performance.png" alt=""></p>
<h3 id="Maven配置-1"><a href="#Maven配置-1" class="headerlink" title="Maven配置"></a>Maven配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- Spring Boot 依赖--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">    &lt;!-- 去除 logback 依赖 --&gt;</span><br><span class="line">    &lt;exclusions&gt;</span><br><span class="line">        &lt;exclusion&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-logging&lt;/artifactId&gt;</span><br><span class="line">        &lt;/exclusion&gt;</span><br><span class="line">    &lt;/exclusions&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 日志 Log4j2 --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-log4j2&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- Log4j2 异步支持 --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.lmax&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;disruptor&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.3.8&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：需要单独把<code>spring-boot-starter</code>里面的<code>logging</code>去除再引入<code>spring-boot-starter-web</code>，否则后面引入的<code>starter</code>模块带有的<code>logging</code>不会自动去除</p>
<h3 id="application-yml简单配置"><a href="#application-yml简单配置" class="headerlink" title="application.yml简单配置"></a>application.yml简单配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">logging:</span><br><span class="line">  config: classpath:log4j2.xml # 指定log4j2配置文件的路径，默认就是这个</span><br><span class="line">  pattern:</span><br><span class="line">    console: &quot;%clr&#123;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;&#125;&#123;faint&#125; | %clr&#123;%5p&#125; | %clr&#123;%15.15t&#125;&#123;faint&#125; | %clr&#123;%-50.50c&#123;1.&#125;&#125;&#123;cyan&#125; | %5L | %clr&#123;%M&#125;&#123;magenta&#125; | %msg%n%xwEx&quot; # 控制台日志输出格式</span><br></pre></td></tr></table></figure>
<h3 id="log4j2-xml配置"><a href="#log4j2-xml配置" class="headerlink" title="log4j2.xml配置"></a>log4j2.xml配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!-- Configuration后面的status，这个用于设置log4j2自身内部的信息输出，可以不设置，当设置成trace时，</span><br><span class="line">     你会看到log4j2内部各种详细输出。可以设置成OFF(关闭) 或 Error(只输出错误信息)。</span><br><span class="line">     30s 刷新此配置</span><br><span class="line">--&gt;</span><br><span class="line">&lt;configuration status=&quot;OFF&quot; monitorInterval=&quot;30&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 日志文件目录、压缩文件目录、日志格式配置 --&gt;</span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;Property name=&quot;fileName&quot;&gt;/home/ybd/logs&lt;/Property&gt;</span><br><span class="line">        &lt;Property name=&quot;fileGz&quot;&gt;/home/ybd/logs/7z&lt;/Property&gt;</span><br><span class="line">        &lt;Property name=&quot;PID&quot;&gt;????&lt;/Property&gt;</span><br><span class="line">        &lt;!--&lt;Property name=&quot;LOG_PATTERN&quot;&gt;%clr&#123;%d&#123;yyyy-MM-dd HH:mm:ss.SSS z&#125;&#125;&#123;faint&#125; %clr&#123;%5p&#125; %clr&#123;$&#123;sys:PID&#125;&#125;&#123;magenta&#125;</span><br><span class="line">            %clr&#123;-&amp;#45;&amp;#45;&#125;&#123;faint&#125; %clr&#123;[%t]&#125;&#123;faint&#125; %clr&#123;%-40.40c&#123;1.&#125;&#125;&#123;cyan&#125; %clr&#123;:&#125;&#123;faint&#125; %m%n%xwEx</span><br><span class="line">        &lt;/Property&gt;--&gt;</span><br><span class="line">        &lt;Property name=&quot;LOG_PATTERN&quot;&gt;%clr&#123;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;&#125;&#123;faint&#125; | %clr&#123;%5p&#125; | %clr&#123;$&#123;sys:PID&#125;&#125;&#123;magenta&#125; | %clr&#123;%15.15t&#125;&#123;faint&#125; | %clr&#123;%-50.50c&#123;1.&#125;&#125;&#123;cyan&#125; | %5L | %clr&#123;%M&#125;&#123;magenta&#125; | %msg%n%xwEx</span><br><span class="line">        &lt;/Property&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;Appenders&gt;</span><br><span class="line">        &lt;!-- 输出控制台日志的配置 --&gt;</span><br><span class="line">        &lt;Console name=&quot;console&quot; target=&quot;SYSTEM_OUT&quot;&gt;</span><br><span class="line">            &lt;!--控制台只输出level及以上级别的信息（onMatch），其他的直接拒绝（onMismatch）--&gt;</span><br><span class="line">            &lt;ThresholdFilter level=&quot;info&quot; onMatch=&quot;ACCEPT&quot; onMismatch=&quot;DENY&quot;/&gt;</span><br><span class="line">            &lt;!-- 输出日志的格式 --&gt;</span><br><span class="line">            &lt;PatternLayout pattern=&quot;$&#123;LOG_PATTERN&#125;&quot; charset=&quot;UTF-8&quot;/&gt;</span><br><span class="line">        &lt;/Console&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- 打印出所有的信息，每次大小超过size，则这size大小的日志会自动存入按年份-月份建立的文件夹下面并进行压缩，作为存档 --&gt;</span><br><span class="line">        &lt;RollingRandomAccessFile name=&quot;infoFile&quot; fileName=&quot;$&#123;fileName&#125;/web-info.log&quot; immediateFlush=&quot;false&quot;</span><br><span class="line">                                 filePattern=&quot;$&#123;fileGz&#125;/$$&#123;date:yyyy-MM&#125;/%d&#123;yyyy-MM-dd&#125;-%i.web-info.gz&quot;&gt;</span><br><span class="line">            &lt;PatternLayout pattern=&quot;$&#123;LOG_PATTERN&#125;&quot; charset=&quot;UTF-8&quot;/&gt;</span><br><span class="line"></span><br><span class="line">            &lt;Policies&gt;</span><br><span class="line">                &lt;SizeBasedTriggeringPolicy size=&quot;20 MB&quot;/&gt;</span><br><span class="line">            &lt;/Policies&gt;</span><br><span class="line"></span><br><span class="line">            &lt;Filters&gt;</span><br><span class="line">                &lt;!-- 只记录info和warn级别信息 --&gt;</span><br><span class="line">                &lt;ThresholdFilter level=&quot;error&quot; onMatch=&quot;DENY&quot; onMismatch=&quot;NEUTRAL&quot;/&gt;</span><br><span class="line">                &lt;ThresholdFilter level=&quot;info&quot; onMatch=&quot;ACCEPT&quot; onMismatch=&quot;DENY&quot;/&gt;</span><br><span class="line">            &lt;/Filters&gt;</span><br><span class="line"></span><br><span class="line">            &lt;!-- 指定每天的最大压缩包个数，默认7个，超过了会覆盖之前的 --&gt;</span><br><span class="line">            &lt;DefaultRolloverStrategy max=&quot;50&quot;/&gt;</span><br><span class="line">        &lt;/RollingRandomAccessFile&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- 存储所有error信息 --&gt;</span><br><span class="line">        &lt;RollingRandomAccessFile name=&quot;errorFile&quot; fileName=&quot;$&#123;fileName&#125;/web-error.log&quot; immediateFlush=&quot;false&quot;</span><br><span class="line">                                 filePattern=&quot;$&#123;fileGz&#125;/$$&#123;date:yyyy-MM&#125;/%d&#123;yyyy-MM-dd&#125;-%i.web-error.gz&quot;&gt;</span><br><span class="line">            &lt;PatternLayout pattern=&quot;$&#123;LOG_PATTERN&#125;&quot; charset=&quot;UTF-8&quot;/&gt;</span><br><span class="line"></span><br><span class="line">            &lt;Policies&gt;</span><br><span class="line">                &lt;SizeBasedTriggeringPolicy size=&quot;50 MB&quot;/&gt;</span><br><span class="line">            &lt;/Policies&gt;</span><br><span class="line"></span><br><span class="line">            &lt;Filters&gt;</span><br><span class="line">                &lt;!-- 只记录error级别信息 --&gt;</span><br><span class="line">                &lt;ThresholdFilter level=&quot;error&quot; onMatch=&quot;ACCEPT&quot; onMismatch=&quot;DENY&quot;/&gt;</span><br><span class="line">            &lt;/Filters&gt;</span><br><span class="line"></span><br><span class="line">            &lt;!-- 指定每天的最大压缩包个数，默认7个，超过了会覆盖之前的 --&gt;</span><br><span class="line">            &lt;DefaultRolloverStrategy max=&quot;50&quot;/&gt;</span><br><span class="line">        &lt;/RollingRandomAccessFile&gt;</span><br><span class="line">    &lt;/Appenders&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- Mixed sync/async --&gt;</span><br><span class="line">    &lt;Loggers&gt;</span><br><span class="line">    </span><br><span class="line">        &lt;!--&lt;logger name=&quot;org.apache.http&quot; level=&quot;warn&quot;/&gt;</span><br><span class="line">        &lt;logger name=&quot;org.springframework&quot; level=&quot;WARN&quot;/&gt;</span><br><span class="line">        &lt;logger name=&quot;com.ibatis&quot; level=&quot;DEBUG&quot;/&gt;</span><br><span class="line">        &lt;logger name=&quot;com.ibatis.common.jdbc.SimpleDataSource&quot; level=&quot;DEBUG&quot;/&gt;</span><br><span class="line">        &lt;logger name=&quot;com.ibatis.common.jdbc.ScriptRunner&quot; level=&quot;DEBUG&quot;/&gt;</span><br><span class="line">        &lt;logger name=&quot;com.ibatis.sqlmap.engine.impl.SqlMapClientDelegate&quot; level=&quot;DEBUG&quot;/&gt;</span><br><span class="line">        &lt;logger name=&quot;java.sql.Connection&quot; level=&quot;DEBUG&quot; additivity=&quot;true&quot;/&gt;</span><br><span class="line">        &lt;logger name=&quot;java.sql.Statement&quot; level=&quot;DEBUG&quot; additivity=&quot;true&quot;/&gt;</span><br><span class="line">        &lt;logger name=&quot;java.sql.PreparedStatement&quot; level=&quot;=debug,stdout&quot; additivity=&quot;true&quot;/&gt;</span><br><span class="line">        &lt;logger name=&quot;java.sql.ResultSet&quot; level=&quot;DEBUG&quot; additivity=&quot;true&quot;/&gt;</span><br><span class="line">        &lt;logger name=&quot;org.apache&quot; level=&quot;WARN&quot;/&gt;</span><br><span class="line"></span><br><span class="line">        &amp;lt;!&amp;ndash; 对包进行更详细的配置 &amp;ndash;&amp;gt;</span><br><span class="line">        &amp;lt;!&amp;ndash; additivity表示是否追加,防止重复,因为root已经接收过一次了 &amp;ndash;&amp;gt;</span><br><span class="line">        &lt;logger name=&quot;com.my.blog.website.dao&quot; level=&quot;DEBUG&quot; additivity=&quot;true&quot;&gt;</span><br><span class="line">            &lt;appender-ref ref=&quot;db_log&quot;/&gt;</span><br><span class="line">        &lt;/logger&gt;</span><br><span class="line">        &lt;logger name=&quot;com.my.blog.website.controller&quot; level=&quot;DEBUG&quot; additivity=&quot;false&quot;&gt;</span><br><span class="line">            &lt;appender-ref ref=&quot;service_log&quot;/&gt;</span><br><span class="line">        &lt;/logger&gt;</span><br><span class="line">        &lt;logger name=&quot;com.my.blog.website.service&quot; level=&quot;DEBUG&quot; additivity=&quot;false&quot;&gt;</span><br><span class="line">            &lt;appender-ref ref=&quot;service_log&quot;/&gt;</span><br><span class="line">        &lt;/logger&gt;--&gt;</span><br><span class="line"></span><br><span class="line">        &lt;AsyncRoot level=&quot;debug&quot; includeLocation=&quot;true&quot;&gt;</span><br><span class="line">            &lt;AppenderRef ref=&quot;console&quot;/&gt;</span><br><span class="line">            &lt;AppenderRef ref=&quot;infoFile&quot;/&gt;</span><br><span class="line">            &lt;AppenderRef ref=&quot;errorFile&quot;/&gt;</span><br><span class="line">        &lt;/AsyncRoot&gt;</span><br><span class="line">    &lt;/Loggers&gt;</span><br><span class="line"></span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>
<h3 id="也可以使用log4j2-yml"><a href="#也可以使用log4j2-yml" class="headerlink" title="也可以使用log4j2.yml"></a>也可以使用log4j2.yml</h3><p>需要引入依赖以识别：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 加上这个才能辨认到log4j2.yml文件 --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.fasterxml.jackson.dataformat&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jackson-dataformat-yaml&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p><code>log4j2.yml</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">Configuration:</span><br><span class="line">  status: &quot;OFF&quot;</span><br><span class="line">  monitorInterval: 10</span><br><span class="line"></span><br><span class="line">  Properties:</span><br><span class="line">    Property:</span><br><span class="line">      - name: log.level.console</span><br><span class="line">        value: debug</span><br><span class="line">      - name: PID</span><br><span class="line">        value: ????</span><br><span class="line">      - name: LOG_PATTERN</span><br><span class="line">        value: &quot;%clr&#123;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;&#125;&#123;faint&#125; | %clr&#123;%5p&#125; | %clr&#123;$&#123;sys:PID&#125;&#125;&#123;magenta&#125; | %clr&#123;%15.15t&#125;&#123;faint&#125; | %clr&#123;%-50.50c&#123;1.&#125;&#125;&#123;cyan&#125; | %5L | %clr&#123;%M&#125;&#123;magenta&#125; | %msg%n%xwEx&quot;</span><br><span class="line"></span><br><span class="line">  Appenders:</span><br><span class="line">    Console:  #输出到控制台</span><br><span class="line">      name: CONSOLE</span><br><span class="line">      target: SYSTEM_OUT</span><br><span class="line">      ThresholdFilter:</span><br><span class="line">        level: $&#123;sys:log.level.console&#125; # “sys:”表示：如果VM参数中没指定这个变量值，则使用本文件中定义的缺省全局变量值</span><br><span class="line">        onMatch: ACCEPT</span><br><span class="line">        onMismatch: DENY</span><br><span class="line">      PatternLayout:</span><br><span class="line">        pattern: $&#123;LOG_PATTERN&#125;</span><br><span class="line">        charset: UTF-8</span><br><span class="line">  Loggers:</span><br><span class="line">    Root:</span><br><span class="line">      level: info</span><br><span class="line">      includeLocation: true</span><br><span class="line">      AppenderRef:</span><br><span class="line">        - ref: CONSOLE</span><br><span class="line">    AsyncRoot:</span><br><span class="line">      level: info</span><br><span class="line">      includeLocation: true</span><br><span class="line">      AppenderRef:</span><br><span class="line">        - ref: CONSOLE</span><br></pre></td></tr></table></figure>
<p>更多配置请参照：<em><a href="http://logging.apache.org/log4j/2.x/manual/layouts.html" rel="external nofollow noopener noreferrer" target="_blank">http://logging.apache.org/log4j/2.x/manual/layouts.html</a></em></p>
<h2 id="日志配置文件中获取Application配置项"><a href="#日志配置文件中获取Application配置项" class="headerlink" title="日志配置文件中获取Application配置项"></a>日志配置文件中获取Application配置项</h2><h3 id="Logback"><a href="#Logback" class="headerlink" title="Logback"></a>Logback</h3><p>方法1: 使用<code>logback-spring.xml</code>，因为<code>logback.xml</code>加载早于<code>application.properties</code>，所以如果你在<code>logback.xml</code>使用了变量时，而恰好这个变量是写在<code>application.properties</code>时，那么就会获取不到，只要改成<code>logback-spring.xml</code>就可以解决。</p>
<p>方法2: 使用<code>&lt;springProperty&gt;</code>标签，例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;springProperty scope=&quot;context&quot; name=&quot;LOG_HOME&quot; source=&quot;logback.file&quot;/&gt;</span><br></pre></td></tr></table></figure>
<h3 id="Log4j2"><a href="#Log4j2" class="headerlink" title="Log4j2"></a>Log4j2</h3><p>只能写一个Lookup：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">@SuppressWarnings(&quot;unused&quot;)</span><br><span class="line">@Plugin(name = &quot;spring&quot;, category = StrLookup.CATEGORY)</span><br><span class="line">public class SpringEnvironmentLookup extends AbstractLookup &#123;</span><br><span class="line">	private static LinkedHashMap profileYmlData;</span><br><span class="line">	private static LinkedHashMap metaYmlData;</span><br><span class="line">	private static boolean profileExist;</span><br><span class="line">	private static Map&lt;String, String&gt; map = new HashMap&lt;&gt;(16);</span><br><span class="line">	private static final String META_PROFILE = &quot;application.yml&quot;;</span><br><span class="line">	private static final String PROFILE_PREFIX = &quot;application&quot;;</span><br><span class="line">	private static final String PROFILE_SUFFIX = &quot;.yml&quot;;</span><br><span class="line">	private static final String DEFAULT_PROFILE = &quot;application-dev.yml&quot;;</span><br><span class="line">	private static final String SPRING_PROFILES_ACTIVE = &quot;spring.profiles.active&quot;;</span><br><span class="line"></span><br><span class="line">	static &#123;</span><br><span class="line">		try &#123;</span><br><span class="line">			metaYmlData = new Yaml().loadAs(new ClassPathResource(META_PROFILE).getInputStream(), LinkedHashMap.class);</span><br><span class="line">			Properties properties = System.getProperties();</span><br><span class="line">			String active = properties.getProperty(SPRING_PROFILES_ACTIVE);</span><br><span class="line">			if (isBlank(active)) &#123;</span><br><span class="line">				active = getValueFromData(SPRING_PROFILES_ACTIVE, SPRING_PROFILES_ACTIVE.split(&quot;\\.&quot;), metaYmlData);</span><br><span class="line">			&#125;</span><br><span class="line">			String configName = isNotBlank(active) ? PROFILE_PREFIX + &quot;-&quot; + active + PROFILE_SUFFIX : DEFAULT_PROFILE;</span><br><span class="line">			ClassPathResource classPathResource = new ClassPathResource(configName);</span><br><span class="line">			profileExist = classPathResource.exists();</span><br><span class="line">			if (profileExist) &#123;</span><br><span class="line">				profileYmlData = new Yaml().loadAs(classPathResource.getInputStream(), LinkedHashMap.class);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; catch (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			throw new RuntimeException(&quot;SpringEnvironmentLookup initialize fail&quot;);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public String lookup(LogEvent event, String key) &#123;</span><br><span class="line">		return map.computeIfAbsent(key, SpringEnvironmentLookup::resolveYmlMapByKey);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	private static String resolveYmlMapByKey(String key) &#123;</span><br><span class="line">		Assert.isTrue(isNotBlank(key), &quot;key can not be blank!&quot;);</span><br><span class="line">		String[] keyChain = key.split(&quot;\\.&quot;);</span><br><span class="line">		String value = null;</span><br><span class="line">		if (profileExist) &#123;</span><br><span class="line">			value = getValueFromData(key, keyChain, profileYmlData);</span><br><span class="line">		&#125;</span><br><span class="line">		if (isBlank(value)) &#123;</span><br><span class="line">			value = getValueFromData(key, keyChain, metaYmlData);</span><br><span class="line">		&#125;</span><br><span class="line">		return value;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	private static String getValueFromData(String key, String[] keyChain, LinkedHashMap dataMap) &#123;</span><br><span class="line">		int length = keyChain.length;</span><br><span class="line">		if (length == 1) &#123;</span><br><span class="line">			return getFinalValue(key, dataMap);</span><br><span class="line">		&#125;</span><br><span class="line">		String k;</span><br><span class="line">		LinkedHashMap[] mapChain = new LinkedHashMap[length];</span><br><span class="line">		mapChain[0] = dataMap;</span><br><span class="line">		for (int i = 0; i &lt; length; i++) &#123;</span><br><span class="line">			if (i == length - 1) &#123;</span><br><span class="line">				return getFinalValue(keyChain[i], mapChain[i]);</span><br><span class="line">			&#125;</span><br><span class="line">			k = keyChain[i];</span><br><span class="line">			Object o = mapChain[i].get(k);</span><br><span class="line">			if (Objects.isNull(o)) &#123;</span><br><span class="line">				return &quot;&quot;;</span><br><span class="line">			&#125;</span><br><span class="line">			if (o instanceof LinkedHashMap) &#123;</span><br><span class="line">				mapChain[i + 1] = (LinkedHashMap) o;</span><br><span class="line">			&#125; else &#123;</span><br><span class="line">				throw new IllegalArgumentException();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		return &quot;&quot;;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	private static String getFinalValue(String k, LinkedHashMap ymlData) &#123;</span><br><span class="line">		return defaultIfNull((String) ymlData.get(k), &quot;&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在<code>log4j2.xml</code>中这样使用 <code>${spring:spring.application.name}</code></p>
<h1 id="查看依赖树"><a href="#查看依赖树" class="headerlink" title="查看依赖树"></a>查看依赖树</h1><p>如果引入了某些jar包带有<code>logback</code>依赖，log4j2会失效，需要通过IDEA或Maven查找排除依赖：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn dependency:tree</span><br></pre></td></tr></table></figure>
<h1 id="Spring-MVC-相关"><a href="#Spring-MVC-相关" class="headerlink" title="Spring MVC 相关"></a>Spring MVC 相关</h1><h2 id="Spring-MVC集成fastjson"><a href="#Spring-MVC集成fastjson" class="headerlink" title="Spring MVC集成fastjson"></a>Spring MVC集成fastjson</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;fastjson&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.2.46&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>两种方式：</p>
<h3 id="方式一、实现WebMvcConfigurer"><a href="#方式一、实现WebMvcConfigurer" class="headerlink" title="方式一、实现WebMvcConfigurer"></a>方式一、实现<code>WebMvcConfigurer</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class WebMvcMessageConvertConfig implements WebMvcConfigurer &#123;</span><br><span class="line">	@Override</span><br><span class="line">	public void configureMessageConverters(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters) &#123;</span><br><span class="line">		FastJsonHttpMessageConverter fastConverter = new FastJsonHttpMessageConverter();</span><br><span class="line"></span><br><span class="line">		SerializeConfig serializeConfig = SerializeConfig.globalInstance;</span><br><span class="line">		serializeConfig.put(BigInteger.class, ToStringSerializer.instance);</span><br><span class="line">		serializeConfig.put(Long.class, ToStringSerializer.instance);</span><br><span class="line">		serializeConfig.put(Long.TYPE, ToStringSerializer.instance);</span><br><span class="line"></span><br><span class="line">		FastJsonConfig fastJsonConfig = new FastJsonConfig();</span><br><span class="line">		fastJsonConfig.setCharset(Charset.forName(&quot;UTF-8&quot;));</span><br><span class="line">		fastJsonConfig.setSerializeConfig(serializeConfig);</span><br><span class="line">		fastJsonConfig.setSerializerFeatures(SerializerFeature.PrettyFormat);</span><br><span class="line">		fastJsonConfig.setDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);</span><br><span class="line"></span><br><span class="line">		fastConverter.setFastJsonConfig(fastJsonConfig);</span><br><span class="line"></span><br><span class="line">		converters.add(fastConverter);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="方式二、通过-Bean方式"><a href="#方式二、通过-Bean方式" class="headerlink" title="方式二、通过@Bean方式"></a>方式二、通过<code>@Bean</code>方式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class WebMvcMessageConvertConfig &#123;</span><br><span class="line">	@Bean</span><br><span class="line">	public HttpMessageConverters fastJsonHttpMessageConverter() &#123;</span><br><span class="line">		FastJsonHttpMessageConverter fastConverter = new FastJsonHttpMessageConverter();</span><br><span class="line"></span><br><span class="line">		SerializeConfig serializeConfig = SerializeConfig.globalInstance;</span><br><span class="line">		serializeConfig.put(BigInteger.class, ToStringSerializer.instance);</span><br><span class="line">		serializeConfig.put(Long.class, ToStringSerializer.instance);</span><br><span class="line">		serializeConfig.put(Long.TYPE, ToStringSerializer.instance);</span><br><span class="line"></span><br><span class="line">		FastJsonConfig fastJsonConfig = new FastJsonConfig();</span><br><span class="line">		fastJsonConfig.setCharset(Charset.forName(Constant.CHARSET));</span><br><span class="line">		fastJsonConfig.setSerializeConfig(serializeConfig);</span><br><span class="line">		fastJsonConfig.setSerializerFeatures(SerializerFeature.PrettyFormat);</span><br><span class="line">		fastJsonConfig.setDateFormat(Constant.DATE_FORMAT);</span><br><span class="line"></span><br><span class="line">		fastConverter.setFastJsonConfig(fastJsonConfig);</span><br><span class="line">		return new HttpMessageConverters((HttpMessageConverter&lt;?&gt;) fastConverter);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="WebFlux"><a href="#WebFlux" class="headerlink" title="WebFlux"></a>WebFlux</h3><p>上面针对的是Web MVC，<strong>对于Webflux目前不支持这种方式</strong>，只能先这么设置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  jackson:</span><br><span class="line">    default-property-inclusion: non_null # 过滤值为null的字段</span><br><span class="line">    date-format: &quot;yyyy-MM-dd HH:mm:ss&quot;</span><br></pre></td></tr></table></figure>
<h2 id="Spring-Boot-MVC特性"><a href="#Spring-Boot-MVC特性" class="headerlink" title="Spring Boot MVC特性"></a>Spring Boot MVC特性</h2><p>Spring boot 在spring默认基础上，自动配置添加了以下特性</p>
<ul>
<li>包含了<code>ContentNegotiatingViewResolver</code>和<code>BeanNameViewResolver</code> beans。</li>
<li>对静态资源的支持，包括对WebJars的支持。</li>
<li>自动注册<code>Converter</code>，<code>GenericConverter</code>，<code>Formatter</code> beans。</li>
<li>对<code>HttpMessageConverters</code>的支持。</li>
<li>自动注册<code>MessageCodeResolver</code>。</li>
<li>对静态<code>index.html</code>的支持。</li>
<li>对自定义<code>Favicon</code>的支持。</li>
<li>主动使用<code>ConfigurableWebBindingInitializer</code> bean</li>
</ul>
<h2 id="模板引擎的选择"><a href="#模板引擎的选择" class="headerlink" title="模板引擎的选择"></a>模板引擎的选择</h2><ul>
<li>FreeMarker</li>
<li>Thymeleaf</li>
<li>Velocity (1.4版本之后弃用，Spring Framework 4.3版本之后弃用)</li>
<li>Groovy</li>
<li>Mustache</li>
</ul>
<p>注：<strong>jsp应该尽量避免使用</strong>，原因如下：</p>
<ul>
<li>jsp只能打包为：war格式，不支持jar格式，只能在标准的容器里面跑（tomcat，jetty都可以）</li>
<li>内嵌的Jetty目前不支持JSPs</li>
<li>Undertow不支持jsps</li>
<li>jsp自定义错误页面不能覆盖spring boot 默认的错误页面</li>
</ul>
<h2 id="开启GZIP算法压缩响应流"><a href="#开启GZIP算法压缩响应流" class="headerlink" title="开启GZIP算法压缩响应流"></a>开启GZIP算法压缩响应流</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  compression:</span><br><span class="line">    enabled: true # 启用压缩</span><br><span class="line">    min-response-size: 2048 # 对应Content-Length，超过这个值才会压缩</span><br></pre></td></tr></table></figure>
<h2 id="全局异常处理"><a href="#全局异常处理" class="headerlink" title="全局异常处理"></a>全局异常处理</h2><h3 id="方式一：添加自定义的错误页面"><a href="#方式一：添加自定义的错误页面" class="headerlink" title="方式一：添加自定义的错误页面"></a>方式一：添加自定义的错误页面</h3><ul>
<li>html静态页面：在<code>resources/public/error/</code> 下定义. 如添加404页面： <code>resources/public/error/404.html</code>页面，中文注意页面编码</li>
<li>模板引擎页面：在<code>templates/error/</code>下定义. 如添加5xx页面： <code>templates/error/5xx.ftl</code></li>
</ul>
<blockquote>
<p>注：<code>templates/error/</code> 这个的优先级比较<code>resources/public/error/</code>高</p>
</blockquote>
<h3 id="方式二：通过-ControllerAdvice"><a href="#方式二：通过-ControllerAdvice" class="headerlink" title="方式二：通过@ControllerAdvice"></a>方式二：通过@ControllerAdvice</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">@Slf4j</span><br><span class="line">@ControllerAdvice</span><br><span class="line">//@RestControllerAdvice</span><br><span class="line">public class ErrorExceptionHandler &#123;</span><br><span class="line"></span><br><span class="line">	@ExceptionHandler(&#123; RuntimeException.class &#125;)</span><br><span class="line">	@ResponseStatus(HttpStatus.OK)</span><br><span class="line">	public ModelAndView processException(RuntimeException exception) &#123;</span><br><span class="line">		log.info(&quot;自定义异常处理-RuntimeException&quot;);</span><br><span class="line">		ModelAndView m = new ModelAndView();</span><br><span class="line">		m.addObject(&quot;roncooException&quot;, exception.getMessage());</span><br><span class="line">		m.setViewName(&quot;error/500&quot;);</span><br><span class="line">		return m;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@ExceptionHandler(&#123; Exception.class &#125;)</span><br><span class="line">	@ResponseStatus(HttpStatus.OK)</span><br><span class="line">	public ModelAndView processException(Exception exception) &#123;</span><br><span class="line">		log.info(&quot;自定义异常处理-Exception&quot;);</span><br><span class="line">		ModelAndView m = new ModelAndView();</span><br><span class="line">		m.addObject(&quot;roncooException&quot;, exception.getMessage());</span><br><span class="line">		m.setViewName(&quot;error/500&quot;);</span><br><span class="line">		return m;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="静态资源"><a href="#静态资源" class="headerlink" title="静态资源"></a>静态资源</h2><p>设置静态资源放到指定路径下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.resources.static-locations=classpath:/META-INF/resources/,classpath:/static/</span><br></pre></td></tr></table></figure>
<h2 id="自定义消息转化器"><a href="#自定义消息转化器" class="headerlink" title="自定义消息转化器"></a>自定义消息转化器</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">   public StringHttpMessageConverter stringHttpMessageConverter() &#123;</span><br><span class="line">       StringHttpMessageConverter converter = new StringHttpMessageConverter(Charset.forName(&quot;UTF-8&quot;));</span><br><span class="line">       return converter;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h2 id="自定义SpringMVC的拦截器"><a href="#自定义SpringMVC的拦截器" class="headerlink" title="自定义SpringMVC的拦截器"></a>自定义SpringMVC的拦截器</h2><p>有些时候我们需要自己配置SpringMVC而不是采用默认，比如增加一个拦截器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">public class MyInterceptor implements HandlerInterceptor &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void afterCompletion(HttpServletRequest arg0, HttpServletResponse arg1, Object arg2, Exception arg3)</span><br><span class="line">            throws Exception &#123;</span><br><span class="line">        System.out.println(&quot;拦截器MyInterceptor-------&gt;3、请求结束之后被调用，主要用于清理工作。&quot;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void postHandle(HttpServletRequest arg0, HttpServletResponse arg1, Object arg2, ModelAndView arg3)</span><br><span class="line">            throws Exception &#123;</span><br><span class="line">        System.out.println(&quot;拦截器MyInterceptor-------&gt;2、请求之后调用，在视图渲染之前，也就是Controller方法调用之后&quot;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean preHandle(HttpServletRequest arg0, HttpServletResponse arg1, Object arg2) throws Exception &#123;</span><br><span class="line">        System.out.println(&quot;拦截器MyInterceptor-------&gt;1、请求之前调用，也就是Controller方法调用之前。&quot;);</span><br><span class="line">        return true;//返回true则继续向下执行，返回false则取消当前请求</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class InterceptorConfigurerAdapter extends WebMvcConfigurer &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 该方法用于注册拦截器</span><br><span class="line">     * 可注册多个拦截器，多个拦截器组成一个拦截器链</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public void addInterceptors(InterceptorRegistry registry) &#123;</span><br><span class="line">        // addPathPatterns 添加路径</span><br><span class="line">        // excludePathPatterns 排除路径</span><br><span class="line">        registry.addInterceptor(new MyInterceptor()).addPathPatterns(&quot;/*.*&quot;);</span><br><span class="line">        super.addInterceptors(registry);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="创建-Servlet、-Filter、Listener"><a href="#创建-Servlet、-Filter、Listener" class="headerlink" title="创建 Servlet、 Filter、Listener"></a>创建 Servlet、 Filter、Listener</h2><h3 id="注解方式"><a href="#注解方式" class="headerlink" title="注解方式"></a>注解方式</h3><blockquote>
<p>直接通过<code>@WebServlet</code>、<code>@WebFilter</code>、<code>@WebListener</code> 注解自动注册</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@WebFilter(filterName = &quot;customFilter&quot;, urlPatterns = &quot;/*&quot;)</span><br><span class="line">public class CustomFilter implements Filter &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@WebListener</span><br><span class="line">public class CustomListener implements ServletContextListener &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@WebServlet(name = &quot;customServlet&quot;, urlPatterns = &quot;/roncoo&quot;)</span><br><span class="line">public class CustomServlet extends HttpServlet &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后需要在<code>**Application.java</code> 加上<code>@ServletComponentScan</code>注解，否则不会生效。</p>
<p><strong>注意：如果同时添加了<code>@WebFilter</code>以及<code>@Component</code>，那么会初始化两次Filter，并且会过滤所有路径+自己指定的路径 ，便会出现对没有指定的URL也会进行过滤</strong></p>
<h3 id="通过编码注册"><a href="#通过编码注册" class="headerlink" title="通过编码注册"></a>通过编码注册</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class WebConfig &#123;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public FilterRegistrationBean myFilter()&#123;</span><br><span class="line">        FilterRegistrationBean registrationBean = new FilterRegistrationBean();</span><br><span class="line">        MyFilter filter = new MyFilter();</span><br><span class="line">        registrationBean.setFilter(filter);</span><br><span class="line"></span><br><span class="line">        List&lt;String&gt; urlPatterns = new ArrayList&lt;&gt;();</span><br><span class="line">        urlPatterns.add(&quot;/*&quot;);</span><br><span class="line">        registrationBean.setUrlPatterns(urlPatterns);</span><br><span class="line">        registrationBean.setOrder(1);</span><br><span class="line"></span><br><span class="line">        return registrationBean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public ServletRegistrationBean myServlet() &#123;</span><br><span class="line">        MyServlet demoServlet = new MyServlet();</span><br><span class="line">        ServletRegistrationBean registrationBean = new ServletRegistrationBean();</span><br><span class="line">        registrationBean.setServlet(demoServlet);</span><br><span class="line">        List&lt;String&gt; urlMappings = new ArrayList&lt;String&gt;();</span><br><span class="line">        urlMappings.add(&quot;/myServlet&quot;);////访问，可以添加多个</span><br><span class="line">        registrationBean.setUrlMappings(urlMappings);</span><br><span class="line">        registrationBean.setLoadOnStartup(1);</span><br><span class="line">        return registrationBean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public ServletListenerRegistrationBean myListener() &#123;</span><br><span class="line">        ServletListenerRegistrationBean registrationBean</span><br><span class="line">                = new ServletListenerRegistrationBean&lt;&gt;();</span><br><span class="line">        registrationBean.setListener(new MyListener());</span><br><span class="line">        registrationBean.setOrder(1);</span><br><span class="line">        return registrationBean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Spring-Interceptor与Servlet-Filter的区别"><a href="#Spring-Interceptor与Servlet-Filter的区别" class="headerlink" title="Spring Interceptor与Servlet Filter的区别"></a>Spring Interceptor与Servlet Filter的区别</h2><ul>
<li>Filter是基于函数回调的，而Interceptor则是基于Java反射的。</li>
<li>Filter依赖于Servlet容器，而Interceptor不依赖于Servlet容器。</li>
<li>Filter对几乎所有的请求起作用，而Interceptor只能对action请求起作用。</li>
<li>Interceptor可以访问Action的上下文，值栈里的对象，而Filter不能。</li>
<li>在action的生命周期里，Interceptor可以被多次调用，而Filter只能在容器初始化时调用一次。</li>
</ul>
<p><img src="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/mvc-process.png" alt=""></p>
<h1 id="Validation"><a href="#Validation" class="headerlink" title="Validation"></a>Validation</h1><h2 id="常用注解（大部分JSR中已有）"><a href="#常用注解（大部分JSR中已有）" class="headerlink" title="常用注解（大部分JSR中已有）"></a>常用注解（大部分<strong>JSR</strong>中已有）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">@Null   被注释的元素必须为 null    </span><br><span class="line">@NotNull    被注释的元素必须不为 null    </span><br><span class="line">@AssertTrue     被注释的元素必须为 true    </span><br><span class="line">@AssertFalse    被注释的元素必须为 false    </span><br><span class="line">@Min(value)     被注释的元素必须是一个数字，其值必须大于等于指定的最小值    </span><br><span class="line">@Max(value)     被注释的元素必须是一个数字，其值必须小于等于指定的最大值    </span><br><span class="line">@DecimalMin(value)  被注释的元素必须是一个数字，其值必须大于等于指定的最小值    </span><br><span class="line">@DecimalMax(value)  被注释的元素必须是一个数字，其值必须小于等于指定的最大值    </span><br><span class="line">@Size(max=, min=)   被注释的元素的大小必须在指定的范围内    </span><br><span class="line">@Digits (integer, fraction)     被注释的元素必须是一个数字，其值必须在可接受的范围内    </span><br><span class="line">@Past   被注释的元素必须是一个过去的日期    </span><br><span class="line">@Future     被注释的元素必须是一个将来的日期    </span><br><span class="line">@Pattern(regex=,flag=)  被注释的元素必须符合指定的正则表达式</span><br><span class="line">@NotBlank(message =)   验证字符串非null，且长度必须大于0    </span><br><span class="line">@Email  被注释的元素必须是电子邮箱地址    </span><br><span class="line">@Length(min=,max=)  被注释的字符串的大小必须在指定的范围内    </span><br><span class="line">@NotEmpty   被注释的字符串的必须非空    </span><br><span class="line">@Range(min=,max=,message=)  被注释的元素必须在合适的范围内</span><br></pre></td></tr></table></figure>
<h2 id="简单使用"><a href="#简单使用" class="headerlink" title="简单使用"></a>简单使用</h2><p>实体：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@Data</span><br><span class="line">public class Foo &#123;</span><br><span class="line">	@NotBlank</span><br><span class="line">	private String name;</span><br><span class="line"></span><br><span class="line">	@Min(18)</span><br><span class="line">	private Integer age;</span><br><span class="line"></span><br><span class="line">	@Pattern(regexp = &quot;^1([34578])\\d&#123;9&#125;$&quot;,message = &quot;手机号码格式错误&quot;)</span><br><span class="line">	@NotBlank(message = &quot;手机号码不能为空&quot;)</span><br><span class="line">	private String phone;</span><br><span class="line"></span><br><span class="line">	@Email(message = &quot;邮箱格式错误&quot;)</span><br><span class="line">	private String email;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>Controller</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">@Slf4j</span><br><span class="line">public class FooController &#123;</span><br><span class="line"></span><br><span class="line">   @PostMapping(&quot;/foo&quot;)</span><br><span class="line">   public String foo(@Validated Foo foo, BindingResult bindingResult) &#123;</span><br><span class="line">      log.info(&quot;foo: &#123;&#125;&quot;, foo);</span><br><span class="line">      if (bindingResult.hasErrors()) &#123;</span><br><span class="line">         for (FieldError fieldError : bindingResult.getFieldErrors()) &#123;</span><br><span class="line">            log.error(&quot;valid fail: field = &#123;&#125;, message = &#123;&#125;&quot;, fieldError.getField(), fieldError.getDefaultMessage());</span><br><span class="line">         &#125;</span><br><span class="line">         return &quot;fail&quot;;</span><br><span class="line">      &#125;</span><br><span class="line">      return &quot;success&quot;;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="快速失效"><a href="#快速失效" class="headerlink" title="快速失效"></a>快速失效</h2><p>一般情况下，Validator并不会应为第一个校验失败为停止，而是一直校验完所有参数。我们可以通过设置快速失效：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class ValidatorConfiguration &#123;</span><br><span class="line">	@Bean</span><br><span class="line">	public Validator validator()&#123;</span><br><span class="line">		ValidatorFactory validatorFactory = Validation.byProvider( HibernateValidator.class )</span><br><span class="line">													  .configure()</span><br><span class="line">													  .failFast( true )</span><br><span class="line">//													  .addProperty( &quot;hibernate.validator.fail_fast&quot;, &quot;true&quot; )</span><br><span class="line">													  .buildValidatorFactory();</span><br><span class="line">		return validatorFactory.getValidator();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样在遇到第一个校验失败的时候就会停止对之后的参数校验。</p>
<h2 id="分组校验"><a href="#分组校验" class="headerlink" title="分组校验"></a>分组校验</h2><blockquote>
<p>如果同一个类，在不同的使用场景下有不同的校验规则，那么可以使用分组校验。未成年人是不能喝酒的，而在其他场景下我们不做特殊的限制，这个需求如何体现同一个实体，不同的校验规则呢？</p>
</blockquote>
<p>添加分组：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Class Foo&#123;</span><br><span class="line">	@Min(value = 18,groups = &#123;Adult.class&#125;)</span><br><span class="line">	private Integer age;</span><br><span class="line">	</span><br><span class="line">	public interface Adult&#123;&#125;</span><br><span class="line">	</span><br><span class="line">	public interface Minor&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>Controller</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(&quot;/drink&quot;)</span><br><span class="line">public String drink(@Validated(&#123;Foo.Adult.class&#125;) Foo foo, BindingResult bindingResult) &#123;</span><br><span class="line">    if(bindingResult.hasErrors())&#123;</span><br><span class="line">        for (FieldError fieldError : bindingResult.getFieldErrors()) &#123;</span><br><span class="line">            //...</span><br><span class="line">        &#125;</span><br><span class="line">        return &quot;fail&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    return &quot;success&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="自定义校验"><a href="#自定义校验" class="headerlink" title="自定义校验"></a>自定义校验</h2><p>业务需求总是比框架提供的这些简单校验要复杂的多，我们可以自定义校验来满足我们的需求。自定义spring validation非常简单，主要分为两步。</p>
<p>1 自定义校验注解<br>我们尝试添加一个“字符串不能包含空格”的限制。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">@Target(&#123;METHOD, FIELD, ANNOTATION_TYPE, CONSTRUCTOR, PARAMETER&#125;)</span><br><span class="line">@Retention(RUNTIME)</span><br><span class="line">@Documented</span><br><span class="line">@Constraint(validatedBy = &#123;CannotHaveBlankValidator.class&#125;)&lt;1&gt;</span><br><span class="line">public @interface CannotHaveBlank &#123;</span><br><span class="line"></span><br><span class="line">    //默认错误消息</span><br><span class="line">    String message() default &quot;不能包含空格&quot;;</span><br><span class="line"></span><br><span class="line">    //分组</span><br><span class="line">    Class&lt;?&gt;[] groups() default &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    //负载</span><br><span class="line">    Class&lt;? extends Payload&gt;[] payload() default &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    //指定多个时使用</span><br><span class="line">    @Target(&#123;FIELD, METHOD, PARAMETER, ANNOTATION_TYPE&#125;)</span><br><span class="line">    @Retention(RUNTIME)</span><br><span class="line">    @Documented</span><br><span class="line">    @interface List &#123;</span><br><span class="line">        CannotHaveBlank[] value();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们不需要关注太多东西，使用spring validation的原则便是便捷我们的开发，例如payload，List ，groups，都可以忽略。</p>
<p><code>&lt;1&gt;</code> 自定义注解中指定了这个注解真正的验证者类。</p>
<p>2 编写真正的校验者类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">public class CannotHaveBlankValidator implements &lt;1&gt; ConstraintValidator&lt;CannotHaveBlank, String&gt; &#123;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">    public void initialize(CannotHaveBlank constraintAnnotation) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    public boolean isValid(String value, ConstraintValidatorContext context &lt;2&gt;) &#123;</span><br><span class="line">        //null时不进行校验</span><br><span class="line">        if (value != null &amp;&amp; value.contains(&quot; &quot;)) &#123;</span><br><span class="line">	        &lt;3&gt;</span><br><span class="line">            //获取默认提示信息</span><br><span class="line">            String defaultConstraintMessageTemplate = context.getDefaultConstraintMessageTemplate();</span><br><span class="line">            System.out.println(&quot;default message :&quot; + defaultConstraintMessageTemplate);</span><br><span class="line">            //禁用默认提示信息</span><br><span class="line">            context.disableDefaultConstraintViolation();</span><br><span class="line">            //设置提示语</span><br><span class="line">            context.buildConstraintViolationWithTemplate(&quot;can not contains blank&quot;).addConstraintViolation();</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>&lt;1&gt;</code> 所有的验证者都需要实现<code>ConstraintValidator</code>接口，它的接口也很形象，包含一个初始化事件方法，和一个判断是否合法的方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public interface ConstraintValidator&lt;A extends Annotation, T&gt; &#123;</span><br><span class="line">	void initialize(A constraintAnnotation);</span><br><span class="line">		boolean isValid(T value, ConstraintValidatorContext context);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>&lt;2&gt;</code> <code>ConstraintValidatorContext</code> 这个上下文包含了认证中所有的信息，我们可以利用这个上下文实现获取默认错误提示信息，禁用错误提示信息，改写错误提示信息等操作。</p>
<p><code>&lt;3&gt;</code> 一些典型校验操作，或许可以对你产生启示作用。</p>
<p>值得注意的一点是，自定义注解可以用在<code>METHOD, FIELD, ANNOTATION_TYPE, CONSTRUCTOR, PARAMETER</code>之上，<code>ConstraintValidator</code>的第二个泛型参数T，是需要被校验的类型。</p>
<h2 id="手动校验"><a href="#手动校验" class="headerlink" title="手动校验"></a>手动校验</h2><p>可能在某些场景下需要我们手动校验，即使用校验器对需要被校验的实体发起validate，同步获得校验结果。理论上我们既可以使用Hibernate Validation提供Validator，也可以使用Spring对其的封装。在spring构建的项目中，提倡使用经过spring封装过后的方法，这里两种方法都介绍下：</p>
<p><strong>Hibernate Validation</strong>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Foo foo = new Foo();</span><br><span class="line">foo.setAge(22);</span><br><span class="line">foo.setEmail(&quot;000&quot;);</span><br><span class="line">ValidatorFactory vf = Validation.buildDefaultValidatorFactory();</span><br><span class="line">Validator validator = vf.getValidator();</span><br><span class="line">Set&lt;ConstraintViolation&lt;Foo&gt;&gt; set = validator.validate(foo);</span><br><span class="line">for (ConstraintViolation&lt;Foo&gt; constraintViolation : set) &#123;</span><br><span class="line">    System.out.println(constraintViolation.getMessage());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于依赖了Hibernate Validation框架，我们需要调用Hibernate相关的工厂方法来获取validator实例，从而校验。</p>
<p>在spring framework文档的Validation相关章节，可以看到如下的描述：</p>
<blockquote>
<p>Spring provides full support for the Bean Validation API. This includes convenient support for bootstrapping a JSR-303/JSR-349 Bean Validation provider as a Spring bean. This allows for a javax.validation.ValidatorFactory or javax.validation.Validator to be injected wherever validation is needed in your application. Use the LocalValidatorFactoryBean to configure a default Validator as a Spring bean:</p>
<p>bean id=”validator” class=”org.springframework.validation.beanvalidation.LocalValidatorFactoryBean”</p>
<p>The basic configuration above will trigger Bean Validation to initialize using its default bootstrap mechanism. A JSR-303/JSR-349 provider, such as Hibernate Validator, is expected to be present in the classpath and will be detected automatically.</p>
</blockquote>
<p>上面这段话主要描述了spring对validation全面支持JSR-303、JSR-349的标准，并且封装了<code>LocalValidatorFactoryBean</code>作为validator的实现。值得一提的是，这个类的责任其实是非常重大的，他兼容了spring的validation体系和hibernate的validation体系，也可以被开发者直接调用，代替上述的从工厂方法中获取的hibernate validator。由于我们使用了springboot，会触发web模块的自动配置，<code>LocalValidatorFactoryBean</code>已经成为了Validator的默认实现，使用时只需要自动注入即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@Autowired</span><br><span class="line">Validator globalValidator; &lt;1&gt;</span><br><span class="line"></span><br><span class="line">@RequestMapping(&quot;/validate&quot;)</span><br><span class="line">public String validate() &#123;</span><br><span class="line">    Foo foo = new Foo();</span><br><span class="line">    foo.setAge(22);</span><br><span class="line">    foo.setEmail(&quot;000&quot;);</span><br><span class="line"></span><br><span class="line">    Set&lt;ConstraintViolation&lt;Foo&gt;&gt; set = globalValidator.validate(foo);&lt;2&gt;</span><br><span class="line">    for (ConstraintViolation&lt;Foo&gt; constraintViolation : set) &#123;</span><br><span class="line">        System.out.println(constraintViolation.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return &quot;success&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>&lt;1&gt;</code> 真正使用过<code>Validator</code>接口的读者会发现有两个接口，一个是位于<code>javax.validation</code>包下，另一个位于<code>org.springframework.validation</code>包下，<strong>注意我们这里使用的是前者</strong><code>javax.validation</code>，后者是spring自己内置的校验接口，<code>LocalValidatorFactoryBean</code>同时实现了这两个接口。</p>
<p><code>&lt;2&gt;</code> 此处校验接口最终的实现类便是<code>LocalValidatorFactoryBean</code>。</p>
<h2 id="基于方法校验"><a href="#基于方法校验" class="headerlink" title="基于方法校验"></a>基于方法校验</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">@Validated &lt;1&gt;</span><br><span class="line">public class BarController &#123;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(&quot;/bar&quot;)</span><br><span class="line">    public @NotBlank &lt;2&gt; String bar(@Min(18) Integer age &lt;3&gt;) &#123;</span><br><span class="line">        System.out.println(&quot;age : &quot; + age);</span><br><span class="line">        return &quot;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @ExceptionHandler(ConstraintViolationException.class)</span><br><span class="line">    public Map handleConstraintViolationException(ConstraintViolationException cve)&#123;</span><br><span class="line">        Set&lt;ConstraintViolation&lt;?&gt;&gt; cves = cve.getConstraintViolations();&lt;4&gt;</span><br><span class="line">        for (ConstraintViolation&lt;?&gt; constraintViolation : cves) &#123;</span><br><span class="line">            System.out.println(constraintViolation.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        Map map = new HashMap();</span><br><span class="line">        map.put(&quot;errorCode&quot;,500);</span><br><span class="line">        return map;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>&lt;1&gt;</code> 为类添加@Validated注解</p>
<p><code>&lt;2&gt; &lt;3&gt;</code> 校验方法的返回值和入参</p>
<p><code>&lt;4&gt;</code> 添加一个异常处理器，可以获得没有通过校验的属性相关信息</p>
<p>基于方法的校验，个人不推荐使用，感觉和项目结合的不是很好。</p>
<h2 id="统一处理验证异常"><a href="#统一处理验证异常" class="headerlink" title="统一处理验证异常"></a>统一处理验证异常</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">@ControllerAdvice</span><br><span class="line">@Component</span><br><span class="line">public class GlobalExceptionHandler &#123;</span><br><span class="line"></span><br><span class="line">    @ExceptionHandler</span><br><span class="line">    @ResponseBody</span><br><span class="line">    @ResponseStatus(HttpStatus.BAD_REQUEST)</span><br><span class="line">    public String handle(ValidationException exception) &#123;</span><br><span class="line">        if(exception instanceof ConstraintViolationException)&#123;</span><br><span class="line">            ConstraintViolationException exs = (ConstraintViolationException) exception;</span><br><span class="line"></span><br><span class="line">            Set&lt;ConstraintViolation&lt;?&gt;&gt; violations = exs.getConstraintViolations();</span><br><span class="line">            for (ConstraintViolation&lt;?&gt; item : violations) &#123;</span><br><span class="line">　　　　　　　　　　/**打印验证不通过的信息*/</span><br><span class="line">                System.out.println(item.getMessage());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return &quot;bad request, &quot; ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>参考：<br><em><a href="https://www.cnkirito.moe/2017/08/16/%E4%BD%BF%E7%94%A8spring%20validation%E5%AE%8C%E6%88%90%E6%95%B0%E6%8D%AE%E5%90%8E%E7%AB%AF%E6%A0%A1%E9%AA%8C/" rel="external nofollow noopener noreferrer" target="_blank">https://www.cnkirito.moe/2017/08/16/%E4%BD%BF%E7%94%A8spring%20validation%E5%AE%8C%E6%88%90%E6%95%B0%E6%8D%AE%E5%90%8E%E7%AB%AF%E6%A0%A1%E9%AA%8C/</a></em></p>
</blockquote>
<h1 id="创建异步方法"><a href="#创建异步方法" class="headerlink" title="创建异步方法"></a>创建异步方法</h1><h2 id="启动异步"><a href="#启动异步" class="headerlink" title="启动异步"></a>启动异步</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">@EnableAsync</span><br><span class="line">public class SpringAsyncConfig &#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>配置完这个就已经具备异步方法功能了，只需要在方法上面添加<code>@Async</code>即可</p>
<p>如果被<code>@Async</code>注解的方法所在类是基于接口实现的，想要直接注入实现类，需要添加：<code>@EnableAsync(proxyTargetClass = true)</code> 以使用CGLIB代理</p>
<h2 id="编写异步方法"><a href="#编写异步方法" class="headerlink" title="编写异步方法"></a>编写异步方法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Async</span><br><span class="line">public void asyncMethodWithVoidReturnType() throws InterruptedException &#123;</span><br><span class="line">	System.out.println(&quot;Execute method asynchronously. &quot; + Thread.currentThread().getName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="配置线程池"><a href="#配置线程池" class="headerlink" title="配置线程池"></a>配置线程池</h2><p>在不配置线程池的情况下，Spring<strong>默认使用</strong><code>SimpleAsyncTaskExecutor</code>，每一次的执行任务都会使用新的线程，性能不太好，所以我们可以自定义线程池</p>
<h3 id="直接声明线程池"><a href="#直接声明线程池" class="headerlink" title="直接声明线程池"></a>直接声明线程池</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">@EnableAsync</span><br><span class="line">public class SpringAsyncConfig &#123;</span><br><span class="line">	@Bean</span><br><span class="line">	public Executor threadPoolTaskExecutor() &#123;</span><br><span class="line">		ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();</span><br><span class="line">		executor.setCorePoolSize(10);</span><br><span class="line">		executor.setMaxPoolSize(20);</span><br><span class="line">		executor.setQueueCapacity(500);</span><br><span class="line">		executor.setKeepAliveSeconds(60);</span><br><span class="line">		executor.setThreadNamePrefix(&quot;asyncExecutor-&quot;);</span><br><span class="line">		executor.setRejectedExecutionHandler(new ThreadPoolExecutor.CallerRunsPolicy());</span><br><span class="line">		executor.initialize();</span><br><span class="line">		return executor;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过使用<code>ThreadPoolTaskExecutor</code>创建了一个线程池，同时设置了以下这些参数：</p>
<ul>
<li>核心线程数10：线程池创建时候初始化的线程数</li>
<li>最大线程数20：线程池最大的线程数，只有在缓冲队列满了之后才会申请超过核心线程数的线程</li>
<li>缓冲队列500：用来缓冲执行任务的队列</li>
<li>允许线程的空闲时间60秒：当超过了核心线程出之外的线程在空闲时间到达之后会被销毁</li>
<li>线程池名的前缀：设置好了之后可以方便我们定位处理任务所在的线程池</li>
<li>线程池对拒绝任务的处理策略：这里采用了<code>CallerRunsPolicy</code>策略，当线程池没有处理能力的时候，该策略会直接在 execute 方法的调用线程中运行被拒绝的任务；如果执行程序已关闭，则会丢弃该任务</li>
</ul>
<h3 id="实现AsyncConfigurer"><a href="#实现AsyncConfigurer" class="headerlink" title="实现AsyncConfigurer"></a>实现AsyncConfigurer</h3><blockquote>
<p>通过这种方式，可以<strong>对异常进行处理</strong></p>
</blockquote>
<p><code>AsyncConfigurer</code>接口有两个方法：</p>
<ul>
<li><code>getAsyncExecutor()</code>: 提供线程池</li>
<li><code>getAsyncUncaughtExceptionHandler()</code>: 异步任务异常处理</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">@EnableAsync</span><br><span class="line">public class SpringAsyncConfig implements AsyncConfigurer &#123;</span><br><span class="line">	@Override</span><br><span class="line">	public Executor getAsyncExecutor() &#123;</span><br><span class="line">		ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();</span><br><span class="line">		executor.setCorePoolSize(8);</span><br><span class="line">		executor.setMaxPoolSize(42);</span><br><span class="line">		executor.setQueueCapacity(500);</span><br><span class="line">		executor.setThreadNamePrefix(&quot;MyExecutor-&quot;);</span><br><span class="line">		executor.initialize();</span><br><span class="line">		return executor;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	@Override</span><br><span class="line">	public AsyncUncaughtExceptionHandler getAsyncUncaughtExceptionHandler()&#123;</span><br><span class="line">		return (ex, method, params) -&gt; &#123;</span><br><span class="line">			ExceptionUtils.printRootCauseStackTrace(ex);</span><br><span class="line">			System.out.println(&quot;Exception message - &quot; + ex.getMessage());</span><br><span class="line">			System.out.println(&quot;Method name - &quot; + method.getName());</span><br><span class="line">			for (Object param : params) &#123;</span><br><span class="line">				System.out.println(&quot;Parameter value - &quot; + param);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="优雅关闭线程池"><a href="#优雅关闭线程池" class="headerlink" title="优雅关闭线程池"></a>优雅关闭线程池</h3><p>有时候，存在关闭程序但还有异步任务在执行的情况，这时候，我们需要优雅地关闭线程池，只需要两个参数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">executor.setWaitForTasksToCompleteOnShutdown(true);</span><br><span class="line">executor.setAwaitTerminationSeconds(60);</span><br></pre></td></tr></table></figure>
<h2 id="Async使用指定线程池"><a href="#Async使用指定线程池" class="headerlink" title="Async使用指定线程池"></a>Async使用指定线程池</h2><p>如果同时实现了<code>AsyncConfigurer</code>以及配置线程池，那么<code>@Async</code>默认使用<code>AsyncConfigurer.getAsyncExecutor</code>的线程池。</p>
<p>如果需要指定线程池可以这样</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@Async(&quot;threadPoolTaskExecutor&quot;)</span><br><span class="line">public void someMethod()&#123;...&#125;</span><br></pre></td></tr></table></figure>
<h2 id="获取异步执行结果"><a href="#获取异步执行结果" class="headerlink" title="获取异步执行结果"></a>获取异步执行结果</h2><p>Service：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Async(&quot;threadPoolTaskExecutor&quot;)</span><br><span class="line">@Override</span><br><span class="line">public Future&lt;String&gt; asyncMethodWithVoidReturnType() throws InterruptedException &#123;</span><br><span class="line">	Thread.sleep(2000L);</span><br><span class="line">	return AsyncResult.forValue(&quot;Execute method asynchronously. &quot; + Thread.currentThread().getName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Controller：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@GetMapping(&quot;/hello&quot;)</span><br><span class="line">public Mono&lt;String&gt; syaHello() throws InterruptedException, ExecutionException &#123;</span><br><span class="line">	Future&lt;String&gt; stringFuture = someService.asyncMethodWithVoidReturnType();</span><br><span class="line">	while (!stringFuture.isDone())&#123;</span><br><span class="line">		System.out.println(&quot;wait...&quot;);</span><br><span class="line">		Thread.sleep(500L);</span><br><span class="line">	&#125;</span><br><span class="line">	System.out.println(stringFuture.get());</span><br><span class="line">	return Mono.just(&quot;Hello World&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wait...</span><br><span class="line">wait...</span><br><span class="line">wait...</span><br><span class="line">wait...</span><br><span class="line">wait...</span><br><span class="line">Execute method asynchronously. asyncExecutor-1</span><br></pre></td></tr></table></figure>
<h1 id="Spring定时任务"><a href="#Spring定时任务" class="headerlink" title="Spring定时任务"></a>Spring定时任务</h1><p>启用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">@EnableScheduling</span><br><span class="line">public class SpringScheduleConfig implements SchedulingConfigurer &#123;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public void configureTasks(ScheduledTaskRegistrar taskRegistrar) &#123;</span><br><span class="line">		taskRegistrar.setScheduler(taskExecutor());</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	@Bean</span><br><span class="line">	public Executor taskExecutor() &#123;</span><br><span class="line">		return new ScheduledThreadPoolExecutor(4,</span><br><span class="line">				new BasicThreadFactory</span><br><span class="line">						.Builder()</span><br><span class="line">						.namingPattern(&quot;schedule-pool-thread-%d&quot;)</span><br><span class="line">						.daemon(true)</span><br><span class="line">						.build());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>定时任务：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">private int i = 0;</span><br><span class="line"></span><br><span class="line">@Scheduled(fixedDelay=1000)</span><br><span class="line">public void doScheduled() &#123;</span><br><span class="line">	System.out.println(Thread.currentThread().getName() + &quot;  &quot; + ++i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">schedule-pool-thread-1  2</span><br><span class="line">schedule-pool-thread-2  3</span><br><span class="line">schedule-pool-thread-1  4</span><br><span class="line">schedule-pool-thread-3  5</span><br><span class="line">schedule-pool-thread-2  6</span><br></pre></td></tr></table></figure>
<h1 id="Spring启动后执行程序的几种方式"><a href="#Spring启动后执行程序的几种方式" class="headerlink" title="Spring启动后执行程序的几种方式"></a>Spring启动后执行程序的几种方式</h1><h2 id="PostConstruct-或-InitializingBean"><a href="#PostConstruct-或-InitializingBean" class="headerlink" title="@PostConstruct 或 InitializingBean"></a>@PostConstruct 或 InitializingBean</h2><p>通过<code>@PostConstruct</code>或实现<code>InitializingBean</code>实现初始化<code>bean</code>的时候干一些事情，两者区别在于<code>InitializingBean</code>是在属性设置完之后执行的，所以执行顺序是在<code>@PostConstruct</code>之前</p>
<blockquote>
<p>由于此接口的方法<code>afterPropertiesSet</code>是在对象的所有属性被初始化后才会调用。当Spring的配置文件中设置类初始默认为”延迟初始”（<code>default-lazy-init=&quot;true&quot;</code>，此值默认为<code>false</code>）时，</p>
<p>类对象如果不被使用，则不会实例化该类对象。所以 <code>InitializingBean</code>子类不能用于在容器启动时进行初始化的工作，则应使用Spring提供的<code>ApplicationListener</code>接口来进行程序的初始化工作。</p>
<p>另外，如果需要<code>InitializingBean</code>子类对象在Spring容器启动时就初始化并则容器调用<code>afterPropertiesSet</code>方法则需要在类上增加<code>org.springframework.context.annotation.Lazy</code>注解并设置为false即可（也可通过spring配置bean时添加<code>lazy-init=&quot;false&quot;</code>)。</p>
</blockquote>
<h2 id="监听ContextRefreshedEvent"><a href="#监听ContextRefreshedEvent" class="headerlink" title="监听ContextRefreshedEvent"></a>监听ContextRefreshedEvent</h2><p>通过监听<code>ContextRefreshedEvent</code>事件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public class ApplicationContextRefreshedEventListener implements ApplicationListener&lt;ContextRefreshedEvent&gt; &#123;</span><br><span class="line">	@Override</span><br><span class="line">	public void onApplicationEvent(ContextRefreshedEvent event) &#123;</span><br><span class="line">		System.out.println(&quot;ContextRefreshedEvent process...&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">或者</span><br><span class="line">@EventListener</span><br><span class="line">public void processContextRefreshedEvent(ContextRefreshedEvent event) throws InterruptedException &#123;</span><br><span class="line">	log.info(&quot;ContextRefreshedEvent process...&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Spring的事件处理是单线程的，所以如果一个事件被触发，除非所有的接收者得到消息，否则这些进程被阻止，流程将不会继续。因此，如果要使用事件处理，在设计应用程序时应小心。</p>
<h3 id="Spring内置事件"><a href="#Spring内置事件" class="headerlink" title="Spring内置事件"></a>Spring内置事件</h3><p>以下是Spring的内置事件</p>
<table>
<thead>
<tr>
<th>Spring 内置事件</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ContextRefreshedEvent</strong></td>
<td><code>ApplicationContext</code>被初始化或刷新时，该事件被发布。这也可以在<code>ConfigurableApplicationContext</code>接口中使用<code>refresh()</code>方法来发生。</td>
</tr>
<tr>
<td><strong>ContextStartedEvent</strong></td>
<td>当使用<code>ConfigurableApplicationContext</code>接口中的<code>start()</code>方法启动<code>ApplicationContext</code>时，该事件被触发。你可以查询你的数据库，或者你可以在接受到这个事件后重启任何停止的应用程序。</td>
</tr>
<tr>
<td><strong>ContextStoppedEvent</strong></td>
<td>当使用<code>ConfigurableApplicationContext</code>接口中的<code>stop()</code>方法停止<code>ApplicationContext</code>时，该事件被触发。你可以在接受到这个事件后做必要的清理的工作。</td>
</tr>
<tr>
<td><strong>ContextClosedEvent</strong></td>
<td>当使用<code>ConfigurableApplicationContext</code>接口中的<code>close()</code>方法关闭<code>ApplicationContext</code>时，该事件被触发。一个已关闭的上下文到达生命周期末端；它不能被刷新或重启。</td>
</tr>
<tr>
<td><strong>RequestHandledEvent</strong></td>
<td>这是一个<code>web-specific</code>事件，告诉所有<code>bean</code> HTTP请求已经被服务。</td>
</tr>
</tbody>
</table>
<h3 id="Spring-Boot-2-0新增事件"><a href="#Spring-Boot-2-0新增事件" class="headerlink" title="Spring Boot 2.0新增事件"></a>Spring Boot 2.0新增事件</h3><p>在Spring Boot 2.0中对事件模型做了一些增强，主要就是增加了<code>ApplicationStartedEvent</code>事件，所以在2.0版本中所有的事件按执行的先后顺序如下：</p>
<ul>
<li><code>ApplicationStartingEvent</code></li>
<li><code>ApplicationEnvironmentPreparedEvent</code></li>
<li><code>ApplicationPreparedEvent</code></li>
<li><code>ApplicationStartedEvent</code> &lt;= 新增的事件</li>
<li><code>ApplicationReadyEvent</code></li>
<li><code>ApplicationFailedEvent</code></li>
</ul>
<h2 id="ApplicationRunner-或-CommandLineRunner"><a href="#ApplicationRunner-或-CommandLineRunner" class="headerlink" title="ApplicationRunner 或 CommandLineRunner"></a>ApplicationRunner 或 CommandLineRunner</h2><p>实现<code>ApplicationRunner</code>或<code>CommandLineRunner</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootApplication</span><br><span class="line">public class ProdSyncLayerApplication implements ApplicationRunner,CommandLineRunner&#123;</span><br><span class="line"></span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		SpringApplication.run(ProdSyncLayerApplication.class, args);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public void run(ApplicationArguments args) throws Exception &#123;</span><br><span class="line">		System.out.println(&quot;ApplicationRunner...&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public void run(String... args) throws Exception &#123;</span><br><span class="line">		System.out.println(&quot;CommandLineRunner...&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>ApplicationRunner</code>比<code>CommandLineRunner</code>先执行</p>
<p><strong>总结</strong>：以上三种方式的顺序跟其序号一样</p>
<h2 id="onApplicationEvent执行两次问题"><a href="#onApplicationEvent执行两次问题" class="headerlink" title="onApplicationEvent执行两次问题"></a>onApplicationEvent执行两次问题</h2><p><code>applicationontext</code>和使用MVC之后的<code>webApplicationontext</code>会两次调用上面的方法，如何区分这个两种容器呢？</p>
<p>但是这个时候，会存在一个问题，在web 项目中（spring mvc），系统会存在两个容器，一个是<code>root application context</code> ,另一个就是我们自己的 <code>projectName-servlet context</code>（作为root application context的子容器）。</p>
<p>这种情况下，就会造成<code>onApplicationEvent</code>方法被执行两次。为了避免上面提到的问题，我们可以只在<code>root application context</code>初始化完成后调用逻辑代码，其他的容器的初始化完成，则不做任何处理，修改后代码 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Override  </span><br><span class="line">public void onApplicationEvent(ContextRefreshedEvent event) &#123;  </span><br><span class="line">  if(event.getApplicationContext().getParent() == null)&#123;//root application context 没有parent，他就是老大.  </span><br><span class="line">       //需要执行的逻辑代码，当spring容器初始化完成后就会执行该方法。  </span><br><span class="line">  &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>后续发现加上以上判断还是能执行两次，不加的话三次，最终研究结果使用以下判断更加准确：<code>event.getApplicationContext().getDisplayName().equals(&quot;Root WebApplicationContext&quot;)</code></p>
</blockquote>
<h1 id="Spring应用停止前执行程序的几种方式"><a href="#Spring应用停止前执行程序的几种方式" class="headerlink" title="Spring应用停止前执行程序的几种方式"></a>Spring应用停止前执行程序的几种方式</h1><ol>
<li><p>监听<code>ContextClosedEvent</code></p>
</li>
<li><p>实现<code>DisposableBean</code>或使用<code>@PostConstruct</code>，执行顺序：<code>@PostConstruct</code> &gt; <code>DisposableBean</code></p>
</li>
<li><p>使用ShutdownHook:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">public class ShutdownHook &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws InterruptedException &#123;</span><br><span class="line">        Runtime.getRuntime().addShutdownHook(new Thread(() -&gt; &#123;</span><br><span class="line">            try (FileWriter fw = new FileWriter(&quot;hook.log&quot;)) &#123;</span><br><span class="line">                // 假设记录日志/或者发送消息</span><br><span class="line">                fw.write(&quot;完成销毁操作,回收内存! &quot; + (new Date()).toString());</span><br><span class="line">                System.out.println(&quot;退出程序...&quot;);</span><br><span class="line">            &#125; catch (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;));</span><br><span class="line">        IntStream.range(0, 10).forEach(i -&gt; &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                System.out.println(&quot;正在工作...&quot;);</span><br><span class="line">                Thread.sleep(2000L);</span><br><span class="line">            &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="进行远程调试"><a href="#进行远程调试" class="headerlink" title="进行远程调试"></a>进行远程调试</h1><h2 id="远程调试的概念"><a href="#远程调试的概念" class="headerlink" title="远程调试的概念"></a>远程调试的概念</h2><ul>
<li>什么是远程调试：本地调用非本地的环境进行调试。</li>
<li>原理：两个VM之间通过socket协议进行通信，然后以达到远程调试的目的。</li>
<li>注意，如果 Java 源代码与目标应用程序不匹配，调试特性将不能正常工作。</li>
</ul>
<h2 id="java启动命令"><a href="#java启动命令" class="headerlink" title="java启动命令"></a>java启动命令</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -Xdebug -Xrunjdwp:server=y,transport=dt_socket,address=8000,suspend=n –jar spring-boot-demo-SNAPSHOT.jar</span><br></pre></td></tr></table></figure>
      
    </div>

<div style="text-align:center;color:#ccc;font-size:14px">---------------- The End ----------------</div>

    <div>
      
        
<div id="wechat_subscriber" style="display:block;padding:10px 0;margin:20px auto;width:100%;text-align:center">
    <img id="wechat_subscriber_qcode" src="/images/wechat/gongzhonghao.jpg" alt="ookamiAntD wechat" style="width:200px;max-width:100%">
    <div>欢迎您扫一扫上面的微信公众号，订阅我的博客！</div>
</div>


      
    </div>

    <div>
      
        


  <div style="padding:10px 0;margin:20px auto;width:90%;text-align:center">
    <div>谢谢大爷～</div>
    <button id="rewardButton" disable="enable" onclick='var qr=document.getElementById("QR");"none"===qr.style.display?qr.style.display="block":qr.style.display="none"'>
      <span>赏</span>
    </button>
    <div id="QR" style="display:none">
      
        <div id="wechat" style="display:inline-block">
          <img id="wechat_qr" src="/images/donate/wechat.png" alt="ookamiAntD WeChat Pay">
          <p>微信打赏</p>
        </div>
      
      
        <div id="alipay" style="display:inline-block">
          <img id="alipay_qr" src="/images/donate/alipay.jpg" alt="ookamiAntD Alipay">
          <p>支付宝打赏</p>
        </div>
      
    </div>
  </div>


      
    </div>
<div>
	  
	    <p id="div-border-left-red">
		Author：<b>ookamiAntD Yang</b><br>
		Link：<a href="/2018/spring-boot-learning-hodgepodge/" title="Spring Boot 学习杂记">http://yangbingdong.com/2018/spring-boot-learning-hodgepodge/</a><br>
		Contact：<a>yangbingdong1994@gmail.com</a><br>
	   <b>本文基于<a target="_blank" title="Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0)" href="http://creativecommons.org/licenses/by-sa/4.0/" rel="external nofollow noopener noreferrer"> 知识共享署名-相同方式共享 4.0 </a>国际许可协议发布</b><br>
	    <b>转载请注明出处，谢谢！</b>
	    </p>
	  
	</div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Java/" rel="tag"># Java</a>
          
            <a href="/tags/Spring-Boot/" rel="tag"># Spring Boot</a>
          
            <a href="/tags/Spring/" rel="tag"># Spring</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/mysql-related-learning/" rel="next" title="MySQL杂记">
                <i class="fa fa-chevron-left"></i> MySQL杂记
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/write-your-own-blockchain/" rel="prev" title="转载—自己动手写区块链">
                转载—自己动手写区块链 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        
<div class="-hoofoo-share-title">分享到：</div>
<div class="-hoofoo-share-buttons">
    <div class="-mob-share-weibo -hoofoo-share-weibo -hoofoo-share-ui-button"><i class="fa fa-weibo" aria-hidden="true"></i></div>
    <div class="-mob-share-weixin -hoofoo-share-weixin -hoofoo-share-ui-button"><i class="fa fa-weixin" aria-hidden="true"></i></div>
    <div class="-mob-share-qq -hoofoo-share-qq -hoofoo-share-ui-button"><i class="fa fa-qq" aria-hidden="true"></i></div>
    <div class="-mob-share-twitter -hoofoo-share-twitter -hoofoo-share-ui-button"><i class="fa fa-twitter" aria-hidden="true"></i></div>
    <div class="-hoofoo-share-more -hoofoo-share-ui-button -mob-share-open"><i class="fa fa-ellipsis-h" aria-hidden="true"></i></div>
</div>
<div class="-mob-share-ui" style="display:none">
    <ul class="-mob-share-list">
        <li class="-mob-share-weibo"><p>新浪微博</p></li>
        <li class="-mob-share-weixin"><p>微信</p></li>
        <li class="-mob-share-qzone"><p>QQ空间</p></li>
        <li class="-mob-share-qq"><p>QQ好友</p></li>
        <li class="-mob-share-tencentweibo"><p>腾讯微博</p></li>
        <li class="-mob-share-renren"><p>人人网</p></li>
        <li class="-mob-share-kaixin"><p>开心网</p></li>
        <li class="-mob-share-douban"><p>豆瓣</p></li>
        <li class="-mob-share-youdao"><p>有道云笔记</p></li>
        <li class="-mob-share-mingdao"><p>明道</p></li>
        <li class="-mob-share-pengyou"><p>朋友网</p></li>
        <li class="-mob-share-facebook"><p>Facebook</p></li>
        <li class="-mob-share-twitter"><p>Twitter</p></li>
        <li class="-mob-share-pocket"><p>Pocket</p></li>
        <li class="-mob-share-google"><p>Google+</p></li>
        <li class="-mob-share-tumblr"><p>Tumblr</p></li>
        <li class="-mob-share-instapaper"><p>Instapaper</p></li>
        <li class="-mob-share-linkedin"><p>Linkedin</p></li>
    </ul>
    <div class="-mob-share-close">取消</div>
</div>
<div class="-mob-share-ui-bg"></div>
<script id="-mob-share" src="http://f1.webshare.mob.com/code/mob-share.js?appkey=21aa3b13ad233"></script>


      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
<div style="text-align:center">
  

</div>
      <div id="disqus_proxy_thread"></div>
      <div id="disqus_thread"></div>
      
          <script type="text/javascript">window.disqusProxy={username:"ookamiantd",server:"disqus-proxy.yangbingdong.com",port:"5509",defaultAvatar:"/images/avatar/avatar-default.jpg",adminAvatar:"/images/avatar/avatar-admin.jpg",identifier:"2018/spring-boot-learning-hodgepodge/"},window.disqus_config=function(){this.page.url="http://yangbingdong.com/2018/spring-boot-learning-hodgepodge/",this.page.identifier="2018/spring-boot-learning-hodgepodge/"},window.onload=function(){var a=document.createElement("script");a.src="/static/js/main.0d0338ae.js",a.async=!0,document.body.appendChild(a)}</script>
          <link rel="stylesheet" href="/static/css/main.0603c539.css">
      

    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/images/avatar/avatar-admin.jpg" alt="ookamiAntD">
          <p class="site-author-name" itemprop="name">ookamiAntD</p>
          <p class="site-description motion-element" itemprop="description">码渣 | rocker | 二次元 | 美剧 | 宅</p>
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">26</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">13</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">27</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/masteranthoneyd" target="_blank" rel="external nofollow noopener noreferrer" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.facebook.com/profile.php?id=100014869064462" target="_blank" rel="external nofollow noopener noreferrer" title="Facebook">
                  
                    <i class="fa fa-fw fa-facebook"></i>
                  
                  Facebook
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/ookamiAntD" target="_blank" rel="external nofollow noopener noreferrer" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
          
        </div>

        
        
          <div class="cc-license motion-element" itemprop="license">
            <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="cc-opacity" target="_blank" rel="external nofollow noopener noreferrer">
              <img src="/images/cc-by-sa.svg" alt="Creative Commons">
            </a>
          </div>
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-block">
            <div class="links-of-blogroll-title">
              <i class="fa fa-fw fa-globe"></i>
              大神们的博客
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="https://ycwalker.com/" title="ciqulover" target="_blank" rel="external nofollow noopener noreferrer">ciqulover</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://codepub.cn" title="IT草根" target="_blank" rel="external nofollow noopener noreferrer">IT草根</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://crossoverjie.top/" title="crossoverJie's Blog" target="_blank" rel="external nofollow noopener noreferrer">crossoverJie's Blog</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://yemengying.com/" title="Giraffe's Home" target="_blank" rel="external nofollow noopener noreferrer">Giraffe's Home</a>
                </li>
              
            </ul>
          </div>
        

        <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="300" height="80" src="//music.163.com/outchain/player?type=2&id=32364704&auto=0&height=66" style="margin-top:20px"></iframe>


      </section>

      
      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#构建依赖版本管理工程"><span class="nav-number">1.</span> <span class="nav-text">构建依赖版本管理工程</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#依赖版本管理工程"><span class="nav-number">1.1.</span> <span class="nav-text">依赖版本管理工程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#父工程"><span class="nav-number">1.2.</span> <span class="nav-text">父工程</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#打包"><span class="nav-number">2.</span> <span class="nav-text">打包</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#打包成可执行的Jar"><span class="nav-number">2.1.</span> <span class="nav-text">打包成可执行的Jar</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#打包依赖了Spring-Boot的工具库"><span class="nav-number">2.2.</span> <span class="nav-text">打包依赖了Spring Boot的工具库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#打包契约类"><span class="nav-number">2.3.</span> <span class="nav-text">打包契约类</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#配置文件：Properties-和-YAML"><span class="nav-number">3.</span> <span class="nav-text">配置文件：Properties 和 YAML</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#配置文件的生效顺序，会对值进行覆盖"><span class="nav-number">3.1.</span> <span class="nav-text">配置文件的生效顺序，会对值进行覆盖</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置随机值"><span class="nav-number">3.2.</span> <span class="nav-text">配置随机值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#应用简单配置"><span class="nav-number">3.3.</span> <span class="nav-text">应用简单配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置文件-多环境配置"><span class="nav-number">3.4.</span> <span class="nav-text">配置文件-多环境配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#多环境配置的好处"><span class="nav-number">3.4.1.</span> <span class="nav-text">多环境配置的好处</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Properties多环境配置"><span class="nav-number">3.4.2.</span> <span class="nav-text">Properties多环境配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#YAML多环境配置"><span class="nav-number">3.4.3.</span> <span class="nav-text">YAML多环境配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#两种配置方式的比较"><span class="nav-number">3.4.4.</span> <span class="nav-text">两种配置方式的比较</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#如何使用"><span class="nav-number">3.4.5.</span> <span class="nav-text">如何使用</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#热部署"><span class="nav-number">4.</span> <span class="nav-text">热部署</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#使用为Undertow作为Web容器"><span class="nav-number">5.</span> <span class="nav-text">使用为Undertow作为Web容器</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#与Tomcat性能对比"><span class="nav-number">5.1.</span> <span class="nav-text">与Tomcat性能对比</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Maven配置"><span class="nav-number">5.2.</span> <span class="nav-text">Maven配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#监听多个端口与HTTP2支持"><span class="nav-number">5.3.</span> <span class="nav-text">监听多个端口与HTTP2支持</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Undertow相关配置"><span class="nav-number">5.4.</span> <span class="nav-text">Undertow相关配置</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#日志相关"><span class="nav-number">6.</span> <span class="nav-text">日志相关</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#使用Log4j2"><span class="nav-number">6.1.</span> <span class="nav-text">使用Log4j2</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Maven配置-1"><span class="nav-number">6.1.1.</span> <span class="nav-text">Maven配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#application-yml简单配置"><span class="nav-number">6.1.2.</span> <span class="nav-text">application.yml简单配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#log4j2-xml配置"><span class="nav-number">6.1.3.</span> <span class="nav-text">log4j2.xml配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#也可以使用log4j2-yml"><span class="nav-number">6.1.4.</span> <span class="nav-text">也可以使用log4j2.yml</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#日志配置文件中获取Application配置项"><span class="nav-number">6.2.</span> <span class="nav-text">日志配置文件中获取Application配置项</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Logback"><span class="nav-number">6.2.1.</span> <span class="nav-text">Logback</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Log4j2"><span class="nav-number">6.2.2.</span> <span class="nav-text">Log4j2</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#查看依赖树"><span class="nav-number">7.</span> <span class="nav-text">查看依赖树</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Spring-MVC-相关"><span class="nav-number">8.</span> <span class="nav-text">Spring MVC 相关</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Spring-MVC集成fastjson"><span class="nav-number">8.1.</span> <span class="nav-text">Spring MVC集成fastjson</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#方式一、实现WebMvcConfigurer"><span class="nav-number">8.1.1.</span> <span class="nav-text">方式一、实现WebMvcConfigurer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#方式二、通过-Bean方式"><span class="nav-number">8.1.2.</span> <span class="nav-text">方式二、通过@Bean方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WebFlux"><span class="nav-number">8.1.3.</span> <span class="nav-text">WebFlux</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Spring-Boot-MVC特性"><span class="nav-number">8.2.</span> <span class="nav-text">Spring Boot MVC特性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#模板引擎的选择"><span class="nav-number">8.3.</span> <span class="nav-text">模板引擎的选择</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#开启GZIP算法压缩响应流"><span class="nav-number">8.4.</span> <span class="nav-text">开启GZIP算法压缩响应流</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#全局异常处理"><span class="nav-number">8.5.</span> <span class="nav-text">全局异常处理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#方式一：添加自定义的错误页面"><span class="nav-number">8.5.1.</span> <span class="nav-text">方式一：添加自定义的错误页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#方式二：通过-ControllerAdvice"><span class="nav-number">8.5.2.</span> <span class="nav-text">方式二：通过@ControllerAdvice</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#静态资源"><span class="nav-number">8.6.</span> <span class="nav-text">静态资源</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#自定义消息转化器"><span class="nav-number">8.7.</span> <span class="nav-text">自定义消息转化器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#自定义SpringMVC的拦截器"><span class="nav-number">8.8.</span> <span class="nav-text">自定义SpringMVC的拦截器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#创建-Servlet、-Filter、Listener"><span class="nav-number">8.9.</span> <span class="nav-text">创建 Servlet、 Filter、Listener</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#注解方式"><span class="nav-number">8.9.1.</span> <span class="nav-text">注解方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#通过编码注册"><span class="nav-number">8.9.2.</span> <span class="nav-text">通过编码注册</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Spring-Interceptor与Servlet-Filter的区别"><span class="nav-number">8.10.</span> <span class="nav-text">Spring Interceptor与Servlet Filter的区别</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Validation"><span class="nav-number">9.</span> <span class="nav-text">Validation</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#常用注解（大部分JSR中已有）"><span class="nav-number">9.1.</span> <span class="nav-text">常用注解（大部分JSR中已有）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#简单使用"><span class="nav-number">9.2.</span> <span class="nav-text">简单使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#快速失效"><span class="nav-number">9.3.</span> <span class="nav-text">快速失效</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#分组校验"><span class="nav-number">9.4.</span> <span class="nav-text">分组校验</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#自定义校验"><span class="nav-number">9.5.</span> <span class="nav-text">自定义校验</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#手动校验"><span class="nav-number">9.6.</span> <span class="nav-text">手动校验</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#基于方法校验"><span class="nav-number">9.7.</span> <span class="nav-text">基于方法校验</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#统一处理验证异常"><span class="nav-number">9.8.</span> <span class="nav-text">统一处理验证异常</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#创建异步方法"><span class="nav-number">10.</span> <span class="nav-text">创建异步方法</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#启动异步"><span class="nav-number">10.1.</span> <span class="nav-text">启动异步</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#编写异步方法"><span class="nav-number">10.2.</span> <span class="nav-text">编写异步方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置线程池"><span class="nav-number">10.3.</span> <span class="nav-text">配置线程池</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#直接声明线程池"><span class="nav-number">10.3.1.</span> <span class="nav-text">直接声明线程池</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#实现AsyncConfigurer"><span class="nav-number">10.3.2.</span> <span class="nav-text">实现AsyncConfigurer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#优雅关闭线程池"><span class="nav-number">10.3.3.</span> <span class="nav-text">优雅关闭线程池</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Async使用指定线程池"><span class="nav-number">10.4.</span> <span class="nav-text">Async使用指定线程池</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#获取异步执行结果"><span class="nav-number">10.5.</span> <span class="nav-text">获取异步执行结果</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Spring定时任务"><span class="nav-number">11.</span> <span class="nav-text">Spring定时任务</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Spring启动后执行程序的几种方式"><span class="nav-number">12.</span> <span class="nav-text">Spring启动后执行程序的几种方式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#PostConstruct-或-InitializingBean"><span class="nav-number">12.1.</span> <span class="nav-text">@PostConstruct 或 InitializingBean</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#监听ContextRefreshedEvent"><span class="nav-number">12.2.</span> <span class="nav-text">监听ContextRefreshedEvent</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Spring内置事件"><span class="nav-number">12.2.1.</span> <span class="nav-text">Spring内置事件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Spring-Boot-2-0新增事件"><span class="nav-number">12.2.2.</span> <span class="nav-text">Spring Boot 2.0新增事件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ApplicationRunner-或-CommandLineRunner"><span class="nav-number">12.3.</span> <span class="nav-text">ApplicationRunner 或 CommandLineRunner</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#onApplicationEvent执行两次问题"><span class="nav-number">12.4.</span> <span class="nav-text">onApplicationEvent执行两次问题</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Spring应用停止前执行程序的几种方式"><span class="nav-number">13.</span> <span class="nav-text">Spring应用停止前执行程序的几种方式</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#进行远程调试"><span class="nav-number">14.</span> <span class="nav-text">进行远程调试</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#远程调试的概念"><span class="nav-number">14.1.</span> <span class="nav-text">远程调试的概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#java启动命令"><span class="nav-number">14.2.</span> <span class="nav-text">java启动命令</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
	
      <div class="footer-inner">
        <div class="copyright">
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-flash"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Hosted by <a href="https://pages.coding.me" style="font-weight:700" rel="external nofollow noopener noreferrer" target="_blank">Coding Pages</a></span>
</div>


<div class="powered-by">
    Personal Site
</div>

<div class="theme-info">
  Blog -
ookamiAntD | <span class="post-count">共170.5k字</span>
</div>



        

<div class="busuanzi-count">

  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv"><i class="fa fa-user">本站访客数</i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span>人次</span>
  

  
    <span class="site-pv"><i class="fa fa-eye">本站总访问量</i><span class="busuanzi-value" id="busuanzi_value_site_pv"></span>次</span>
  
  
</div>



        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  

    <script type="text/javascript">function run_disqus_script(e){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src="//"+disqus_shortname+".disqus.com/"+e,(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(t)}var disqus_shortname="ookamiantd",disqus_identifier="2018/spring-boot-learning-hodgepodge/",disqus_title="Spring Boot 学习杂记",disqus={load:function(){"object"!=typeof DISQUS&&(!function(){var e=document.createElement("script");e.async=!0,e.type="text/javascript",e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(e)}(),$("#load-disqus").html("评论加载中，请确保你有梯子，若评论长时间未加载则你可能翻墙失败...").fadeOut(9e3))}}</script>
  









  
  
  <script type="text/javascript">function proceedsearch(){$("body").append('<div class="popoverlay">').css("overflow","hidden"),$(".popup").toggle()}var isfetched=!1,search_path="search.xml";0==search_path.length&&(search_path="search.xml");var path="/"+search_path,searchFunc=function(e,t,a){"use strict";$.ajax({url:e,dataType:"xml",async:!0,success:function(e){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var r=$("entry",e).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get(),c=document.getElementById(t),n=document.getElementById(a);c.addEventListener("input",function(){var e=0,t='<ul class="search-result-list">',a=this.value.trim().toLowerCase().split(/[\s\-]+/);n.innerHTML="",this.value.trim().length>1&&r.forEach(function(r){var c=!1,n=r.title.trim().toLowerCase(),s=r.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),o=decodeURIComponent(r.url),i=-1,l=-1,p=-1;if(""!=n&&a.forEach(function(e,t){i=n.indexOf(e),l=s.indexOf(e),(i>=0||l>=0)&&(c=!0,0==t&&(p=l))}),c){e+=1,t+="<li><a href='"+o+"' class='search-result-title'>"+n+"</a>";var h=r.content.trim().replace(/<[^>]+>/g,"");if(p>=0){var u=p-20,d=p+80;u<0&&(u=0),0==u&&(d=50),d>h.length&&(d=h.length);var f=h.substring(u,d);a.forEach(function(e){var t=new RegExp(e,"gi");f=f.replace(t,'<b class="search-keyword">'+e+"</b>")}),t+='<p class="search-result">'+f+"...</p>"}t+="</li>"}}),t+="</ul>",0==e&&(t='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'),""==a&&(t='<div id="no-result"><i class="fa fa-search fa-5x" /></div>'),n.innerHTML=t}),proceedsearch()}})};$(".popup-trigger").click(function(e){e.stopPropagation(),0==isfetched?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(function(e){$(".popup").hide(),$(".popoverlay").remove(),$("body").css("overflow","")}),$(".popup").click(function(e){e.stopPropagation()})</script>


  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("usE0s6JGUeOiMcsVoRuHuv2B-gzGzoHsz","ewm6NEF07r83HbnOr63ptuKH")</script>
  <script>function showTime(e){var t=new AV.Query(e),n=[],o=$(".leancloud_visitors");o.each(function(){n.push($(this).attr("id").trim())}),t.containedIn("url",n),t.find().done(function(e){if(0!==e.length){for(c=0;c<e.length;c++){var t=e[c],i=t.get("url"),s=t.get("time"),l=document.getElementById(i);$(l).find(".leancloud-visitors-count").text(s)}for(var c=0;c<n.length;c++){var i=n[c],l=document.getElementById(i),r=$(l).find(".leancloud-visitors-count");""==r.text()&&r.text(0)}}else o.find(".leancloud-visitors-count").text(0)}).fail(function(e,t){console.log("Error: "+t.code+" "+t.message)})}function addCount(e){var t=$(".leancloud_visitors"),n=t.attr("id").trim(),o=t.attr("data-flag-title").trim(),i=new AV.Query(e);i.equalTo("url",n),i.find({success:function(t){if(t.length>0){var i=t[0];i.fetchWhenSave(!0),i.increment("time"),i.save(null,{success:function(e){$(document.getElementById(n)).find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to save Visitor num, with error message: "+t.message)}})}else{var s=new e,l=new AV.ACL;l.setPublicReadAccess(!0),l.setPublicWriteAccess(!0),s.setACL(l),s.set("title",o),s.set("url",n),s.set("time",1),s.save(null,{success:function(e){$(document.getElementById(n)).find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to create")}})}},error:function(e){console.log("Error:"+e.code+" "+e.message)}})}$(function(){var e=AV.Object.extend("Counter");1==$(".leancloud_visitors").length?addCount(e):$(".post-title-link").length>1&&showTime(e)})</script>



  
<script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script>


  


  <script type="text/javascript" color="255,0,204" opacity="0.5" zindex="-2" count="80" src="//cdn.bootcss.com/canvas-nest.js/1.0.1/canvas-nest.min.js"></script>



<script type="text/javascript">$("body").delegate(".-mob-share-weixin-qrcode-bg","click",function(){$(".-mob-share-weixin-qrcode-close").trigger("click")})</script></body></html>