<!doctype html><html class="theme-next muse use-motion" lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta http-equiv="content-language" content="zh-cn"><script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script><link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet"><style>.pace .pace-progress{background:#ff009e;height:2px}.pace .pace-progress-inner{box-shadow:0 0 10px #e6006b,0 0 5px #ff009e}.pace .pace-activity{border-top-color:#ff009e;border-left-color:#ff009e}</style><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css"><meta name="keywords" content="Java,Spring,Spring Boot,"><link rel="alternate" href="/atom.xml" title="ookamiAntD's Blog" type="application/atom+xml"><link rel="shortcut icon" type="image/x-icon" href="/favicon.png?v=5.1.0"><meta name="description" content="Spring Boot作为当下最流行的微服务项目构建基础，有的时候我们根本不需要额外的配置就能够干很多的事情，这得益于它的一个核心理念：“习惯优于配置”。。。说白的就是大部分的配置都已经按照最佳实践的编程规范配置好了本文基于 Spring Boot 2的学习杂记，还是与1.X版本还是有一定区别的"><meta name="keywords" content="Java,Spring,Spring Boot"><meta property="og:type" content="article"><meta property="og:title" content="Spring Boot 学习杂记"><meta property="og:url" content="http://yangbingdong.com/2018/spring-boot-learning-hodgepodge/index.html"><meta property="og:site_name" content="ookamiAntD&#39;s Blog"><meta property="og:description" content="Spring Boot作为当下最流行的微服务项目构建基础，有的时候我们根本不需要额外的配置就能够干很多的事情，这得益于它的一个核心理念：“习惯优于配置”。。。说白的就是大部分的配置都已经按照最佳实践的编程规范配置好了本文基于 Spring Boot 2的学习杂记，还是与1.X版本还是有一定区别的"><meta property="og:locale" content="en"><meta property="og:image" content="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/spring-boot.png"><meta property="og:image" content="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/parent.png"><meta property="og:image" content="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/repackage.png"><meta property="og:image" content="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/spring-boot-devtools01.png"><meta property="og:image" content="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/spring-boot-devtools02.png"><meta property="og:image" content="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/tomcat-gatling-test.jpg"><meta property="og:image" content="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/undertow-gatling-test.jpg"><meta property="og:image" content="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/log4j2-performance.png"><meta property="og:image" content="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/gatling-logo.png"><meta property="og:image" content="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/recorder1.png"><meta property="og:image" content="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/firefox-proxy.jpg"><meta property="og:image" content="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/scala-script-location.jpg"><meta property="og:image" content="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/terminal-gatling-test1.jpg"><meta property="og:image" content="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/terminal-gatling-test2.jpg"><meta property="og:image" content="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/scala-plugin.jpg"><meta property="og:image" content="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/add-scala-sdk02.jpg"><meta property="og:image" content="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/add-scala-sdk01.jpg"><meta property="og:image" content="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/idea-gatling-test.jpg"><meta property="og:image" content="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/gatling-test-result1.jpg"><meta property="og:image" content="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/gatling-test-result2.jpg"><meta property="og:image" content="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/gatling-error1.jpg"><meta property="og:image" content="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/gatling-error2.jpg"><meta property="og:image" content="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/contiperf-report.jpg"><meta property="og:updated_time" content="2018-03-14T06:38:23.186Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Spring Boot 学习杂记"><meta name="twitter:description" content="Spring Boot作为当下最流行的微服务项目构建基础，有的时候我们根本不需要额外的配置就能够干很多的事情，这得益于它的一个核心理念：“习惯优于配置”。。。说白的就是大部分的配置都已经按照最佳实践的编程规范配置好了本文基于 Spring Boot 2的学习杂记，还是与1.X版本还是有一定区别的"><meta name="twitter:image" content="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/spring-boot.png"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Muse",sidebar:{position:"right",display:"always"},fancybox:!0,motion:!0,duoshuo:{userId:"undefined",author:"Author"},algolia:{applicationID:"RI3NF6GUI0",apiKey:"3d33fa60ba30d3b17f37220bb1a36749",indexName:"blogIndex",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://yangbingdong.com/2018/spring-boot-learning-hodgepodge/"><title>Spring Boot 学习杂记 | ookamiAntD's Blog</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="en"><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?e9505ac4e11d464329d615553a72b526";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><div class="container one-collumn sidebar-position-right page-post-detail"><div class="headband"></div><a href="https://github.com/masteranthoneyd/blog" rel="external nofollow noopener noreferrer" target="_blank"><img style="position:absolute;top:0;left:0;border:0" src="https://camo.githubusercontent.com/82b228a3648bf44fc1163ef44c62fcc60081495e/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f6c6566745f7265645f6161303030302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_left_red_aa0000.png"></a><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">ookamiAntD's Blog</span> <span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">Easy coding,easy life.</h1></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>Home</a></li><li class="menu-item menu-item-archives"><a href="/archives" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>Archives</a></li><li class="menu-item menu-item-categories"><a href="/categories" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>Categories</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>Tags</a></li><li class="menu-item menu-item-about"><a href="/about" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>About</a></li><li class="menu-item menu-item-guestbook"><a href="/guestbook" rel="section"><i class="menu-item-icon fa fa-fw fa-commenting"></i><br>Message</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>Search</a></li></ul><div class="site-search"><div class="popup"><span class="search-icon fa fa-search"></span> <input type="text" id="local-search-input"><div id="local-search-result"></div><span class="popup-btn-close">close</span></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://yangbingdong.com/2018/spring-boot-learning-hodgepodge/"><span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="ookamiAntD"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar/avatar-admin.jpg"></span><span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="ookamiAntD's Blog"><span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject"><img style="display:none" itemprop="url image" alt="ookamiAntD's Blog" src=""></span></span><header class="post-header"><h2 class="post-title" itemprop="name headline">Spring Boot 学习杂记</h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-02-25T15:25:35+08:00">2018-02-25 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Programming/" itemprop="url" rel="index"><span itemprop="name">Programming</span> </a></span>, <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Programming/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span> </a></span>, <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Programming/Java/Spring-Boot/" itemprop="url" rel="index"><span itemprop="name">Spring Boot</span> </a></span></span><span id="busuanzi_container_page_pv">&nbsp; | &nbsp; 热度&nbsp; <span id="busuanzi_value_page_pv"></span>°C </span><span id="/2018/spring-boot-learning-hodgepodge/" class="leancloud_visitors" data-flag-title="Spring Boot 学习杂记"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">Visitors </span><span class="leancloud-visitors-count"></span></span><br><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-edit"></i> </span><span class="post-meta-item-text">WordCount:</span> <span class="post-count">10,760字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-text">min2read:</span> <span class="post-count">50分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p><img src="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/spring-boot.png" alt=""></p><blockquote><p>Spring Boot作为当下最流行的微服务项目构建基础，有的时候我们根本不需要额外的配置就能够干很多的事情，这得益于它的一个核心理念：“习惯优于配置”。。。</p><p>说白的就是大部分的配置都已经按照最佳实践的编程规范配置好了</p><p>本文基于 Spring Boot 2的学习杂记，还是与1.X版本还是有一定区别的</p></blockquote><a id="more"></a><h1 id="构建依赖版本管理工程以及父工程"><a href="#构建依赖版本管理工程以及父工程" class="headerlink" title="构建依赖版本管理工程以及父工程"></a>构建依赖版本管理工程以及父工程</h1><blockquote><p>为什么要分开为两个工程？因为考虑到common工程也需要版本控制，但parent工程中依赖了common工程，所以common工程不能依赖parent工程（循环依赖），故例外抽离出一个dependencies的工程，专门用作依赖版本管理，而parent工程用作其他子工程的公共依赖。</p></blockquote><h2 id="依赖版本管理工程"><a href="#依赖版本管理工程" class="headerlink" title="依赖版本管理工程"></a>依赖版本管理工程</h2><p>跟下面父工程一样只有一个<code>pom.xml</code></p><p><em><a href="https://github.com/masteranthoneyd/spring-boot-learning/tree/master/spring-boot-parent-dependencies" rel="external nofollow noopener noreferrer" target="_blank">https://github.com/masteranthoneyd/spring-boot-learning/tree/master/spring-boot-parent-dependencies</a></em></p><h2 id="父工程"><a href="#父工程" class="headerlink" title="父工程"></a>父工程</h2><p><img src="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/parent.png" alt=""></p><p><em><a href="https://github.com/masteranthoneyd/spring-boot-learning/blob/master/spring-boot-parent/pom.xml" rel="external nofollow noopener noreferrer" target="_blank">https://github.com/masteranthoneyd/spring-boot-learning/blob/master/spring-boot-parent/pom.xml</a></em></p><p>说明：</p><ul><li><code>&lt;packaging&gt;</code> 为 <code>pom</code> 表示此会被打包成 pom 文件被其他子项目依赖。</li><li>由于 Spring Boot 以及集成了 <code>maven-surefire-plugin</code> 插件，跳过测试只需要在 properties中添加 <code>&lt;maven.test.skip&gt;true&lt;/maven.test.skip&gt;</code>即可，等同 <code>mvn package -Dmaven.test.skip=true</code>，也可使用 <code>&lt;skipTests&gt;true&lt;/skipTests&gt;</code>，两者的区别在于 <code>&lt;maven.test.skip&gt;</code> 标签连 <code>.class</code> 文件都不会生成，而 <code>&lt;skipTests&gt;</code> 会编译生成 <code>.class</code> 文件</li></ul><ul><li>子项目会继承父项目的 <code>properties</code>，若子项目重新定义属性，则会覆盖父项目的属性。</li><li><code>&lt;dependencyManagement&gt;</code> 管理依赖版本，不使用 <code>&lt;parent&gt;</code> 来依赖 Spring Boot，可以使用上面方式，添加 <code>&lt;type&gt;</code> 为 <code>pom</code> 以及 <code>&lt;scope&gt;</code> 为 <code>import</code>。</li><li><code>&lt;pluginManagement&gt;</code> 的功能类似于 <code>&lt;dependencyManagement&gt;</code>，在父项目中设置好插件属性，在子项目中直接依赖就可以，不需要每个子项目都配置一遍，当然了，子项目也可以覆盖插件属性。</li></ul><h1 id="打包成可执行的Jar"><a href="#打包成可执行的Jar" class="headerlink" title="打包成可执行的Jar"></a>打包成可执行的Jar</h1><p>默认情况下Spring Boot打包出来的jar包是不可执行的，需要这样配置：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;plugins&gt;</span><br><span class="line">    &lt;plugin&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;spring-boot.version&#125;&lt;/version&gt;</span><br><span class="line">        &lt;executions&gt;</span><br><span class="line">            &lt;execution&gt;</span><br><span class="line">                &lt;goals&gt;</span><br><span class="line">                    &lt;goal&gt;repackage&lt;/goal&gt;</span><br><span class="line">                &lt;/goals&gt;</span><br><span class="line">            &lt;/execution&gt;</span><br><span class="line">        &lt;/executions&gt;</span><br><span class="line">    &lt;/plugin&gt;</span><br><span class="line">&lt;/plugins&gt;</span><br></pre></td></tr></table></figure>
<p>打包之后会发现有<strong>两个</strong>jar，一个是本身的代码，一个是集成了Spring Boot的可运行jar：</p>
<p><img src="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/repackage.png" alt=""></p>
<h1 id="热部署"><a href="#热部署" class="headerlink" title="热部署"></a>热部署</h1><p><code>pom.xml</code>添加依赖：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;!--支持热启动jar包--&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;</span><br><span class="line">        &lt;!-- optional=true,依赖不会传递，该项目依赖devtools；之后依赖该项目的项目如果想要使用devtools，需要重新引入 --&gt;</span><br><span class="line">        &lt;optional&gt;true&lt;/optional&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br><span class="line">&lt;build&gt;</span><br><span class="line">    &lt;plugins&gt;</span><br><span class="line">        &lt;plugin&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">            &lt;configuration&gt;</span><br><span class="line">                &lt;fork&gt;true&lt;/fork&gt;</span><br><span class="line">            &lt;/configuration&gt;</span><br><span class="line">        &lt;/plugin&gt;</span><br><span class="line">    &lt;/plugins&gt;</span><br><span class="line">&lt;/build&gt;</span><br></pre></td></tr></table></figure>
<p><code>application.yml</code>配置文件中添加：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  devtools:</span><br><span class="line">    restart:</span><br><span class="line">      #热部署生效 默认就是为true</span><br><span class="line">      enabled: true</span><br><span class="line">      #classpath目录下的WEB-INF文件夹内容修改不重启</span><br><span class="line">      exclude: WEB-INF/**</span><br></pre></td></tr></table></figure>
<p>关于DevTools的键值如下：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># DEVTOOLS (DevToolsProperties)</span><br><span class="line">spring.devtools.livereload.enabled=true # Enable a livereload.com compatible server.</span><br><span class="line">spring.devtools.livereload.port=35729 # Server port.</span><br><span class="line">spring.devtools.restart.additional-exclude= # Additional patterns that should be excluded from triggering a full restart.</span><br><span class="line">spring.devtools.restart.additional-paths= # Additional paths to watch for changes.</span><br><span class="line">spring.devtools.restart.enabled=true # Enable automatic restart.</span><br><span class="line">spring.devtools.restart.exclude=META-INF/maven/**,META-INF/resources/**,resources/**,static/**,public/**,templates/**,**/*Test.class,**/*Tests.class,git.properties # Patterns that should be excluded from triggering a full restart.</span><br><span class="line">spring.devtools.restart.poll-interval=1000 # Amount of time (in milliseconds) to wait between polling for classpath changes.</span><br><span class="line">spring.devtools.restart.quiet-period=400 # Amount of quiet time (in milliseconds) required without any classpath changes before a restart is triggered.</span><br><span class="line">spring.devtools.restart.trigger-file= # Name of a specific file that when changed will trigger the restart check. If not specified any classpath file change will trigger the restart.</span><br><span class="line"></span><br><span class="line"># REMOTE DEVTOOLS (RemoteDevToolsProperties)</span><br><span class="line">spring.devtools.remote.context-path=/.~~spring-boot!~ # Context path used to handle the remote connection.</span><br><span class="line">spring.devtools.remote.debug.enabled=true # Enable remote debug support.</span><br><span class="line">spring.devtools.remote.debug.local-port=8000 # Local remote debug server port.</span><br><span class="line">spring.devtools.remote.proxy.host= # The host of the proxy to use to connect to the remote application.</span><br><span class="line">spring.devtools.remote.proxy.port= # The port of the proxy to use to connect to the remote application.</span><br><span class="line">spring.devtools.remote.restart.enabled=true # Enable remote restart.</span><br><span class="line">spring.devtools.remote.secret= # A shared secret required to establish a connection (required to enable remote support).</span><br><span class="line">spring.devtools.remote.secret-header-name=X-AUTH-TOKEN # HTTP header used to transfer the shared secret.</span><br></pre></td></tr></table></figure><p></p>
<p>当我们修改了java类后，IDEA默认是不自动编译的，而<code>spring-boot-devtools</code>又是监测<code>classpath</code>下的文件发生变化才会重启应用，所以需要设置IDEA的自动编译：</p>
<p>（1）<strong>File-Settings-Compiler-Build Project automatically</strong></p>
<p><img src="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/spring-boot-devtools01.png" alt=""></p>
<p>（2）<strong>ctrl + shift + alt + /,选择Registry,勾上 Compiler autoMake allow when app running</strong></p>
<p><img src="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/spring-boot-devtools02.png" alt=""></p>
<p>OK了，重启一下项目，然后改一下类里面的内容，IDEA就会自动去make了。</p>
<blockquote>
<p><strong>热部署可能会牺牲一定的系统性能，因为是动态的编译</strong></p>
</blockquote>
<h1 id="使用为Undertow作为Web容器"><a href="#使用为Undertow作为Web容器" class="headerlink" title="使用为Undertow作为Web容器"></a>使用为Undertow作为Web容器</h1><blockquote>
<p>Spring Boot内嵌容器支持Tomcat、Jetty、Undertow。<br>根据 <a href="https://link.jianshu.com/?t=https://examples.javacodegeeks.com/enterprise-java/spring/tomcat-vs-jetty-vs-undertow-comparison-of-spring-boot-embedded-servlet-containers/" rel="external nofollow noopener noreferrer" target="_blank">Tomcat vs. Jetty vs. Undertow: Comparison of Spring Boot Embedded Servlet Containers</a> 这篇文章统计，Undertow的综合性能更好。</p>
<p>在Spring Boot 2中，已经把netty作为webflux的默认容器</p>
</blockquote>
<h2 id="与Tomcat性能对比"><a href="#与Tomcat性能对比" class="headerlink" title="与Tomcat性能对比"></a>与Tomcat性能对比</h2><p>以下是Undertow与Tomcat简单的性能测试（同样是默认配置）</p>
<p>Tomcat:</p>
<p><img src="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/tomcat-gatling-test.jpg" alt=""></p>
<p>Undertow:</p>
<p><img src="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/undertow-gatling-test.jpg" alt=""></p>
<p>显然Undertow的吞吐量要比Tomcat高</p>
<h2 id="Maven配置"><a href="#Maven配置" class="headerlink" title="Maven配置"></a>Maven配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">    &lt;exclusions&gt;</span><br><span class="line">        &lt;!-- 移除默认web容器，使用undertow --&gt;</span><br><span class="line">        &lt;exclusion&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-tomcat&lt;/artifactId&gt;</span><br><span class="line">        &lt;/exclusion&gt;</span><br><span class="line">    &lt;/exclusions&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">如果是webflux，默认的容器的netty</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-webflux&lt;/artifactId&gt;</span><br><span class="line">    &lt;exclusions&gt;</span><br><span class="line">        &lt;!-- 移除默认web容器，使用undertow --&gt;</span><br><span class="line">        &lt;exclusion&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-reactor-netty&lt;/artifactId&gt;</span><br><span class="line">        &lt;/exclusion&gt;</span><br><span class="line">    &lt;/exclusions&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 使用高性能 Web 容器 undertow --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-undertow&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<h2 id="监听多个端口与HTTP2支持"><a href="#监听多个端口与HTTP2支持" class="headerlink" title="监听多个端口与HTTP2支持"></a>监听多个端口与HTTP2支持</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// 在@Configuration的类中添加@bean</span><br><span class="line">@Bean</span><br><span class="line">UndertowEmbeddedServletContainerFactory embeddedServletContainerFactory() &#123;</span><br><span class="line">    </span><br><span class="line">    UndertowEmbeddedServletContainerFactory factory = new UndertowEmbeddedServletContainerFactory();</span><br><span class="line">    </span><br><span class="line">    // 这里也可以做其他配置</span><br><span class="line">	// 支持HTTP2</span><br><span class="line">	factory.addBuilderCustomizers(builder -&gt; &#123;</span><br><span class="line">		builder.setServerOption(UndertowOptions.ENABLE_HTTP2, true);</span><br><span class="line">		// 监听多个端口</span><br><span class="line">		builder.addHttpListener(8080, &quot;0.0.0.0&quot;);</span><br><span class="line">	&#125;);</span><br><span class="line">    return factory;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Undertow相关配置"><a href="#Undertow相关配置" class="headerlink" title="Undertow相关配置"></a>Undertow相关配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># Undertow 日志存放目录</span><br><span class="line">server.undertow.accesslog.dir</span><br><span class="line"># 是否启动日志</span><br><span class="line">server.undertow.accesslog.enabled=false </span><br><span class="line"># 日志格式</span><br><span class="line">server.undertow.accesslog.pattern=common</span><br><span class="line"># 日志文件名前缀</span><br><span class="line">server.undertow.accesslog.prefix=access_log</span><br><span class="line"># 日志文件名后缀</span><br><span class="line">server.undertow.accesslog.suffix=log</span><br><span class="line"># HTTP POST请求最大的大小</span><br><span class="line">server.undertow.max-http-post-size=0 </span><br><span class="line"># 设置IO线程数, 它主要执行非阻塞的任务,它们会负责多个连接, 默认设置每个CPU核心一个线程</span><br><span class="line">server.undertow.io-threads=4</span><br><span class="line"># 阻塞任务线程池, 当执行类似servlet请求阻塞操作, undertow会从这个线程池中取得线程,它的值设置取决于系统的负载，默认数量为 CPU核心*8</span><br><span class="line">server.undertow.worker-threads=20</span><br><span class="line"># 以下的配置会影响buffer,这些buffer会用于服务器连接的IO操作,有点类似netty的池化内存管理</span><br><span class="line"># 每块buffer的空间大小,越小的空间被利用越充分</span><br><span class="line">server.undertow.buffer-size=1024</span><br><span class="line"># 每个区分配的buffer数量 , 所以pool的大小是buffer-size * buffers-per-region</span><br><span class="line">server.undertow.buffers-per-region=1024</span><br><span class="line"># 是否分配的直接内存</span><br><span class="line">server.undertow.direct-buffers=true</span><br></pre></td></tr></table></figure>
<h1 id="使用Log4j2"><a href="#使用Log4j2" class="headerlink" title="使用Log4j2"></a>使用Log4j2</h1><p>下面是 Log4j2  官方性能测试结果：</p>
<p><img src="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/log4j2-performance.png" alt=""></p>
<h2 id="Maven配置-1"><a href="#Maven配置-1" class="headerlink" title="Maven配置"></a>Maven配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- Spring Boot 依赖--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">    &lt;!-- 去除 logback 依赖 --&gt;</span><br><span class="line">    &lt;exclusions&gt;</span><br><span class="line">        &lt;exclusion&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-logging&lt;/artifactId&gt;</span><br><span class="line">        &lt;/exclusion&gt;</span><br><span class="line">    &lt;/exclusions&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 日志 Log4j2 --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-log4j2&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- Log4j2 异步支持 --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.lmax&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;disruptor&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.3.8&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：需要单独把<code>spring-boot-starter</code>里面的<code>logging</code>去除再引入<code>spring-boot-starter-web</code>，否则后面引入的<code>starter</code>模块带有的<code>logging</code>不会自动去除</p>
<h2 id="application-yml简单配置"><a href="#application-yml简单配置" class="headerlink" title="application.yml简单配置"></a>application.yml简单配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">logging:</span><br><span class="line">  config: classpath:log4j2.xml # 指定log4j2配置文件的路径，默认就是这个</span><br><span class="line">  pattern:</span><br><span class="line">    console: &quot;%clr&#123;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;&#125;&#123;faint&#125; | %clr&#123;%5p&#125; | %clr&#123;%15.15t&#125;&#123;faint&#125; | %clr&#123;%-50.50c&#123;1.&#125;&#125;&#123;cyan&#125; | %5L | %clr&#123;%M&#125;&#123;magenta&#125; | %msg%n%xwEx&quot; # 控制台日志输出格式</span><br></pre></td></tr></table></figure>
<h2 id="log4j2-xml配置"><a href="#log4j2-xml配置" class="headerlink" title="log4j2.xml配置"></a>log4j2.xml配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!-- Configuration后面的status，这个用于设置log4j2自身内部的信息输出，可以不设置，当设置成trace时，</span><br><span class="line">     你会看到log4j2内部各种详细输出。可以设置成OFF(关闭) 或 Error(只输出错误信息)。</span><br><span class="line">     30s 刷新此配置</span><br><span class="line">--&gt;</span><br><span class="line">&lt;configuration status=&quot;OFF&quot; monitorInterval=&quot;30&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 日志文件目录、压缩文件目录、日志格式配置 --&gt;</span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;Property name=&quot;fileName&quot;&gt;/home/ybd/logs&lt;/Property&gt;</span><br><span class="line">        &lt;Property name=&quot;fileGz&quot;&gt;/home/ybd/logs/7z&lt;/Property&gt;</span><br><span class="line">        &lt;Property name=&quot;PID&quot;&gt;????&lt;/Property&gt;</span><br><span class="line">        &lt;!--&lt;Property name=&quot;LOG_PATTERN&quot;&gt;%clr&#123;%d&#123;yyyy-MM-dd HH:mm:ss.SSS z&#125;&#125;&#123;faint&#125; %clr&#123;%5p&#125; %clr&#123;$&#123;sys:PID&#125;&#125;&#123;magenta&#125;</span><br><span class="line">            %clr&#123;-&amp;#45;&amp;#45;&#125;&#123;faint&#125; %clr&#123;[%t]&#125;&#123;faint&#125; %clr&#123;%-40.40c&#123;1.&#125;&#125;&#123;cyan&#125; %clr&#123;:&#125;&#123;faint&#125; %m%n%xwEx</span><br><span class="line">        &lt;/Property&gt;--&gt;</span><br><span class="line">        &lt;Property name=&quot;LOG_PATTERN&quot;&gt;%clr&#123;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;&#125;&#123;faint&#125; | %clr&#123;%5p&#125; | %clr&#123;$&#123;sys:PID&#125;&#125;&#123;magenta&#125; | %clr&#123;%15.15t&#125;&#123;faint&#125; | %clr&#123;%-50.50c&#123;1.&#125;&#125;&#123;cyan&#125; | %5L | %clr&#123;%M&#125;&#123;magenta&#125; | %msg%n%xwEx</span><br><span class="line">        &lt;/Property&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;Appenders&gt;</span><br><span class="line">        &lt;!-- 输出控制台日志的配置 --&gt;</span><br><span class="line">        &lt;Console name=&quot;console&quot; target=&quot;SYSTEM_OUT&quot;&gt;</span><br><span class="line">            &lt;!--控制台只输出level及以上级别的信息（onMatch），其他的直接拒绝（onMismatch）--&gt;</span><br><span class="line">            &lt;ThresholdFilter level=&quot;info&quot; onMatch=&quot;ACCEPT&quot; onMismatch=&quot;DENY&quot;/&gt;</span><br><span class="line">            &lt;!-- 输出日志的格式 --&gt;</span><br><span class="line">            &lt;PatternLayout pattern=&quot;$&#123;LOG_PATTERN&#125;&quot; charset=&quot;UTF-8&quot;/&gt;</span><br><span class="line">        &lt;/Console&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- 打印出所有的信息，每次大小超过size，则这size大小的日志会自动存入按年份-月份建立的文件夹下面并进行压缩，作为存档 --&gt;</span><br><span class="line">        &lt;RollingRandomAccessFile name=&quot;infoFile&quot; fileName=&quot;$&#123;fileName&#125;/web-info.log&quot; immediateFlush=&quot;false&quot;</span><br><span class="line">                                 filePattern=&quot;$&#123;fileGz&#125;/$$&#123;date:yyyy-MM&#125;/%d&#123;yyyy-MM-dd&#125;-%i.web-info.gz&quot;&gt;</span><br><span class="line">            &lt;PatternLayout pattern=&quot;$&#123;LOG_PATTERN&#125;&quot; charset=&quot;UTF-8&quot;/&gt;</span><br><span class="line"></span><br><span class="line">            &lt;Policies&gt;</span><br><span class="line">                &lt;SizeBasedTriggeringPolicy size=&quot;20 MB&quot;/&gt;</span><br><span class="line">            &lt;/Policies&gt;</span><br><span class="line"></span><br><span class="line">            &lt;Filters&gt;</span><br><span class="line">                &lt;!-- 只记录info和warn级别信息 --&gt;</span><br><span class="line">                &lt;ThresholdFilter level=&quot;error&quot; onMatch=&quot;DENY&quot; onMismatch=&quot;NEUTRAL&quot;/&gt;</span><br><span class="line">                &lt;ThresholdFilter level=&quot;info&quot; onMatch=&quot;ACCEPT&quot; onMismatch=&quot;DENY&quot;/&gt;</span><br><span class="line">            &lt;/Filters&gt;</span><br><span class="line"></span><br><span class="line">            &lt;!-- 指定每天的最大压缩包个数，默认7个，超过了会覆盖之前的 --&gt;</span><br><span class="line">            &lt;DefaultRolloverStrategy max=&quot;50&quot;/&gt;</span><br><span class="line">        &lt;/RollingRandomAccessFile&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- 存储所有error信息 --&gt;</span><br><span class="line">        &lt;RollingRandomAccessFile name=&quot;errorFile&quot; fileName=&quot;$&#123;fileName&#125;/web-error.log&quot; immediateFlush=&quot;false&quot;</span><br><span class="line">                                 filePattern=&quot;$&#123;fileGz&#125;/$$&#123;date:yyyy-MM&#125;/%d&#123;yyyy-MM-dd&#125;-%i.web-error.gz&quot;&gt;</span><br><span class="line">            &lt;PatternLayout pattern=&quot;$&#123;LOG_PATTERN&#125;&quot; charset=&quot;UTF-8&quot;/&gt;</span><br><span class="line"></span><br><span class="line">            &lt;Policies&gt;</span><br><span class="line">                &lt;SizeBasedTriggeringPolicy size=&quot;50 MB&quot;/&gt;</span><br><span class="line">            &lt;/Policies&gt;</span><br><span class="line"></span><br><span class="line">            &lt;Filters&gt;</span><br><span class="line">                &lt;!-- 只记录error级别信息 --&gt;</span><br><span class="line">                &lt;ThresholdFilter level=&quot;error&quot; onMatch=&quot;ACCEPT&quot; onMismatch=&quot;DENY&quot;/&gt;</span><br><span class="line">            &lt;/Filters&gt;</span><br><span class="line"></span><br><span class="line">            &lt;!-- 指定每天的最大压缩包个数，默认7个，超过了会覆盖之前的 --&gt;</span><br><span class="line">            &lt;DefaultRolloverStrategy max=&quot;50&quot;/&gt;</span><br><span class="line">        &lt;/RollingRandomAccessFile&gt;</span><br><span class="line">    &lt;/Appenders&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- Mixed sync/async --&gt;</span><br><span class="line">    &lt;Loggers&gt;</span><br><span class="line">    </span><br><span class="line">        &lt;!--&lt;logger name=&quot;org.apache.http&quot; level=&quot;warn&quot;/&gt;</span><br><span class="line">        &lt;logger name=&quot;org.springframework&quot; level=&quot;WARN&quot;/&gt;</span><br><span class="line">        &lt;logger name=&quot;com.ibatis&quot; level=&quot;DEBUG&quot;/&gt;</span><br><span class="line">        &lt;logger name=&quot;com.ibatis.common.jdbc.SimpleDataSource&quot; level=&quot;DEBUG&quot;/&gt;</span><br><span class="line">        &lt;logger name=&quot;com.ibatis.common.jdbc.ScriptRunner&quot; level=&quot;DEBUG&quot;/&gt;</span><br><span class="line">        &lt;logger name=&quot;com.ibatis.sqlmap.engine.impl.SqlMapClientDelegate&quot; level=&quot;DEBUG&quot;/&gt;</span><br><span class="line">        &lt;logger name=&quot;java.sql.Connection&quot; level=&quot;DEBUG&quot; additivity=&quot;true&quot;/&gt;</span><br><span class="line">        &lt;logger name=&quot;java.sql.Statement&quot; level=&quot;DEBUG&quot; additivity=&quot;true&quot;/&gt;</span><br><span class="line">        &lt;logger name=&quot;java.sql.PreparedStatement&quot; level=&quot;=debug,stdout&quot; additivity=&quot;true&quot;/&gt;</span><br><span class="line">        &lt;logger name=&quot;java.sql.ResultSet&quot; level=&quot;DEBUG&quot; additivity=&quot;true&quot;/&gt;</span><br><span class="line">        &lt;logger name=&quot;org.apache&quot; level=&quot;WARN&quot;/&gt;</span><br><span class="line"></span><br><span class="line">        &amp;lt;!&amp;ndash; 对包进行更详细的配置 &amp;ndash;&amp;gt;</span><br><span class="line">        &amp;lt;!&amp;ndash; additivity表示是否追加,防止重复,因为root已经接收过一次了 &amp;ndash;&amp;gt;</span><br><span class="line">        &lt;logger name=&quot;com.my.blog.website.dao&quot; level=&quot;DEBUG&quot; additivity=&quot;true&quot;&gt;</span><br><span class="line">            &lt;appender-ref ref=&quot;db_log&quot;/&gt;</span><br><span class="line">        &lt;/logger&gt;</span><br><span class="line">        &lt;logger name=&quot;com.my.blog.website.controller&quot; level=&quot;DEBUG&quot; additivity=&quot;false&quot;&gt;</span><br><span class="line">            &lt;appender-ref ref=&quot;service_log&quot;/&gt;</span><br><span class="line">        &lt;/logger&gt;</span><br><span class="line">        &lt;logger name=&quot;com.my.blog.website.service&quot; level=&quot;DEBUG&quot; additivity=&quot;false&quot;&gt;</span><br><span class="line">            &lt;appender-ref ref=&quot;service_log&quot;/&gt;</span><br><span class="line">        &lt;/logger&gt;--&gt;</span><br><span class="line"></span><br><span class="line">        &lt;AsyncRoot level=&quot;debug&quot; includeLocation=&quot;true&quot;&gt;</span><br><span class="line">            &lt;AppenderRef ref=&quot;console&quot;/&gt;</span><br><span class="line">            &lt;AppenderRef ref=&quot;infoFile&quot;/&gt;</span><br><span class="line">            &lt;AppenderRef ref=&quot;errorFile&quot;/&gt;</span><br><span class="line">        &lt;/AsyncRoot&gt;</span><br><span class="line">    &lt;/Loggers&gt;</span><br><span class="line"></span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>
<h2 id="也可以使用log4j2-yml"><a href="#也可以使用log4j2-yml" class="headerlink" title="也可以使用log4j2.yml"></a>也可以使用log4j2.yml</h2><p>需要引入依赖以识别：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 加上这个才能辨认到log4j2.yml文件 --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.fasterxml.jackson.dataformat&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jackson-dataformat-yaml&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p><code>log4j2.yml</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">Configuration:</span><br><span class="line">  status: &quot;OFF&quot;</span><br><span class="line">  monitorInterval: 10</span><br><span class="line"></span><br><span class="line">  Properties:</span><br><span class="line">    Property:</span><br><span class="line">      - name: log.level.console</span><br><span class="line">        value: debug</span><br><span class="line">      - name: PID</span><br><span class="line">        value: ????</span><br><span class="line">      - name: LOG_PATTERN</span><br><span class="line">        value: &quot;%clr&#123;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;&#125;&#123;faint&#125; | %clr&#123;%5p&#125; | %clr&#123;$&#123;sys:PID&#125;&#125;&#123;magenta&#125; | %clr&#123;%15.15t&#125;&#123;faint&#125; | %clr&#123;%-50.50c&#123;1.&#125;&#125;&#123;cyan&#125; | %5L | %clr&#123;%M&#125;&#123;magenta&#125; | %msg%n%xwEx&quot;</span><br><span class="line"></span><br><span class="line">  Appenders:</span><br><span class="line">    Console:  #输出到控制台</span><br><span class="line">      name: CONSOLE</span><br><span class="line">      target: SYSTEM_OUT</span><br><span class="line">      ThresholdFilter:</span><br><span class="line">        level: $&#123;sys:log.level.console&#125; # “sys:”表示：如果VM参数中没指定这个变量值，则使用本文件中定义的缺省全局变量值</span><br><span class="line">        onMatch: ACCEPT</span><br><span class="line">        onMismatch: DENY</span><br><span class="line">      PatternLayout:</span><br><span class="line">        pattern: $&#123;LOG_PATTERN&#125;</span><br><span class="line">        charset: UTF-8</span><br><span class="line">  Loggers:</span><br><span class="line">    Root:</span><br><span class="line">      level: info</span><br><span class="line">      includeLocation: true</span><br><span class="line">      AppenderRef:</span><br><span class="line">        - ref: CONSOLE</span><br><span class="line">    AsyncRoot:</span><br><span class="line">      level: info</span><br><span class="line">      includeLocation: true</span><br><span class="line">      AppenderRef:</span><br><span class="line">        - ref: CONSOLE</span><br></pre></td></tr></table></figure>
<p>更多配置请参照：<em><a href="http://logging.apache.org/log4j/2.x/manual/layouts.html" rel="external nofollow noopener noreferrer" target="_blank">http://logging.apache.org/log4j/2.x/manual/layouts.html</a></em></p>
<h1 id="查看依赖树"><a href="#查看依赖树" class="headerlink" title="查看依赖树"></a>查看依赖树</h1><p>如果引入了某些jar包带有<code>logback</code>依赖，log4j2会失效，需要通过IDEA或Maven查找排除依赖：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn dependency:tree</span><br></pre></td></tr></table></figure>
<h1 id="常用连接池配置"><a href="#常用连接池配置" class="headerlink" title="常用连接池配置"></a>常用连接池配置</h1><blockquote>
<p>Spring Boot 2 默认使用 <a href="https://github.com/brettwooldridge/HikariCP" rel="external nofollow noopener noreferrer" target="_blank"><em>HikariCP</em></a> 作为连接池</p>
</blockquote>
<p>如果项目中已包含<code>spring-boot-starter-jdbc</code>或<code>spring-boot-starter-jpa</code>模块，那么连接池将<strong>自动激活</strong>！</p>
<p>在Spring Boot2中选择数据库链接池实现的判断逻辑：</p>
<ol>
<li>检查HikariCP是否可用，如可用，则启用。使用<code>spring.datasource.hikari.*</code>可以控制链接池的行为。</li>
<li>检查Tomcat的数据库链接池实现是否可用，如可用，则启用。使用<code>spring.datasource.tomcat.*</code>可以控制链接池的行为。</li>
<li>检查Commons DBCP2是否可用，如可用，则启用。使用<code>spring.datasource.dbcp2.*</code>可以控制链接池的行为。</li>
</ol>
<h2 id="HikariCP-连接池常用属性"><a href="#HikariCP-连接池常用属性" class="headerlink" title="HikariCP 连接池常用属性"></a>HikariCP 连接池常用属性</h2><table>
<thead>
<tr>
<th>属性</th>
<th>描述</th>
<th>默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td>dataSourceClassName</td>
<td>JDBC 驱动程序提供的 DataSource 类的名称，如果使用了jdbcUrl则不需要此属性</td>
<td>-</td>
</tr>
<tr>
<td>jdbcUrl</td>
<td>数据库连接地址</td>
<td>-</td>
</tr>
<tr>
<td>username</td>
<td>数据库账户，如果使用了jdbcUrl则需要此属性</td>
<td>-</td>
</tr>
<tr>
<td>password</td>
<td>数据库密码，如果使用了jdbcUrl则需要此属性</td>
<td>-</td>
</tr>
<tr>
<td>autoCommit</td>
<td>是否自动提交事务</td>
<td>true</td>
</tr>
<tr>
<td>connectionTimeout</td>
<td>连接超时时间（毫秒），如果在没有连接可用的情况下等待超过此时间，则抛出 SQLException</td>
<td>30000（30秒）</td>
</tr>
<tr>
<td>idleTimeout</td>
<td>空闲超时时间（毫秒），只有在minimumIdle&lt;maximumPoolSize时生效，超时的连接可能被回收，数值 0 表示空闲连接永不从池中删除</td>
<td>600000（10分钟）</td>
</tr>
<tr>
<td>maxLifetime</td>
<td>连接池中的连接的最长生命周期（毫秒）。数值 0 表示不限制</td>
<td>1800000（30分钟）</td>
</tr>
<tr>
<td>connectionTestQuery</td>
<td>连接池每分配一条连接前执行的查询语句（如：SELECT 1），以验证该连接是否是有效的。如果你的驱动程序支持 JDBC4，HikariCP 强烈建议我们不要设置此属性</td>
<td>-</td>
</tr>
<tr>
<td>minimumIdle</td>
<td>最小空闲连接数，HikariCP 建议我们不要设置此值，而是充当固定大小的连接池</td>
<td>与maximumPoolSize数值相同</td>
</tr>
<tr>
<td>maximumPoolSize</td>
<td>连接池中可同时连接的最大连接数，当池中没有空闲连接可用时，就会阻塞直到超出connectionTimeout设定的数值，推荐的公式：((core_count * 2) + effective_spindle_count)</td>
<td>10</td>
</tr>
<tr>
<td>poolName</td>
<td>连接池名称，主要用于显示在日志记录和 JMX 管理控制台中</td>
<td>auto-generated</td>
</tr>
</tbody>
</table>
<p><code>application.yml</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  datasource:</span><br><span class="line">      url: jdbc:mysql://127.0.0.1/spring_boot_testing_storage</span><br><span class="line">      username: root</span><br><span class="line">      password: root</span><br><span class="line">      driver-class-name: com.mysql.jdbc.Driver</span><br><span class="line">#     type: com.zaxxer.hikari.HikariDataSource #Spring Boot2.0默认使用HikariDataSource</span><br><span class="line">      hikari:</span><br><span class="line">        auto-commit: false</span><br><span class="line">        maximum-pool-size: 9 #连接池中允许的最大连接数。缺省值：10；推荐的公式：((core_count * 2) + effective_spindle_count)</span><br></pre></td></tr></table></figure>
<h2 id="Tomcat连接池常用的属性"><a href="#Tomcat连接池常用的属性" class="headerlink" title="Tomcat连接池常用的属性"></a>Tomcat连接池常用的属性</h2><table>
<thead>
<tr>
<th>属性</th>
<th>描述</th>
<th>默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td>defaultAutoCommit</td>
<td>连接池中创建的连接默认是否自动提交事务</td>
<td>驱动的缺省值</td>
</tr>
<tr>
<td>defaultReadOnly</td>
<td>连接池中创建的连接默认是否为只读状态</td>
<td>-</td>
</tr>
<tr>
<td>defaultCatalog</td>
<td>连接池中创建的连接默认的 catalog</td>
<td>-</td>
</tr>
<tr>
<td>driverClassName</td>
<td>驱动类的名称</td>
<td>-</td>
</tr>
<tr>
<td>username</td>
<td>数据库账户</td>
<td>-</td>
</tr>
<tr>
<td>password</td>
<td>数据库密码</td>
<td>-</td>
</tr>
<tr>
<td>maxActive</td>
<td>连接池同一时间可分配的最大活跃连接数</td>
<td>100</td>
</tr>
<tr>
<td>maxIdle</td>
<td>始终保留在池中的最大连接数，如果启用，将定期检查限制连接，超出此属性设定的值且空闲时间超过minEvictableIdleTimeMillis的连接则释放</td>
<td>与maxActive设定的值相同</td>
</tr>
<tr>
<td>minIdle</td>
<td>始终保留在池中的最小连接数，池中的连接数量若低于此值则创建新的连接，如果连接验证失败将缩小至此值</td>
<td>与initialSize设定的值相同</td>
</tr>
<tr>
<td>initialSize</td>
<td>连接池启动时创建的初始连接数量</td>
<td>10</td>
</tr>
<tr>
<td>maxWait</td>
<td>最大等待时间（毫秒），如果在没有连接可用的情况下等待超过此时间，则抛出异常</td>
<td>30000（30秒）</td>
</tr>
<tr>
<td>testOnBorrow</td>
<td>当从连接池中取出一个连接时是否进行验证，若验证失败则从池中删除该连接并尝试取出另一个连接</td>
<td>false</td>
</tr>
<tr>
<td>testOnConnect</td>
<td>当一个连接首次被创建时是否进行验证，若验证失败则抛出 SQLException 异常</td>
<td>false</td>
</tr>
<tr>
<td>testOnReturn</td>
<td>当一个连接使用完归还到连接池时是否进行验证</td>
<td>false</td>
</tr>
<tr>
<td>testWhileIdle</td>
<td>对池中空闲的连接是否进行验证，验证失败则回收此连接</td>
<td>false</td>
</tr>
<tr>
<td>validationQuery</td>
<td>在连接池返回连接给调用者前用来对连接进行验证的查询 SQL</td>
<td>null</td>
</tr>
<tr>
<td>validationQueryTimeout</td>
<td>SQL 查询验证超时时间（秒），小于或等于 0 的数值表示禁用</td>
<td>-1</td>
</tr>
<tr>
<td>timeBetweenEvictionRunsMillis</td>
<td>在空闲连接回收器线程运行期间休眠时间（毫秒）， 该值不应该小于 1 秒，它决定线程多久验证空闲连接或丢弃连接的频率</td>
<td>5000（5秒）</td>
</tr>
<tr>
<td>minEvictableIdleTimeMillis</td>
<td>连接在池中保持空闲而不被回收的最小时间（毫秒）</td>
<td>60000（60秒）</td>
</tr>
<tr>
<td>removeAbandoned</td>
<td>标记是否删除泄露的连接，如果连接超出removeAbandonedTimeout的限制，且该属性设置为 true，则连接被认为是被泄露并且可以被删除</td>
<td>false</td>
</tr>
<tr>
<td>removeAbandonedTimeout</td>
<td>泄露的连接可以被删除的超时时间（秒），该值应设置为应用程序查询可能执行的最长时间</td>
<td>60</td>
</tr>
</tbody>
</table>
<p><code>application.yml</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  datasource:</span><br><span class="line">    url: jdbc:mysql://127.0.0.1/spring_boot_testing_storage</span><br><span class="line">    username: root</span><br><span class="line">    password: root</span><br><span class="line">    driver-class-name: com.mysql.jdbc.Driver</span><br><span class="line">    tomcat:</span><br><span class="line">      default-auto-commit: true</span><br><span class="line">      initial-size: 30</span><br><span class="line">      max-active: 120</span><br><span class="line">      max-wait: 10000</span><br><span class="line">      test-on-borrow: true</span><br><span class="line">      test-while-idle: true</span><br><span class="line">      validation-query: &apos;SELECT 1&apos;</span><br><span class="line">      validation-query-timeout: 3</span><br><span class="line">      time-between-eviction-runs-millis: 10000</span><br><span class="line">      min-evictable-idle-time-millis: 120000</span><br><span class="line">      remove-abandoned: true</span><br><span class="line">      remove-abandoned-timeout: 120</span><br></pre></td></tr></table></figure>
<h2 id="DBCP-连接池常用配置"><a href="#DBCP-连接池常用配置" class="headerlink" title="DBCP 连接池常用配置"></a>DBCP 连接池常用配置</h2><table>
<thead>
<tr>
<th>属性</th>
<th>描述</th>
<th>默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td>url</td>
<td>数据库连接地址</td>
<td>-</td>
</tr>
<tr>
<td>username</td>
<td>数据库账户</td>
<td>-</td>
</tr>
<tr>
<td>password</td>
<td>数据库密码</td>
<td>-</td>
</tr>
<tr>
<td>driverClassName</td>
<td>驱动类的名称</td>
<td>-</td>
</tr>
<tr>
<td>defaultAutoCommit</td>
<td>连接池中创建的连接默认是否自动提交事务</td>
<td>驱动的缺省值</td>
</tr>
<tr>
<td>defaultReadOnly</td>
<td>连接池中创建的连接默认是否为只读状态</td>
<td>驱动的缺省值</td>
</tr>
<tr>
<td>defaultCatalog</td>
<td>连接池中创建的连接默认的 catalog</td>
<td>-</td>
</tr>
<tr>
<td>initialSize</td>
<td>连接池启动时创建的初始连接数量</td>
<td>0</td>
</tr>
<tr>
<td>maxTotal</td>
<td>连接池同一时间可分配的最大活跃连接数；负数表示不限制</td>
<td>8</td>
</tr>
<tr>
<td>maxIdle</td>
<td>可以在池中保持空闲的最大连接数，超出此值的空闲连接被释放，负数表示不限制</td>
<td>8</td>
</tr>
<tr>
<td>minIdle</td>
<td>可以在池中保持空闲的最小连接数，低于此值将创建空闲连接，若设置为 0，则不创建</td>
<td>0</td>
</tr>
<tr>
<td>maxWaitMillis</td>
<td>最大等待时间（毫秒），如果在没有连接可用的情况下等待超过此时间，则抛出异常；-1 表示无限期等待，直到获取到连接为止</td>
<td>-</td>
</tr>
<tr>
<td>validationQuery</td>
<td>在连接池返回连接给调用者前用来对连接进行验证的查询 SQL</td>
<td>-</td>
</tr>
<tr>
<td>validationQueryTimeout</td>
<td>SQL 查询验证超时时间（秒）</td>
<td>-</td>
</tr>
<tr>
<td>testOnCreate</td>
<td>连接在创建之后是否进行验证</td>
<td>false</td>
</tr>
<tr>
<td>testOnBorrow</td>
<td>当从连接池中取出一个连接时是否进行验证，若验证失败则从池中删除该连接并尝试取出另一个连接</td>
<td>true</td>
</tr>
<tr>
<td>testOnReturn</td>
<td>当一个连接使用完归还到连接池时是否进行验证</td>
<td>false</td>
</tr>
<tr>
<td>testWhileIdle</td>
<td>对池中空闲的连接是否进行验证，验证失败则释放此连接</td>
<td>false</td>
</tr>
<tr>
<td>timeBetweenEvictionRunsMillis</td>
<td>在空闲连接回收器线程运行期间休眠时间（毫秒），如果设置为非正数，则不运行此线程</td>
<td>-1</td>
</tr>
<tr>
<td>numTestsPerEvictionRun</td>
<td>空闲连接回收器线程运行期间检查连接的个数</td>
<td>3</td>
</tr>
<tr>
<td>minEvictableIdleTimeMillis</td>
<td>连接在池中保持空闲而不被回收的最小时间（毫秒）</td>
<td>1800000（30分钟）</td>
</tr>
<tr>
<td>removeAbandonedOnBorrow</td>
<td>标记是否删除泄露的连接，如果连接超出removeAbandonedTimeout的限制，且该属性设置为 true，则连接被认为是被泄露并且可以被删除</td>
<td>false</td>
</tr>
<tr>
<td>removeAbandonedTimeout</td>
<td>泄露的连接可以被删除的超时时间（秒），该值应设置为应用程序查询可能执行的最长时间</td>
<td>300（5分钟）</td>
</tr>
<tr>
<td>poolPreparedStatements</td>
<td>设置该连接池的预处理语句池是否生效</td>
<td>false</td>
</tr>
</tbody>
</table>
<p><code>application.yml</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  jmx:</span><br><span class="line">    enabled: false</span><br><span class="line">  datasource:</span><br><span class="line">    url: jdbc:mysql://127.0.0.1/spring_boot_testing_storage</span><br><span class="line">    username: root</span><br><span class="line">    password: root</span><br><span class="line">    driver-class-name: com.mysql.jdbc.Driver</span><br><span class="line">    dbcp2:</span><br><span class="line">      default-auto-commit: true</span><br><span class="line">      initial-size: 30</span><br><span class="line">      max-total: 120</span><br><span class="line">      max-idle: 120</span><br><span class="line">      min-idle: 30</span><br><span class="line">      max-wait-millis: 10000</span><br><span class="line">      validation-query: &apos;SELECT 1&apos;</span><br><span class="line">      validation-query-timeout: 3</span><br><span class="line">      test-on-borrow: true</span><br><span class="line">      test-while-idle: true</span><br><span class="line">      time-between-eviction-runs-millis: 10000</span><br><span class="line">      num-tests-per-eviction-run: 10</span><br><span class="line">      min-evictable-idle-time-millis: 120000</span><br><span class="line">      remove-abandoned-on-borrow: true</span><br><span class="line">      remove-abandoned-timeout: 120</span><br><span class="line">      pool-prepared-statements: true</span><br></pre></td></tr></table></figure>
<p>Spring Boot Data Jpa 依赖声明：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">通过application.yml: spring.datasource.type=...配置</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;commons-dbcp2&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.2.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<h2 id="Druid连接池配置"><a href="#Druid连接池配置" class="headerlink" title="Druid连接池配置"></a>Druid连接池配置</h2><p>参考：<strong><em><a href="https://github.com/alibaba/druid/tree/master/druid-spring-boot-starter" rel="external nofollow noopener noreferrer" target="_blank">https://github.com/alibaba/druid/tree/master/druid-spring-boot-starter</a></em></strong></p>
<h1 id="Spring-MVC集成fastjson"><a href="#Spring-MVC集成fastjson" class="headerlink" title="Spring MVC集成fastjson"></a>Spring MVC集成fastjson</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;fastjson&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.2.46&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>两种方式：</p>
<h2 id="方式一、实现WebMvcConfigurer"><a href="#方式一、实现WebMvcConfigurer" class="headerlink" title="方式一、实现WebMvcConfigurer"></a>方式一、实现<code>WebMvcConfigurer</code></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class WebMvcMessageConvertConfig implements WebMvcConfigurer &#123;</span><br><span class="line">	@Override</span><br><span class="line">	public void configureMessageConverters(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters) &#123;</span><br><span class="line">		FastJsonHttpMessageConverter fastConverter = new FastJsonHttpMessageConverter();</span><br><span class="line"></span><br><span class="line">		SerializeConfig serializeConfig = SerializeConfig.globalInstance;</span><br><span class="line">		serializeConfig.put(BigInteger.class, ToStringSerializer.instance);</span><br><span class="line">		serializeConfig.put(Long.class, ToStringSerializer.instance);</span><br><span class="line">		serializeConfig.put(Long.TYPE, ToStringSerializer.instance);</span><br><span class="line"></span><br><span class="line">		FastJsonConfig fastJsonConfig = new FastJsonConfig();</span><br><span class="line">		fastJsonConfig.setCharset(Charset.forName(&quot;UTF-8&quot;));</span><br><span class="line">		fastJsonConfig.setSerializeConfig(serializeConfig);</span><br><span class="line">		fastJsonConfig.setSerializerFeatures(SerializerFeature.PrettyFormat);</span><br><span class="line">		fastJsonConfig.setDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);</span><br><span class="line"></span><br><span class="line">		fastConverter.setFastJsonConfig(fastJsonConfig);</span><br><span class="line"></span><br><span class="line">		converters.add(fastConverter);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="方式二、通过-Bean方式"><a href="#方式二、通过-Bean方式" class="headerlink" title="方式二、通过@Bean方式"></a>方式二、通过<code>@Bean</code>方式</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class WebMvcMessageConvertConfig &#123;</span><br><span class="line">	@Bean</span><br><span class="line">	public HttpMessageConverters fastJsonHttpMessageConverter() &#123;</span><br><span class="line">		FastJsonHttpMessageConverter fastConverter = new FastJsonHttpMessageConverter();</span><br><span class="line"></span><br><span class="line">		SerializeConfig serializeConfig = SerializeConfig.globalInstance;</span><br><span class="line">		serializeConfig.put(BigInteger.class, ToStringSerializer.instance);</span><br><span class="line">		serializeConfig.put(Long.class, ToStringSerializer.instance);</span><br><span class="line">		serializeConfig.put(Long.TYPE, ToStringSerializer.instance);</span><br><span class="line"></span><br><span class="line">		FastJsonConfig fastJsonConfig = new FastJsonConfig();</span><br><span class="line">		fastJsonConfig.setCharset(Charset.forName(Constant.CHARSET));</span><br><span class="line">		fastJsonConfig.setSerializeConfig(serializeConfig);</span><br><span class="line">		fastJsonConfig.setSerializerFeatures(SerializerFeature.PrettyFormat);</span><br><span class="line">		fastJsonConfig.setDateFormat(Constant.DATE_FORMAT);</span><br><span class="line"></span><br><span class="line">		fastConverter.setFastJsonConfig(fastJsonConfig);</span><br><span class="line">		return new HttpMessageConverters((HttpMessageConverter&lt;?&gt;) fastConverter);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="WebFlux"><a href="#WebFlux" class="headerlink" title="WebFlux"></a>WebFlux</h2><p>上面针对的是Web MVC，<strong>对于Webflux目前不支持这种方式</strong>，只能先这么设置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  jackson:</span><br><span class="line">    default-property-inclusion: non_null # 过滤值为null的字段</span><br><span class="line">    date-format: &quot;yyyy-MM-dd HH:mm:ss&quot;</span><br></pre></td></tr></table></figure>
<h1 id="开启GZIP算法压缩响应流"><a href="#开启GZIP算法压缩响应流" class="headerlink" title="开启GZIP算法压缩响应流"></a>开启GZIP算法压缩响应流</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  compression:</span><br><span class="line">    enabled: true # 启用压缩</span><br><span class="line">    min-response-size: 2048 # 对应Content-Length，超过这个值才会压缩</span><br></pre></td></tr></table></figure>
<h1 id="创建异步方法"><a href="#创建异步方法" class="headerlink" title="创建异步方法"></a>创建异步方法</h1><h2 id="启动异步"><a href="#启动异步" class="headerlink" title="启动异步"></a>启动异步</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">@EnableAsync</span><br><span class="line">public class SpringAsyncConfig &#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>配置完这个就已经具备异步方法功能了，只需要在方法上面添加<code>@Async</code>即可</p>
<p>如果被<code>@Async</code>注解的方法所在类是基于接口实现的，想要直接注入实现类，需要添加：<code>@EnableAsync(proxyTargetClass = true)</code> 以使用CGLIB代理</p>
<h2 id="编写异步方法"><a href="#编写异步方法" class="headerlink" title="编写异步方法"></a>编写异步方法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Async</span><br><span class="line">public void asyncMethodWithVoidReturnType() throws InterruptedException &#123;</span><br><span class="line">	System.out.println(&quot;Execute method asynchronously. &quot; + Thread.currentThread().getName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="配置线程池"><a href="#配置线程池" class="headerlink" title="配置线程池"></a>配置线程池</h2><p>在不配置线程池的情况下，Spring默认使用<code>SimpleAsyncTaskExecutor</code>，每一次的执行任务都会使用新的线程，性能不太好，所以我们可以自定义线程池</p>
<h3 id="直接定义线程池"><a href="#直接定义线程池" class="headerlink" title="直接定义线程池"></a>直接定义线程池</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">@EnableAsync</span><br><span class="line">public class SpringAsyncConfig &#123;</span><br><span class="line">	@Bean</span><br><span class="line">	public Executor threadPoolTaskExecutor() &#123;</span><br><span class="line">		ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();</span><br><span class="line">		executor.setCorePoolSize(8);</span><br><span class="line">		executor.setMaxPoolSize(42);</span><br><span class="line">		executor.setQueueCapacity(500);</span><br><span class="line">		executor.setThreadNamePrefix(&quot;asyncExecutor-&quot;);</span><br><span class="line">		executor.initialize();</span><br><span class="line">		return executor;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="实现AsyncConfigurer"><a href="#实现AsyncConfigurer" class="headerlink" title="实现AsyncConfigurer"></a>实现AsyncConfigurer</h3><p><code>AsyncConfigurer</code>接口有两个方法：</p>
<ul>
<li><code>getAsyncExecutor()</code>: 提供线程池</li>
<li><code>getAsyncUncaughtExceptionHandler()</code>: 异步任务异常处理</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">@EnableAsync</span><br><span class="line">public class SpringAsyncConfig implements AsyncConfigurer &#123;</span><br><span class="line">	@Override</span><br><span class="line">	public Executor getAsyncExecutor() &#123;</span><br><span class="line">		ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();</span><br><span class="line">		executor.setCorePoolSize(8);</span><br><span class="line">		executor.setMaxPoolSize(42);</span><br><span class="line">		executor.setQueueCapacity(500);</span><br><span class="line">		executor.setThreadNamePrefix(&quot;MyExecutor-&quot;);</span><br><span class="line">		executor.initialize();</span><br><span class="line">		return executor;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	@Override</span><br><span class="line">	public AsyncUncaughtExceptionHandler getAsyncUncaughtExceptionHandler()&#123;</span><br><span class="line">		return (ex, method, params) -&gt; &#123;</span><br><span class="line">			ExceptionUtils.printRootCauseStackTrace(ex);</span><br><span class="line">			System.out.println(&quot;Exception message - &quot; + ex.getMessage());</span><br><span class="line">			System.out.println(&quot;Method name - &quot; + method.getName());</span><br><span class="line">			for (Object param : params) &#123;</span><br><span class="line">				System.out.println(&quot;Parameter value - &quot; + param);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Async使用指定线程池"><a href="#Async使用指定线程池" class="headerlink" title="Async使用指定线程池"></a>Async使用指定线程池</h2><p>如果同时实现了<code>AsyncConfigurer</code>以及配置线程池，那么<code>@Async</code>默认使用<code>AsyncConfigurer.getAsyncExecutor</code>的线程池。</p>
<p>如果需要指定线程池可以这样</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@Bean(&quot;threadPoolTaskExecutor&quot;)</span><br><span class="line">public Executor threadPoolTaskExecutor() &#123;</span><br><span class="line">	ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();</span><br><span class="line">	executor.setCorePoolSize(8);</span><br><span class="line">	executor.setMaxPoolSize(42);</span><br><span class="line">	executor.setQueueCapacity(500);</span><br><span class="line">	executor.setThreadNamePrefix(&quot;asyncExecutor-&quot;);</span><br><span class="line">	executor.initialize();</span><br><span class="line">	return executor;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@Async(&quot;threadPoolTaskExecutor&quot;)</span><br><span class="line">public void someMethod()&#123;...&#125;</span><br></pre></td></tr></table></figure>
<h2 id="获取异步执行结果"><a href="#获取异步执行结果" class="headerlink" title="获取异步执行结果"></a>获取异步执行结果</h2><p>Service：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Async(&quot;threadPoolTaskExecutor&quot;)</span><br><span class="line">@Override</span><br><span class="line">public Future&lt;String&gt; asyncMethodWithVoidReturnType() throws InterruptedException &#123;</span><br><span class="line">	Thread.sleep(2000L);</span><br><span class="line">	return AsyncResult.forValue(&quot;Execute method asynchronously. &quot; + Thread.currentThread().getName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Controller：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@GetMapping(&quot;/hello&quot;)</span><br><span class="line">public Mono&lt;String&gt; syaHello() throws InterruptedException, ExecutionException &#123;</span><br><span class="line">	Future&lt;String&gt; stringFuture = someService.asyncMethodWithVoidReturnType();</span><br><span class="line">	while (!stringFuture.isDone())&#123;</span><br><span class="line">		System.out.println(&quot;wait...&quot;);</span><br><span class="line">		Thread.sleep(500L);</span><br><span class="line">	&#125;</span><br><span class="line">	System.out.println(stringFuture.get());</span><br><span class="line">	return Mono.just(&quot;Hello World&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wait...</span><br><span class="line">wait...</span><br><span class="line">wait...</span><br><span class="line">wait...</span><br><span class="line">wait...</span><br><span class="line">Execute method asynchronously. asyncExecutor-1</span><br></pre></td></tr></table></figure>
<h1 id="Spring定时任务"><a href="#Spring定时任务" class="headerlink" title="Spring定时任务"></a>Spring定时任务</h1><p>启用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">@EnableScheduling</span><br><span class="line">public class SpringScheduleConfig implements SchedulingConfigurer &#123;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public void configureTasks(ScheduledTaskRegistrar taskRegistrar) &#123;</span><br><span class="line">		taskRegistrar.setScheduler(taskExecutor());</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	@Bean</span><br><span class="line">	public Executor taskExecutor() &#123;</span><br><span class="line">		return new ScheduledThreadPoolExecutor(4,</span><br><span class="line">				new BasicThreadFactory</span><br><span class="line">						.Builder()</span><br><span class="line">						.namingPattern(&quot;schedule-pool-thread-%d&quot;)</span><br><span class="line">						.daemon(true)</span><br><span class="line">						.build());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>定时任务：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">private int i = 0;</span><br><span class="line"></span><br><span class="line">@Scheduled(fixedDelay=1000)</span><br><span class="line">public void doScheduled() &#123;</span><br><span class="line">	System.out.println(Thread.currentThread().getName() + &quot;  &quot; + ++i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">schedule-pool-thread-1  2</span><br><span class="line">schedule-pool-thread-2  3</span><br><span class="line">schedule-pool-thread-1  4</span><br><span class="line">schedule-pool-thread-3  5</span><br><span class="line">schedule-pool-thread-2  6</span><br></pre></td></tr></table></figure>
<h1 id="Spring启动后执行程序的几种方式"><a href="#Spring启动后执行程序的几种方式" class="headerlink" title="Spring启动后执行程序的几种方式"></a>Spring启动后执行程序的几种方式</h1><ol>
<li><p>通过<code>@PostConstruct</code>或实现<code>InitializingBean</code>实现初始化<code>bean</code>的时候干一些事情，两者区别在于<code>InitializingBean</code>是在属性设置完之后执行的，所以执行顺序是在<code>@PostConstruct</code>之前</p>
<blockquote>
<p>由于此接口的方法afterPropertiesSet是在对象的所有属性被初始化后才会调用。当Spring的配置文件中设置类初始默认为”延迟初始”（<code>default-lazy-init=&quot;true&quot;</code>，此值默认为false）时，</p>
<p>类对象如果不被使用，则不会实例化该类对象。所以 InitializingBean子类不能用于在容器启动时进行初始化的工作，则应使用Spring提供的<code>ApplicationListener</code>接口来进行程序的初始化工作。</p>
<p>另外，如果需要InitializingBean子类对象在Spring容器启动时就初始化并则容器调用afterPropertiesSet方法则需要在类上增加<code>org.springframework.context.annotation.Lazy</code>注解并设置为false即可（也可通过spring配置bean时添加<code>lazy-init=&quot;false&quot;</code>)。</p>
</blockquote>
</li>
<li><p>通过监听<code>ContextRefreshedEvent</code>事件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public class ApplicationContextRefreshedEventListener implements ApplicationListener&lt;ContextRefreshedEvent&gt; &#123;</span><br><span class="line">	@Override</span><br><span class="line">	public void onApplicationEvent(ContextRefreshedEvent event) &#123;</span><br><span class="line">		System.out.println(&quot;ContextRefreshedEvent process...&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">或者</span><br><span class="line">@EventListener</span><br><span class="line">public void processContextRefreshedEvent(ContextRefreshedEvent event) throws InterruptedException &#123;</span><br><span class="line">	log.info(&quot;ContextRefreshedEvent process...&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以下是Spring的内置事件</p>
<p>| Spring 内置事件               | 描述                                       |<br>| ————————- | —————————————- |<br>| <strong>ContextRefreshedEvent</strong> | <code>ApplicationContext</code>被初始化或刷新时，该事件被发布。这也可以在<code>ConfigurableApplicationContext</code>接口中使用<code>refresh()</code>方法来发生。 |<br>| <strong>ContextStartedEvent</strong>   | 当使用<code>ConfigurableApplicationContext</code>接口中的<code>start()</code>方法启动<code>ApplicationContext</code>时，该事件被触发。你可以查询你的数据库，或者你可以在接受到这个事件后重启任何停止的应用程序。 |<br>| <strong>ContextStoppedEvent</strong>   | 当使用<code>ConfigurableApplicationContext</code>接口中的<code>stop()</code>方法停止<code>ApplicationContext</code>时，该事件被触发。你可以在接受到这个事件后做必要的清理的工作。 |<br>| <strong>ContextClosedEvent</strong>    | 当使用<code>ConfigurableApplicationContext</code>接口中的<code>close()</code>方法关闭<code>ApplicationContext</code>时，该事件被触发。一个已关闭的上下文到达生命周期末端；它不能被刷新或重启。 |<br>| <strong>RequestHandledEvent</strong>   | 这是一个<code>web-specific</code>事件，告诉所有<code>bean</code> HTTP请求已经被服务。 |</p>
<p>Spring的事件处理是单线程的，所以如果一个事件被触发，除非所有的接收者得到消息，否则这些进程被阻止，流程将不会继续。因此，如果要使用事件处理，在设计应用程序时应小心。</p>
<p><strong>注意！</strong>发现在Spring Boot 2中通过监听内置事件，都会发布两次，不知道这是BUG还是啥，所以需要确保方法<strong>幂等性</strong>或者做<strong>只消费一次处理</strong></p>
</li>
<li><p>实现<code>ApplicationRunner</code>或<code>CommandLineRunner</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootApplication</span><br><span class="line">public class ProdSyncLayerApplication implements ApplicationRunner,CommandLineRunner&#123;</span><br><span class="line"></span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		SpringApplication.run(ProdSyncLayerApplication.class, args);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public void run(ApplicationArguments args) throws Exception &#123;</span><br><span class="line">		System.out.println(&quot;ApplicationRunner...&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public void run(String... args) throws Exception &#123;</span><br><span class="line">		System.out.println(&quot;CommandLineRunner...&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>ApplicationRunner</code>比<code>CommandLineRunner</code>先执行</p>
</li>
</ol>
<p><strong>总结</strong>：以上三种方式的顺序跟其序号一样</p>
<h1 id="Spring应用停止前执行程序的几种方式"><a href="#Spring应用停止前执行程序的几种方式" class="headerlink" title="Spring应用停止前执行程序的几种方式"></a>Spring应用停止前执行程序的几种方式</h1><ol>
<li><p>监听<code>ContextClosedEvent</code></p>
</li>
<li><p>实现<code>DisposableBean</code>或使用<code>@PostConstruct</code>，执行顺序：<code>@PostConstruct</code> &gt; <code>DisposableBean</code></p>
</li>
<li><p>使用ShutdownHook:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">public class ShutdownHook &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws InterruptedException &#123;</span><br><span class="line">        Runtime.getRuntime().addShutdownHook(new Thread(() -&gt; &#123;</span><br><span class="line">            try (FileWriter fw = new FileWriter(&quot;hook.log&quot;)) &#123;</span><br><span class="line">                // 假设记录日志/或者发送消息</span><br><span class="line">                fw.write(&quot;完成销毁操作,回收内存! &quot; + (new Date()).toString());</span><br><span class="line">                System.out.println(&quot;退出程序...&quot;);</span><br><span class="line">            &#125; catch (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;));</span><br><span class="line">        IntStream.range(0, 10).forEach(i -&gt; &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                System.out.println(&quot;正在工作...&quot;);</span><br><span class="line">                Thread.sleep(2000L);</span><br><span class="line">            &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​</p>
</li>
</ol>
<h1 id="Spring-Boot-事件"><a href="#Spring-Boot-事件" class="headerlink" title="Spring Boot 事件"></a>Spring Boot 事件</h1><p>在Spring Boot 2.0中对事件模型做了一些增强，主要就是增加了<code>ApplicationStartedEvent</code>事件，所以在2.0版本中所有的事件按执行的先后顺序如下：</p>
<ul>
<li><code>ApplicationStartingEvent</code></li>
<li><code>ApplicationEnvironmentPreparedEvent</code></li>
<li><code>ApplicationPreparedEvent</code></li>
<li><code>ApplicationStartedEvent</code> &lt;= 新增的事件</li>
<li><code>ApplicationReadyEvent</code></li>
<li><code>ApplicationFailedEvent</code></li>
</ul>
<h1 id="测试篇"><a href="#测试篇" class="headerlink" title="测试篇"></a>测试篇</h1><h2 id="使用AssertJ"><a href="#使用AssertJ" class="headerlink" title="使用AssertJ"></a>使用AssertJ</h2><blockquote>
<p><a href="http://joel-costigliola.github.io/assertj/assertj-core-features-highlight.html" rel="external nofollow noopener noreferrer" target="_blank">AssertJ Core features highlight</a></p>
</blockquote>
<p>如果是Spring Boot 1.x版本，在<code>spring-boot-starter-test</code>模块中，AssertJ的版本依然停留在<code>2.x</code>，为了可以使用新功能，我们可以引入新版本的AssertJ（<strong>Spring Boot 2已经是最新版的AssertJ</strong>）:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">    &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">    &lt;exclusions&gt;</span><br><span class="line">        &lt;exclusion&gt;</span><br><span class="line">            &lt;groupId&gt;org.assertj&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;assertj-core&lt;/artifactId&gt;</span><br><span class="line">        &lt;/exclusion&gt;</span><br><span class="line">    &lt;/exclusions&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.assertj&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;assertj-core&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.9.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>AsserJ的API很多，功能非常强大，直接贴上代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br></pre></td><td class="code"><pre><span class="line">package com.yangbingdong.springboottestassertj.assertj;</span><br><span class="line"></span><br><span class="line">import com.yangbingdong.springboottestassertj.domain.Person;</span><br><span class="line">import org.assertj.core.util.Maps;</span><br><span class="line">import org.junit.Test;</span><br><span class="line"></span><br><span class="line">import java.io.BufferedWriter;</span><br><span class="line">import java.io.File;</span><br><span class="line">import java.io.FileOutputStream;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.OutputStreamWriter;</span><br><span class="line">import java.lang.annotation.ElementType;</span><br><span class="line">import java.lang.annotation.Retention;</span><br><span class="line">import java.lang.annotation.RetentionPolicy;</span><br><span class="line">import java.lang.annotation.Target;</span><br><span class="line">import java.nio.charset.Charset;</span><br><span class="line">import java.util.Arrays;</span><br><span class="line">import java.util.Date;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">import static org.assertj.core.api.Assertions.assertThat;</span><br><span class="line">import static org.assertj.core.api.Assertions.assertThatExceptionOfType;</span><br><span class="line">import static org.assertj.core.api.Assertions.assertThatIOException;</span><br><span class="line">import static org.assertj.core.api.Assertions.assertThatThrownBy;</span><br><span class="line">import static org.assertj.core.api.Assertions.atIndex;</span><br><span class="line">import static org.assertj.core.api.Assertions.contentOf;</span><br><span class="line">import static org.assertj.core.api.Assertions.entry;</span><br><span class="line">import static org.assertj.core.util.DateUtil.parse;</span><br><span class="line">import static org.assertj.core.util.DateUtil.parseDatetimeWithMs;</span><br><span class="line">import static org.assertj.core.util.Lists.newArrayList;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author ybd</span><br><span class="line"> * @date 18-2-8</span><br><span class="line"> * @contact yangbingdong@1994.gmail</span><br><span class="line"> */</span><br><span class="line">public class AssertJTestDemo &#123;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 字符串断言</span><br><span class="line">	 */</span><br><span class="line">	@Test</span><br><span class="line">	public void testString() &#123;</span><br><span class="line">		String str = null;</span><br><span class="line">		// 断言null或为空字符串</span><br><span class="line">		assertThat(str).isNullOrEmpty();</span><br><span class="line">		// 断言空字符串</span><br><span class="line">		assertThat(&quot;&quot;).isEmpty();</span><br><span class="line">		// 断言字符串相等 断言忽略大小写判断字符串相等</span><br><span class="line">		assertThat(&quot;Frodo&quot;).isEqualTo(&quot;Frodo&quot;).isEqualToIgnoringCase(&quot;frodo&quot;);</span><br><span class="line">		// 断言开始字符串 结束字符穿 字符串长度</span><br><span class="line">		assertThat(&quot;Frodo&quot;).startsWith(&quot;Fro&quot;).endsWith(&quot;do&quot;).hasSize(5);</span><br><span class="line">		// 断言包含字符串 不包含字符串</span><br><span class="line">		assertThat(&quot;Frodo&quot;).contains(&quot;rod&quot;).doesNotContain(&quot;fro&quot;);</span><br><span class="line">		// 断言字符串只出现过一次</span><br><span class="line">		assertThat(&quot;Frodo&quot;).containsOnlyOnce(&quot;do&quot;);</span><br><span class="line">		// 判断正则匹配</span><br><span class="line">		assertThat(&quot;Frodo&quot;).matches(&quot;..o.o&quot;).doesNotMatch(&quot;.*d&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 数字断言</span><br><span class="line">	 */</span><br><span class="line">	@Test</span><br><span class="line">	public void testNumber() &#123;</span><br><span class="line">		Integer num = null;</span><br><span class="line">		// 断言空</span><br><span class="line">		assertThat(num).isNull();</span><br><span class="line">		// 断言相等</span><br><span class="line">		assertThat(42).isEqualTo(42);</span><br><span class="line">		// 断言大于 大于等于</span><br><span class="line">		assertThat(42).isGreaterThan(38).isGreaterThanOrEqualTo(38);</span><br><span class="line">		// 断言小于 小于等于</span><br><span class="line">		assertThat(42).isLessThan(58).isLessThanOrEqualTo(58);</span><br><span class="line">		// 断言0</span><br><span class="line">		assertThat(0).isZero();</span><br><span class="line">		// 断言正数 非负数</span><br><span class="line">		assertThat(1).isPositive().isNotNegative();</span><br><span class="line">		// 断言负数 非正数</span><br><span class="line">		assertThat(-1).isNegative().isNotPositive();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 时间断言</span><br><span class="line">	 */</span><br><span class="line">	@Test</span><br><span class="line">	public void testDate() &#123;</span><br><span class="line">		// 断言与指定日期相同 不相同 在指定日期之后 在指定日期之钱</span><br><span class="line">		assertThat(parse(&quot;2014-02-01&quot;)).isEqualTo(&quot;2014-02-01&quot;).isNotEqualTo(&quot;2014-01-01&quot;)</span><br><span class="line">									   .isAfter(&quot;2014-01-01&quot;).isBefore(parse(&quot;2014-03-01&quot;));</span><br><span class="line">		// 断言 2014 在指定年份之前 在指定年份之后</span><br><span class="line">		assertThat(new Date()).isBeforeYear(2020).isAfterYear(2013);</span><br><span class="line">		// 断言时间再指定范围内 不在指定范围内</span><br><span class="line">		assertThat(parse(&quot;2014-02-01&quot;)).isBetween(&quot;2014-01-01&quot;, &quot;2014-03-01&quot;).isNotBetween(</span><br><span class="line">				parse(&quot;2014-02-02&quot;), parse(&quot;2014-02-28&quot;));</span><br><span class="line"></span><br><span class="line">		// 断言两时间相差100毫秒</span><br><span class="line">		Date d1 = new Date();</span><br><span class="line">		Date d2 = new Date(d1.getTime() + 100);</span><br><span class="line">		assertThat(d1).isCloseTo(d2, 100);</span><br><span class="line"></span><br><span class="line">		// sets dates differing more and more from date1</span><br><span class="line">		Date date1 = parseDatetimeWithMs(&quot;2003-01-01T01:00:00.000&quot;);</span><br><span class="line">		Date date2 = parseDatetimeWithMs(&quot;2003-01-01T01:00:00.555&quot;);</span><br><span class="line">		Date date3 = parseDatetimeWithMs(&quot;2003-01-01T01:00:55.555&quot;);</span><br><span class="line">		Date date4 = parseDatetimeWithMs(&quot;2003-01-01T01:55:55.555&quot;);</span><br><span class="line">		Date date5 = parseDatetimeWithMs(&quot;2003-01-01T05:55:55.555&quot;);</span><br><span class="line"></span><br><span class="line">		// 断言 日期忽略毫秒，与给定的日期相等</span><br><span class="line">		assertThat(date1).isEqualToIgnoringMillis(date2);</span><br><span class="line">		// 断言 日期与给定的日期具有相同的年月日时分秒</span><br><span class="line">		assertThat(date1).isInSameSecondAs(date2);</span><br><span class="line">		// 断言 日期忽略秒，与给定的日期时间相等</span><br><span class="line">		assertThat(date1).isEqualToIgnoringSeconds(date3);</span><br><span class="line">		// 断言 日期与给定的日期具有相同的年月日时分</span><br><span class="line">		assertThat(date1).isInSameMinuteAs(date3);</span><br><span class="line">		// 断言 日期忽略分，与给定的日期时间相等</span><br><span class="line">		assertThat(date1).isEqualToIgnoringMinutes(date4);</span><br><span class="line">		// 断言 日期与给定的日期具有相同的年月日时</span><br><span class="line">		assertThat(date1).isInSameHourAs(date4);</span><br><span class="line">		// 断言 日期忽略小时，与给定的日期时间相等</span><br><span class="line">		assertThat(date1).isEqualToIgnoringHours(date5);</span><br><span class="line">		// 断言 日期与给定的日期具有相同的年月日</span><br><span class="line">		assertThat(date1).isInSameDayAs(date5);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 集合断要</span><br><span class="line">	 */</span><br><span class="line">	@Test</span><br><span class="line">	public void testList() &#123;</span><br><span class="line">		// 断言 列表是空的</span><br><span class="line">		assertThat(newArrayList()).isEmpty();</span><br><span class="line">		// 断言 列表的开始 结束元素</span><br><span class="line">		assertThat(newArrayList(1, 2, 3)).startsWith(1).endsWith(3);</span><br><span class="line">		// 断言 列表包含元素 并且是排序的</span><br><span class="line">		assertThat(newArrayList(1, 2, 3)).contains(1, atIndex(0)).contains(2, atIndex(1)).contains(3)</span><br><span class="line">										 .isSorted();</span><br><span class="line">		// 断言 被包含与给定列表</span><br><span class="line">		assertThat(newArrayList(3, 1, 2)).isSubsetOf(newArrayList(1, 2, 3, 4));</span><br><span class="line">		// 断言 存在唯一元素</span><br><span class="line">		assertThat(newArrayList(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;)).containsOnlyOnce(&quot;a&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * Map断言</span><br><span class="line">	 */</span><br><span class="line">	@Test</span><br><span class="line">	public void testMap() &#123;</span><br><span class="line">		Map&lt;String, Object&gt; foo = Maps.newHashMap(&quot;A&quot;, 1);</span><br><span class="line">		foo.put(&quot;B&quot;, 2);</span><br><span class="line">		foo.put(&quot;C&quot;, 3);</span><br><span class="line"></span><br><span class="line">		// 断言 map 不为空 size</span><br><span class="line">		assertThat(foo).isNotEmpty().hasSize(3);</span><br><span class="line">		// 断言 map 包含元素</span><br><span class="line">		assertThat(foo).contains(entry(&quot;A&quot;, 1), entry(&quot;B&quot;, 2));</span><br><span class="line">		// 断言 map 包含key</span><br><span class="line">		assertThat(foo).containsKeys(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;);</span><br><span class="line">		// 断言 map 包含value</span><br><span class="line">		assertThat(foo).containsValue(3);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 类断言</span><br><span class="line">	 */</span><br><span class="line">	@Test</span><br><span class="line">	public void testClass() &#123;</span><br><span class="line">		// 断言 是注解</span><br><span class="line">		assertThat(Magical.class).isAnnotation();</span><br><span class="line">		// 断言 不是注解</span><br><span class="line">		assertThat(Ring.class).isNotAnnotation();</span><br><span class="line">		// 断言 存在注解</span><br><span class="line">		assertThat(Ring.class).hasAnnotation(Magical.class);</span><br><span class="line">		// 断言 不是借口</span><br><span class="line">		assertThat(Ring.class).isNotInterface();</span><br><span class="line">		// 断言 是否为指定Class实例</span><br><span class="line">		assertThat(&quot;string&quot;).isInstanceOf(String.class);</span><br><span class="line">		// 断言 类是给定类的父类</span><br><span class="line">		assertThat(Person1.class).isAssignableFrom(Employee.class);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 异常断言</span><br><span class="line">	 */</span><br><span class="line">	@Test</span><br><span class="line">	public void testException() &#123;</span><br><span class="line">		assertThatThrownBy(() -&gt; &#123; throw new Exception(&quot;boom!&quot;); &#125;).isInstanceOf(Exception.class)</span><br><span class="line">		  .hasMessageContaining(&quot;boom&quot;);</span><br><span class="line"></span><br><span class="line">		assertThatExceptionOfType(IOException.class).isThrownBy(() -&gt; &#123; throw new IOException(&quot;boom!&quot;); &#125;)</span><br><span class="line">													.withMessage(&quot;%s!&quot;, &quot;boom&quot;)</span><br><span class="line">													.withMessageContaining(&quot;boom&quot;)</span><br><span class="line">													.withNoCause();</span><br><span class="line"></span><br><span class="line">		/*</span><br><span class="line">		 * assertThatNullPointerException</span><br><span class="line">		 * assertThatIllegalArgumentException</span><br><span class="line">		 * assertThatIllegalStateException</span><br><span class="line">		 * assertThatIOException</span><br><span class="line">		 */</span><br><span class="line">		assertThatIOException().isThrownBy(() -&gt; &#123; throw new IOException(&quot;boom!&quot;); &#125;)</span><br><span class="line">							   .withMessage(&quot;%s!&quot;, &quot;boom&quot;)</span><br><span class="line">							   .withMessageContaining(&quot;boom&quot;)</span><br><span class="line">							   .withNoCause();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 断言添加描述</span><br><span class="line">	 */</span><br><span class="line">	@Test</span><br><span class="line">	public void addDesc() &#123;</span><br><span class="line">		Person person = new Person(&quot;ybd&quot;, 18);</span><br><span class="line">		assertThat(person.getAge()).as(&quot;check %s&apos;s age&quot;, person.getName()).isEqualTo(18);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 断言对象列表</span><br><span class="line">	 */</span><br><span class="line">	@Test</span><br><span class="line">	public void personListTest() &#123;</span><br><span class="line">		List&lt;Person&gt; personList = Arrays.asList(new Person(&quot;A&quot;, 1), new Person(&quot;B&quot;, 2), new Person(&quot;C&quot;, 3));</span><br><span class="line">		assertThat(personList).extracting(Person::getName).contains(&quot;A&quot;, &quot;B&quot;).doesNotContain(&quot;D&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Test</span><br><span class="line">	public void personListTest1() &#123;</span><br><span class="line">		List&lt;Person&gt; personList = Arrays.asList(new Person(&quot;A&quot;, 1), new Person(&quot;B&quot;, 2), new Person(&quot;C&quot;, 3));</span><br><span class="line">		assertThat(personList).flatExtracting(Person::getName).contains(&quot;A&quot;, &quot;B&quot;).doesNotContain(&quot;D&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 断言文件</span><br><span class="line">	 * @throws Exception</span><br><span class="line">	 */</span><br><span class="line">	@Test</span><br><span class="line">	public void testFile() throws Exception &#123;</span><br><span class="line">		File xFile = writeFile(&quot;xFile&quot;, &quot;The Truth Is Out There&quot;);</span><br><span class="line"></span><br><span class="line">		assertThat(xFile).exists().isFile().isRelative();</span><br><span class="line"></span><br><span class="line">		assertThat(xFile).canRead().canWrite();</span><br><span class="line"></span><br><span class="line">		assertThat(contentOf(xFile)).startsWith(&quot;The Truth&quot;).contains(&quot;Is Out&quot;).endsWith(&quot;There&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	private File writeFile(String fileName, String fileContent) throws Exception &#123;</span><br><span class="line">		return writeFile(fileName, fileContent, Charset.defaultCharset());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	private File writeFile(String fileName, String fileContent, Charset charset) throws Exception &#123;</span><br><span class="line">		File file = new File(&quot;target/&quot; + fileName);</span><br><span class="line">		BufferedWriter out = new BufferedWriter(new OutputStreamWriter(new FileOutputStream(file), charset));</span><br><span class="line">		out.write(fileContent);</span><br><span class="line">		out.close();</span><br><span class="line">		return file;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Magical</span><br><span class="line">	public enum Ring &#123;</span><br><span class="line">		oneRing, vilya, nenya, narya, dwarfRing, manRing;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Target(ElementType.TYPE)</span><br><span class="line">	@Retention(RetentionPolicy.RUNTIME)</span><br><span class="line">	public @interface Magical &#123;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public class Person1 &#123;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public class Employee extends Person1 &#123;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>更多请看官方例子：<strong><em><a href="https://github.com/joel-costigliola/assertj-examples" rel="external nofollow noopener noreferrer" target="_blank">https://github.com/joel-costigliola/assertj-examples</a></em></strong></p>
<h2 id="Gatling性能测试"><a href="#Gatling性能测试" class="headerlink" title="Gatling性能测试"></a>Gatling性能测试</h2><blockquote>
<p>性能测试的两种类型，负载测试和压力测试：</p>
<ul>
<li><strong>负载测试（Load Testing）：</strong>负载测试是一种主要为了测试软件系统是否达到需求文档设计的目标，譬如软件在一定时期内，最大支持多少并发用户数，软件请求出错率等，测试的主要是软件系统的性能。</li>
<li><strong>压力测试（Stress Testing）：</strong>压力测试主要是为了测试硬件系统是否达到需求文档设计的性能目标，譬如在一定时期内，系统的cpu利用率，内存使用率，磁盘I/O吞吐率，网络吞吐量等，压力测试和负载测试最大的差别在于测试目的不同。</li>
</ul>
</blockquote>
<h3 id="Gatling-简介"><a href="#Gatling-简介" class="headerlink" title="Gatling 简介"></a>Gatling 简介</h3><p><img src="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/gatling-logo.png" alt=""></p>
<p>Gatling 是一个功能强大的负载测试工具。它是为易用性、可维护性和高性能而设计的。</p>
<p>开箱即用，Gatling 带有对 HTTP 协议的出色支持，使其成为负载测试任何 HTTP 服务器的首选工具。由于核心引擎实际上是协议不可知的，所以完全可以实现对其他协议的支持，例如，Gatling 目前也提供JMS 支持。</p>
<p>只要底层协议（如 HTTP）能够以非阻塞的方式实现，Gatling 的架构就是异步的。这种架构可以将虚拟用户作为消息而不是专用线程来实现。因此，运行数千个并发的虚拟用户不是问题。</p>
<h3 id="使用Recorder快速开始"><a href="#使用Recorder快速开始" class="headerlink" title="使用Recorder快速开始"></a>使用Recorder快速开始</h3><p>官方提供了GUI界面的录制器，可以监听对应端口记录请求操作并转化为Scala脚本</p>
<p>1、进入 <em><a href="https://gatling.io/download/" rel="external nofollow noopener noreferrer" target="_blank">下载页面</a></em> 下载最新版本<br>2、解压并进入 <code>$GATLING_HOME/bin</code> (<code>$GATLING_HOME</code>为解压目录)，运行<code>recorder.sh</code><br><img src="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/recorder1.png" alt=""></p>
<ul>
<li><p>上图监听8000端口（若被占用请更换端口），需要在浏览器设置代理，以FireFox为例：<br><img src="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/firefox-proxy.jpg" alt=""></p>
</li>
<li><p><code>Output folder</code>为Scala脚本输出路径，例如设置为 <code>/home/ybd/data/application/gatling-charts-highcharts-bundle-2.3.0/user-files/simulations</code>，会在该路经下面生成一个<code>RecordedSimulation.scala</code>的文件（上面指定的Class Name）：<br><img src="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/scala-script-location.jpg" alt=""></p>
</li>
</ul>
<p>3、点击<code>record</code>并在Firefox进行相应操作，然后点击<code>Stop</code>，会生成类似下面的脚本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">package computerdatabase </span><br><span class="line"></span><br><span class="line">import io.gatling.core.Predef._ </span><br><span class="line">import io.gatling.http.Predef._</span><br><span class="line">import scala.concurrent.duration._</span><br><span class="line"></span><br><span class="line">class BasicSimulation extends Simulation &#123; </span><br><span class="line"></span><br><span class="line">  val httpConf = http </span><br><span class="line">    .baseURL(&quot;http://computer-database.gatling.io&quot;) </span><br><span class="line">    .acceptHeader(&quot;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&quot;) </span><br><span class="line">    .doNotTrackHeader(&quot;1&quot;)</span><br><span class="line">    .acceptLanguageHeader(&quot;en-US,en;q=0.5&quot;)</span><br><span class="line">    .acceptEncodingHeader(&quot;gzip, deflate&quot;)</span><br><span class="line">    .userAgentHeader(&quot;Mozilla/5.0 (Windows NT 5.1; rv:31.0) Gecko/20100101 Firefox/31.0&quot;)</span><br><span class="line"></span><br><span class="line">  val scn = scenario(&quot;BasicSimulation&quot;)</span><br><span class="line">    .exec(http(&quot;request_1&quot;)</span><br><span class="line">    .get(&quot;/&quot;))</span><br><span class="line">    .pause(5) </span><br><span class="line"></span><br><span class="line">  setUp( </span><br><span class="line">    scn.inject(atOnceUsers(1))</span><br><span class="line">  ).protocols(httpConf)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4、然后运行 <code>$GATLING_HOME/bin/gatling.sh</code>，选择 <code>[0] RecordedSimulation</code>，随后的几个选项直接回车即可生成测试结果：</p>
<p><img src="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/terminal-gatling-test1.jpg" alt=""></p>
<p><img src="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/terminal-gatling-test2.jpg" alt=""></p>
<p>注意看上图最下面那一行，就是生成测试结果的入口。</p>
<p>具体请看官方文档：<em><a href="https://gatling.io/docs/current/quickstart" rel="external nofollow noopener noreferrer" target="_blank">https://gatling.io/docs/current/quickstart</a></em></p>
<h3 id="使用IDEA编写"><a href="#使用IDEA编写" class="headerlink" title="使用IDEA编写"></a>使用IDEA编写</h3><p>1、首先安装Scala插件：</p>
<p><img src="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/scala-plugin.jpg" alt=""></p>
<p>2、安装 scala SDK：</p>
<p><img src="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/add-scala-sdk02.jpg" alt=""></p>
<p><img src="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/add-scala-sdk01.jpg" alt=""></p>
<p>3、编写测试脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">class ApiGatlingSimulationTest extends Simulation &#123;</span><br><span class="line"></span><br><span class="line">  val scn: ScenarioBuilder = scenario(&quot;AddAndFindPersons&quot;).repeat(100, &quot;n&quot;) &#123;</span><br><span class="line">    exec(</span><br><span class="line">      http(&quot;AddPerson-API&quot;)</span><br><span class="line">        .post(&quot;http://localhost:8080/persons&quot;)</span><br><span class="line">        .header(&quot;Content-Type&quot;, &quot;application/json&quot;)</span><br><span class="line">        .body(StringBody(&quot;&quot;&quot;&#123;&quot;firstName&quot;:&quot;John$&#123;n&#125;&quot;,&quot;lastName&quot;:&quot;Smith$&#123;n&#125;&quot;,&quot;birthDate&quot;:&quot;1980-01-01&quot;, &quot;address&quot;: &#123;&quot;country&quot;:&quot;pl&quot;,&quot;city&quot;:&quot;Warsaw&quot;,&quot;street&quot;:&quot;Test$&#123;n&#125;&quot;,&quot;postalCode&quot;:&quot;02-200&quot;,&quot;houseNo&quot;:$&#123;n&#125;&#125;&#125;&quot;&quot;&quot;))</span><br><span class="line">        .check(status.is(200))</span><br><span class="line">    ).pause(Duration.apply(5, TimeUnit.MILLISECONDS))</span><br><span class="line">  &#125;.repeat(1000, &quot;n&quot;) &#123;</span><br><span class="line">    exec(</span><br><span class="line">      http(&quot;GetPerson-API&quot;)</span><br><span class="line">        .get(&quot;http://localhost:8080/persons/$&#123;n&#125;&quot;)</span><br><span class="line">        .check(status.is(200))</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  setUp(scn.inject(atOnceUsers(30))).maxDuration(FiniteDuration.apply(10, &quot;minutes&quot;))</span><br></pre></td></tr></table></figure>
<p>4、配置pom</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;build&gt;</span><br><span class="line">       &lt;plugins&gt;</span><br><span class="line">           &lt;!-- Gatling Maven 插件， 使用： mvn gatling:execute 命令运行 --&gt;</span><br><span class="line">           &lt;plugin&gt;</span><br><span class="line">               &lt;groupId&gt;io.gatling&lt;/groupId&gt;</span><br><span class="line">               &lt;artifactId&gt;gatling-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">               &lt;version&gt;$&#123;gatling-plugin.version&#125;&lt;/version&gt;</span><br><span class="line">               &lt;configuration&gt;</span><br><span class="line">                   &lt;!-- 测试脚本 --&gt;</span><br><span class="line">                   &lt;simulationClass&gt;com.yangbingdong.springbootgatling.gatling.ApiGatlingSimulationTest&lt;/simulationClass&gt;</span><br><span class="line">                   &lt;!-- 结果输出地址 --&gt;</span><br><span class="line">                   &lt;resultsFolder&gt;/home/ybd/test/gatling&lt;/resultsFolder&gt;</span><br><span class="line">               &lt;/configuration&gt;</span><br><span class="line">           &lt;/plugin&gt;</span><br><span class="line">       &lt;/plugins&gt;</span><br><span class="line">   &lt;/build&gt;</span><br></pre></td></tr></table></figure>
<p>5、运行 Spring Boot 应用</p>
<p>6、运行测试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn gatling:execute</span><br></pre></td></tr></table></figure>
<p><img src="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/idea-gatling-test.jpg" alt=""></p>
<p>我们打开结果中的<code>index.html</code>：</p>
<p><img src="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/gatling-test-result1.jpg" alt=""></p>
<p><img src="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/gatling-test-result2.jpg" alt=""></p>
<h3 id="遇到问题"><a href="#遇到问题" class="headerlink" title="遇到问题"></a>遇到问题</h3><p>途中出现了以下错误</p>
<p><img src="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/gatling-error1.jpg" alt=""></p>
<p><img src="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/gatling-error2.jpg" alt=""></p>
<p>这是由于<strong>使用了Log4J2</strong>，把Gatling自带的Logback排除了（同一个项目），把<code>&lt;exclusions&gt;</code>这一段注释掉就没问题了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;io.gatling.highcharts&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;gatling-charts-highcharts&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;$&#123;gatling-charts-highcharts.version&#125;&lt;/version&gt;</span><br><span class="line">    &lt;!-- 由于配置了log4j2，运行Gatling时需要**注释**以下的 exclusions，否则会抛异常，但貌似不影响测试结果 --&gt;</span><br><span class="line">    &lt;exclusions&gt;</span><br><span class="line">        &lt;exclusion&gt;</span><br><span class="line">            &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;</span><br><span class="line">        &lt;/exclusion&gt;</span><br><span class="line">    &lt;/exclusions&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>囧。。。。。。</p>
<blockquote>
<p>参考：<em><a href="http://www.spring4all.com/article/584" rel="external nofollow noopener noreferrer" target="_blank">http://www.spring4all.com/article/584</a></em></p>
<p>代码：<em><a href="https://github.com/masteranthoneyd/spring-boot-learning/tree/master/spring-boot-gatling" rel="external nofollow noopener noreferrer" target="_blank">https://github.com/masteranthoneyd/spring-boot-learning/tree/master/spring-boot-gatling</a></em></p>
<p>官方教程：<em><a href="https://gatling.io/docs/current/advanced_tutorial/" rel="external nofollow noopener noreferrer" target="_blank">https://gatling.io/docs/current/advanced_tutorial/</a></em></p>
</blockquote>
<h2 id="ContPerf"><a href="#ContPerf" class="headerlink" title="ContPerf"></a>ContPerf</h2><p>ContiPerf</p>
<p>是一个轻量级的<strong>测试</strong>工具，基于<strong>JUnit</strong>4 开发，可用于<strong>接口</strong>级的<strong>性能测试</strong>，快速压测。</p>
<p>引入依赖:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 性能测试 --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.databene&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;contiperf&lt;/artifactId&gt;</span><br><span class="line">    &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">    &lt;version&gt;2.1.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<h3 id="ContiPerf介绍"><a href="#ContiPerf介绍" class="headerlink" title="ContiPerf介绍"></a>ContiPerf介绍</h3><p>可以指定在线程数量和执行次数，通过限制最大时间和平均执行时间来进行效率测试，一个简单的例子如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public class ContiPerfTest &#123; </span><br><span class="line">    @Rule </span><br><span class="line">    publicContiPerfRule i = newContiPerfRule(); </span><br><span class="line">   </span><br><span class="line">    @Test </span><br><span class="line">    @PerfTest(invocations = 1000, threads = 40) </span><br><span class="line">    @Required(max = 1200, average = 250, totalTime = 60000) </span><br><span class="line">    publicvoidtest1() throwsException &#123; </span><br><span class="line">        Thread.sleep(200); </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用<code>@Rule</code>注释激活ContiPerf，通过<code>@Test</code>指定测试方法，<code>@PerfTest</code>指定调用次数和线程数量，<code>@Required</code>指定性能要求（每次执行的最长时间，平均时间，总时间等）。</p>
<p>也可以通过对类指定<code>@PerfTest</code>和<code>@Required</code>，表示类中方法的默认设置，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@PerfTest(invocations = 1000, threads = 40) </span><br><span class="line">@Required(max = 1200, average = 250, totalTime = 60000) </span><br><span class="line">public class ContiPerfTest &#123; </span><br><span class="line">    @Rule </span><br><span class="line">    public ContiPerfRule i = new ContiPerfRule(); </span><br><span class="line">   </span><br><span class="line">    @Test </span><br><span class="line">    public void test1() throws Exception &#123; </span><br><span class="line">        Thread.sleep(200); </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="主要参数介绍"><a href="#主要参数介绍" class="headerlink" title="主要参数介绍"></a>主要参数介绍</h3><p>1）PerfTest参数</p>
<p><code>@PerfTest(invocations = 300)</code>：执行300次，和线程数量无关，默认值为1，表示执行1次；</p>
<p><code>@PerfTest(threads=30)</code>：并发执行30个线程，默认值为1个线程；</p>
<p><code>@PerfTest(duration = 20000)</code>：重复地执行测试至少执行20s。</p>
<p>三个属性可以组合使用，其中<code>Threads</code>必须和其他两个属性组合才能生效。当<code>Invocations</code>和<code>Duration</code>都有指定时，以执行次数多的为准。</p>
<p>　　例，<code>@PerfTest(invocations = 300, threads = 2, duration = 100)</code>，如果执行方法300次的时候执行时间还没到100ms，则继续执行到满足执行时间等于100ms，如果执行到50次的时候已经100ms了，则会继续执行之100次。</p>
<p>　　如果你不想让测试连续不间断的跑完，可以通过注释设置等待时间，例，<code>@PerfTest(invocations = 1000, threads = 10, timer = RandomTimer.class, timerParams = { 30, 80 })</code> ，每执行完一次会等待30~80ms然后才会执行下一次调用。</p>
<p>　　在开多线程进行并发压测的时候，如果一下子达到最大进程数有些系统可能会受不了，ContiPerf还提供了“预热”功能，例，<code>@PerfTest(threads = 10, duration = 60000, rampUp = 1000)</code> ，启动时会先起一个线程，然后每个1000ms起一线程，到9000ms时10个线程同时执行，那么这个测试实际执行了69s，如果只想衡量全力压测的结果，那么可以在注释中加入warmUp，即<code>@PerfTest(threads = 10, duration = 60000, rampUp = 1000, warmUp = 9000)</code> ，那么统计结果的时候会去掉预热的9s。</p>
<p>2）Required参数</p>
<p><code>@Required(throughput = 20)</code>：要求每秒至少执行20个测试；</p>
<p><code>@Required(average = 50)</code>：要求平均执行时间不超过50ms；</p>
<p><code>@Required(median = 45)</code>：要求所有执行的50%不超过45ms； </p>
<p><code>@Required(max = 2000)</code>：要求没有测试超过2s；</p>
<p><code>@Required(totalTime = 5000)</code>：要求总的执行时间不超过5s；</p>
<p><code>@Required(percentile90 = 3000)</code>：要求90%的测试不超过3s；</p>
<p><code>@Required(percentile95 = 5000)</code>：要求95%的测试不超过5s； </p>
<p><code>@Required(percentile99 = 10000)</code>：要求99%的测试不超过10s; </p>
<p><code>@Required(percentiles = &quot;66:200,96:500&quot;)</code>：要求66%的测试不超过200ms，96%的测试不超过500ms。</p>
<h3 id="测试结果"><a href="#测试结果" class="headerlink" title="测试结果"></a>测试结果</h3><p>测试结果除了会在控制台显示之外，还会生成一个结果文件<code>target/contiperf-report/index.html</code></p>
<p><img src="http://ojoba1c98.bkt.clouddn.com/img/spring-boot-learning/contiperf-report.jpg" alt=""></p>
      
    </div>

<div style="text-align:center;color:#ccc;font-size:14px">---------------- The End ----------------</div>

    <div>
      
        
<div id="wechat_subscriber" style="display:block;padding:10px 0;margin:20px auto;width:100%;text-align:center">
    <img id="wechat_subscriber_qcode" src="/images/wechat/gongzhonghao.jpg" alt="ookamiAntD wechat" style="width:200px;max-width:100%">
    <div>欢迎您扫一扫上面的微信公众号，订阅我的博客！</div>
</div>


      
    </div>

    <div>
      
        


  <div style="padding:10px 0;margin:20px auto;width:90%;text-align:center">
    <div>谢谢大爷～</div>
    <button id="rewardButton" disable="enable" onclick='var qr=document.getElementById("QR");"none"===qr.style.display?qr.style.display="block":qr.style.display="none"'>
      <span>赏</span>
    </button>
    <div id="QR" style="display:none">
      
        <div id="wechat" style="display:inline-block">
          <img id="wechat_qr" src="/images/donate/wechat.png" alt="ookamiAntD WeChat Pay">
          <p>微信打赏</p>
        </div>
      
      
        <div id="alipay" style="display:inline-block">
          <img id="alipay_qr" src="/images/donate/alipay.jpg" alt="ookamiAntD Alipay">
          <p>支付宝打赏</p>
        </div>
      
    </div>
  </div>


      
    </div>
<div>
	  
	    <p id="div-border-left-red">
		Author：<b>ookamiAntD Yang</b><br>
		Link：<a href="/2018/spring-boot-learning-hodgepodge/" title="Spring Boot 学习杂记">http://yangbingdong.com/2018/spring-boot-learning-hodgepodge/</a><br>
		Contact：<a>yangbingdong1994@gmail.com</a><br>
	   <b>本文基于<a target="_blank" title="Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0)" href="http://creativecommons.org/licenses/by-sa/4.0/" rel="external nofollow noopener noreferrer"> 知识共享署名-相同方式共享 4.0 </a>国际许可协议发布</b><br>
	    <b>转载请注明出处，谢谢！</b>
	    </p>
	  
	</div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Java/" rel="tag"># Java</a>
          
            <a href="/tags/Spring/" rel="tag"># Spring</a>
          
            <a href="/tags/Spring-Boot/" rel="tag"># Spring Boot</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/mysql-related-learning/" rel="next" title="MySQL杂记">
                <i class="fa fa-chevron-left"></i> MySQL杂记
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/write-your-own-blockchain/" rel="prev" title="转载—自己动手写区块链">
                转载—自己动手写区块链 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        
<div class="-hoofoo-share-title">分享到：</div>
<div class="-hoofoo-share-buttons">
    <div class="-mob-share-weibo -hoofoo-share-weibo -hoofoo-share-ui-button"><i class="fa fa-weibo" aria-hidden="true"></i></div>
    <div class="-mob-share-weixin -hoofoo-share-weixin -hoofoo-share-ui-button"><i class="fa fa-weixin" aria-hidden="true"></i></div>
    <div class="-mob-share-qq -hoofoo-share-qq -hoofoo-share-ui-button"><i class="fa fa-qq" aria-hidden="true"></i></div>
    <div class="-mob-share-twitter -hoofoo-share-twitter -hoofoo-share-ui-button"><i class="fa fa-twitter" aria-hidden="true"></i></div>
    <div class="-hoofoo-share-more -hoofoo-share-ui-button -mob-share-open"><i class="fa fa-ellipsis-h" aria-hidden="true"></i></div>
</div>
<div class="-mob-share-ui" style="display:none">
    <ul class="-mob-share-list">
        <li class="-mob-share-weibo"><p>新浪微博</p></li>
        <li class="-mob-share-weixin"><p>微信</p></li>
        <li class="-mob-share-qzone"><p>QQ空间</p></li>
        <li class="-mob-share-qq"><p>QQ好友</p></li>
        <li class="-mob-share-tencentweibo"><p>腾讯微博</p></li>
        <li class="-mob-share-renren"><p>人人网</p></li>
        <li class="-mob-share-kaixin"><p>开心网</p></li>
        <li class="-mob-share-douban"><p>豆瓣</p></li>
        <li class="-mob-share-youdao"><p>有道云笔记</p></li>
        <li class="-mob-share-mingdao"><p>明道</p></li>
        <li class="-mob-share-pengyou"><p>朋友网</p></li>
        <li class="-mob-share-facebook"><p>Facebook</p></li>
        <li class="-mob-share-twitter"><p>Twitter</p></li>
        <li class="-mob-share-pocket"><p>Pocket</p></li>
        <li class="-mob-share-google"><p>Google+</p></li>
        <li class="-mob-share-tumblr"><p>Tumblr</p></li>
        <li class="-mob-share-instapaper"><p>Instapaper</p></li>
        <li class="-mob-share-linkedin"><p>Linkedin</p></li>
    </ul>
    <div class="-mob-share-close">取消</div>
</div>
<div class="-mob-share-ui-bg"></div>
<script id="-mob-share" src="http://f1.webshare.mob.com/code/mob-share.js?appkey=21aa3b13ad233"></script>


      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
<div style="text-align:center">
  

</div>
      <div id="disqus_proxy_thread"></div>
      <div id="disqus_thread"></div>
      
          <script type="text/javascript">window.disqusProxy={username:"ookamiantd",server:"disqus-proxy.yangbingdong.com",port:"5509",defaultAvatar:"/images/avatar/avatar-default.jpg",adminAvatar:"/images/avatar/avatar-admin.jpg",identifier:"2018/spring-boot-learning-hodgepodge/"},window.disqus_config=function(){this.page.url="http://yangbingdong.com/2018/spring-boot-learning-hodgepodge/",this.page.identifier="2018/spring-boot-learning-hodgepodge/"},window.onload=function(){var a=document.createElement("script");a.src="/static/js/main.0d0338ae.js",a.async=!0,document.body.appendChild(a)}</script>
          <link rel="stylesheet" href="/static/css/main.0603c539.css">
      

    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/images/avatar/avatar-admin.jpg" alt="ookamiAntD">
          <p class="site-author-name" itemprop="name">ookamiAntD</p>
          <p class="site-description motion-element" itemprop="description">码渣 | rocker | 二次元 | 美剧 | 宅</p>
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">26</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">14</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">27</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/masteranthoneyd" target="_blank" rel="external nofollow noopener noreferrer" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.facebook.com/profile.php?id=100014869064462" target="_blank" rel="external nofollow noopener noreferrer" title="Facebook">
                  
                    <i class="fa fa-fw fa-facebook"></i>
                  
                  Facebook
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/ookamiAntD" target="_blank" rel="external nofollow noopener noreferrer" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
          
        </div>

        
        
          <div class="cc-license motion-element" itemprop="license">
            <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="cc-opacity" target="_blank" rel="external nofollow noopener noreferrer">
              <img src="/images/cc-by-sa.svg" alt="Creative Commons">
            </a>
          </div>
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-block">
            <div class="links-of-blogroll-title">
              <i class="fa fa-fw fa-globe"></i>
              大神们的博客
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="https://ycwalker.com/" title="ciqulover" target="_blank" rel="external nofollow noopener noreferrer">ciqulover</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://codepub.cn" title="IT草根" target="_blank" rel="external nofollow noopener noreferrer">IT草根</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://crossoverjie.top/" title="crossoverJie's Blog" target="_blank" rel="external nofollow noopener noreferrer">crossoverJie's Blog</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://yemengying.com/" title="Giraffe's Home" target="_blank" rel="external nofollow noopener noreferrer">Giraffe's Home</a>
                </li>
              
            </ul>
          </div>
        

        <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="300" height="80" src="//music.163.com/outchain/player?type=2&id=32364704&auto=0&height=66" style="margin-top:20px"></iframe>


      </section>

      
      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#构建依赖版本管理工程以及父工程"><span class="nav-number">1.</span> <span class="nav-text">构建依赖版本管理工程以及父工程</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#依赖版本管理工程"><span class="nav-number">1.1.</span> <span class="nav-text">依赖版本管理工程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#父工程"><span class="nav-number">1.2.</span> <span class="nav-text">父工程</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#打包成可执行的Jar"><span class="nav-number">2.</span> <span class="nav-text">打包成可执行的Jar</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#热部署"><span class="nav-number">3.</span> <span class="nav-text">热部署</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#使用为Undertow作为Web容器"><span class="nav-number">4.</span> <span class="nav-text">使用为Undertow作为Web容器</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#与Tomcat性能对比"><span class="nav-number">4.1.</span> <span class="nav-text">与Tomcat性能对比</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Maven配置"><span class="nav-number">4.2.</span> <span class="nav-text">Maven配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#监听多个端口与HTTP2支持"><span class="nav-number">4.3.</span> <span class="nav-text">监听多个端口与HTTP2支持</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Undertow相关配置"><span class="nav-number">4.4.</span> <span class="nav-text">Undertow相关配置</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#使用Log4j2"><span class="nav-number">5.</span> <span class="nav-text">使用Log4j2</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Maven配置-1"><span class="nav-number">5.1.</span> <span class="nav-text">Maven配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#application-yml简单配置"><span class="nav-number">5.2.</span> <span class="nav-text">application.yml简单配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#log4j2-xml配置"><span class="nav-number">5.3.</span> <span class="nav-text">log4j2.xml配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#也可以使用log4j2-yml"><span class="nav-number">5.4.</span> <span class="nav-text">也可以使用log4j2.yml</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#查看依赖树"><span class="nav-number">6.</span> <span class="nav-text">查看依赖树</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#常用连接池配置"><span class="nav-number">7.</span> <span class="nav-text">常用连接池配置</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#HikariCP-连接池常用属性"><span class="nav-number">7.1.</span> <span class="nav-text">HikariCP 连接池常用属性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Tomcat连接池常用的属性"><span class="nav-number">7.2.</span> <span class="nav-text">Tomcat连接池常用的属性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DBCP-连接池常用配置"><span class="nav-number">7.3.</span> <span class="nav-text">DBCP 连接池常用配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Druid连接池配置"><span class="nav-number">7.4.</span> <span class="nav-text">Druid连接池配置</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Spring-MVC集成fastjson"><span class="nav-number">8.</span> <span class="nav-text">Spring MVC集成fastjson</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#方式一、实现WebMvcConfigurer"><span class="nav-number">8.1.</span> <span class="nav-text">方式一、实现WebMvcConfigurer</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#方式二、通过-Bean方式"><span class="nav-number">8.2.</span> <span class="nav-text">方式二、通过@Bean方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WebFlux"><span class="nav-number">8.3.</span> <span class="nav-text">WebFlux</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#开启GZIP算法压缩响应流"><span class="nav-number">9.</span> <span class="nav-text">开启GZIP算法压缩响应流</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#创建异步方法"><span class="nav-number">10.</span> <span class="nav-text">创建异步方法</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#启动异步"><span class="nav-number">10.1.</span> <span class="nav-text">启动异步</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#编写异步方法"><span class="nav-number">10.2.</span> <span class="nav-text">编写异步方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置线程池"><span class="nav-number">10.3.</span> <span class="nav-text">配置线程池</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#直接定义线程池"><span class="nav-number">10.3.1.</span> <span class="nav-text">直接定义线程池</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#实现AsyncConfigurer"><span class="nav-number">10.3.2.</span> <span class="nav-text">实现AsyncConfigurer</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Async使用指定线程池"><span class="nav-number">10.4.</span> <span class="nav-text">Async使用指定线程池</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#获取异步执行结果"><span class="nav-number">10.5.</span> <span class="nav-text">获取异步执行结果</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Spring定时任务"><span class="nav-number">11.</span> <span class="nav-text">Spring定时任务</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Spring启动后执行程序的几种方式"><span class="nav-number">12.</span> <span class="nav-text">Spring启动后执行程序的几种方式</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Spring应用停止前执行程序的几种方式"><span class="nav-number">13.</span> <span class="nav-text">Spring应用停止前执行程序的几种方式</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Spring-Boot-事件"><span class="nav-number">14.</span> <span class="nav-text">Spring Boot 事件</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#测试篇"><span class="nav-number">15.</span> <span class="nav-text">测试篇</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#使用AssertJ"><span class="nav-number">15.1.</span> <span class="nav-text">使用AssertJ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Gatling性能测试"><span class="nav-number">15.2.</span> <span class="nav-text">Gatling性能测试</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Gatling-简介"><span class="nav-number">15.2.1.</span> <span class="nav-text">Gatling 简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用Recorder快速开始"><span class="nav-number">15.2.2.</span> <span class="nav-text">使用Recorder快速开始</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用IDEA编写"><span class="nav-number">15.2.3.</span> <span class="nav-text">使用IDEA编写</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#遇到问题"><span class="nav-number">15.2.4.</span> <span class="nav-text">遇到问题</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ContPerf"><span class="nav-number">15.3.</span> <span class="nav-text">ContPerf</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ContiPerf介绍"><span class="nav-number">15.3.1.</span> <span class="nav-text">ContiPerf介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#主要参数介绍"><span class="nav-number">15.3.2.</span> <span class="nav-text">主要参数介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#测试结果"><span class="nav-number">15.3.3.</span> <span class="nav-text">测试结果</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
	
      <div class="footer-inner">
        <div class="copyright">
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-flash"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Hosted by <a href="https://pages.coding.me" style="font-weight:700" rel="external nofollow noopener noreferrer" target="_blank">Coding Pages</a></span>
</div>


<div class="powered-by">
    Personal Site
</div>

<div class="theme-info">
  Blog -
ookamiAntD | <span class="post-count">共171.7k字</span>
</div>



        

<div class="busuanzi-count">

  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv"><i class="fa fa-user">本站访客数</i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span>人次</span>
  

  
    <span class="site-pv"><i class="fa fa-eye">本站总访问量</i><span class="busuanzi-value" id="busuanzi_value_site_pv"></span>次</span>
  
  
</div>



        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  

    <script type="text/javascript">function run_disqus_script(e){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src="//"+disqus_shortname+".disqus.com/"+e,(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(t)}var disqus_shortname="ookamiantd",disqus_identifier="2018/spring-boot-learning-hodgepodge/",disqus_title="Spring Boot 学习杂记",disqus={load:function(){"object"!=typeof DISQUS&&(!function(){var e=document.createElement("script");e.async=!0,e.type="text/javascript",e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(e)}(),$("#load-disqus").html("评论加载中，请确保你有梯子，若评论长时间未加载则你可能翻墙失败...").fadeOut(9e3))}}</script>
  









  
  
  <script type="text/javascript">function proceedsearch(){$("body").append('<div class="popoverlay">').css("overflow","hidden"),$(".popup").toggle()}var isfetched=!1,search_path="search.xml";0==search_path.length&&(search_path="search.xml");var path="/"+search_path,searchFunc=function(e,t,a){"use strict";$.ajax({url:e,dataType:"xml",async:!0,success:function(e){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var r=$("entry",e).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get(),c=document.getElementById(t),n=document.getElementById(a);c.addEventListener("input",function(){var e=0,t='<ul class="search-result-list">',a=this.value.trim().toLowerCase().split(/[\s\-]+/);n.innerHTML="",this.value.trim().length>1&&r.forEach(function(r){var c=!1,n=r.title.trim().toLowerCase(),s=r.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),o=decodeURIComponent(r.url),i=-1,l=-1,p=-1;if(""!=n&&a.forEach(function(e,t){i=n.indexOf(e),l=s.indexOf(e),(i>=0||l>=0)&&(c=!0,0==t&&(p=l))}),c){e+=1,t+="<li><a href='"+o+"' class='search-result-title'>"+n+"</a>";var h=r.content.trim().replace(/<[^>]+>/g,"");if(p>=0){var u=p-20,d=p+80;u<0&&(u=0),0==u&&(d=50),d>h.length&&(d=h.length);var f=h.substring(u,d);a.forEach(function(e){var t=new RegExp(e,"gi");f=f.replace(t,'<b class="search-keyword">'+e+"</b>")}),t+='<p class="search-result">'+f+"...</p>"}t+="</li>"}}),t+="</ul>",0==e&&(t='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'),""==a&&(t='<div id="no-result"><i class="fa fa-search fa-5x" /></div>'),n.innerHTML=t}),proceedsearch()}})};$(".popup-trigger").click(function(e){e.stopPropagation(),0==isfetched?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(function(e){$(".popup").hide(),$(".popoverlay").remove(),$("body").css("overflow","")}),$(".popup").click(function(e){e.stopPropagation()})</script>


  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("usE0s6JGUeOiMcsVoRuHuv2B-gzGzoHsz","ewm6NEF07r83HbnOr63ptuKH")</script>
  <script>function showTime(e){var t=new AV.Query(e),n=[],o=$(".leancloud_visitors");o.each(function(){n.push($(this).attr("id").trim())}),t.containedIn("url",n),t.find().done(function(e){if(0!==e.length){for(c=0;c<e.length;c++){var t=e[c],i=t.get("url"),s=t.get("time"),l=document.getElementById(i);$(l).find(".leancloud-visitors-count").text(s)}for(var c=0;c<n.length;c++){var i=n[c],l=document.getElementById(i),r=$(l).find(".leancloud-visitors-count");""==r.text()&&r.text(0)}}else o.find(".leancloud-visitors-count").text(0)}).fail(function(e,t){console.log("Error: "+t.code+" "+t.message)})}function addCount(e){var t=$(".leancloud_visitors"),n=t.attr("id").trim(),o=t.attr("data-flag-title").trim(),i=new AV.Query(e);i.equalTo("url",n),i.find({success:function(t){if(t.length>0){var i=t[0];i.fetchWhenSave(!0),i.increment("time"),i.save(null,{success:function(e){$(document.getElementById(n)).find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to save Visitor num, with error message: "+t.message)}})}else{var s=new e,l=new AV.ACL;l.setPublicReadAccess(!0),l.setPublicWriteAccess(!0),s.setACL(l),s.set("title",o),s.set("url",n),s.set("time",1),s.save(null,{success:function(e){$(document.getElementById(n)).find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to create")}})}},error:function(e){console.log("Error:"+e.code+" "+e.message)}})}$(function(){var e=AV.Object.extend("Counter");1==$(".leancloud_visitors").length?addCount(e):$(".post-title-link").length>1&&showTime(e)})</script>



  
<script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script>


  


  <script type="text/javascript" color="255,0,204" opacity="0.5" zindex="-2" count="80" src="//cdn.bootcss.com/canvas-nest.js/1.0.1/canvas-nest.min.js"></script>



<script type="text/javascript">$("body").delegate(".-mob-share-weixin-qrcode-bg","click",function(){$(".-mob-share-weixin-qrcode-close").trigger("click")})</script></body></html>